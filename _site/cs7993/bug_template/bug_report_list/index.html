<!DOCTYPE html>
<!--
  The template is from Eliza Weisman,
  see http://elizas.website
-->
<html>
  <head>
    <meta name="viewport" content="width=720, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta charset="utf-8">
    <title>Bug reports</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116308654-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-116308654-1');
  </script>
  </head>
  <body>
    <div class="site">

      <div class = "content">
        <main>
      <!-- begin subtemplate -->
            
        <div class="textheader">
          <h1 class="title">
      
      
        Bug reports
      
          </h1>
      
        </div>
        <div class="content">
<main>
  <!-- begin content -->
  <p>Last updated: 13:00, Nov, 25, 2018</p>

<ul>
  <li><a href="#cJSON">cJSON</a>
    <ul>
      <li><a href="#Bug in cJSON.c cJSON_SetNumberHelper #138">Bug in cJSON.c cJSON_SetNumberHelper #138</a></li>
      <li><a href="#Bug in cJSON_AddItemToObject #106">Bug in cJSON_AddItemToObject #106</a></li>
      <li><a href="#Invalid pointer returned if reallocate fails in ensure function #189">Invalid pointer returned if reallocate fails in ensure function #189</a></li>
      <li><a href="#String deallocated before use #248">String deallocated before use #248</a></li>
    </ul>
  </li>
  <li><a href="#ArduinoJson">ArduinoJson</a>
    <ul>
      <li><a href="#Update QuotedString.cpp #81">Update QuotedString.cpp #81</a>
        <ul>
          <li><a href="https://nvd.nist.gov/vuln/detail/CVE-2015-4590">CVE-2015-4590</a></li>
        </ul>
      </li>
      <li>[get<String> returns -0 for 0 #808](#get<String> returns -0 for 0 #808)</String></String></li>
    </ul>
  </li>
  <li><a href="#json-parser">json-parser</a>
    <ul>
      <li><a href="#heap buffer overflow on some inputs #68">heap buffer overflow on some inputs #68</a></li>
    </ul>
  </li>
  <li><a href="#json-c">json-c</a>
    <ul>
      <li><a href="#Empty strings and unicode zero values break json parsing. #53">Empty strings and unicode zero values break json parsing. #53</a></li>
    </ul>
  </li>
  <li><a href="#jansson">jansson</a>
    <ul>
      <li>Jansson is a C library for encoding, decoding and manipulating JSON data.</li>
      <li><a href="#Stack exhaustion parsing a JSON file #282">Stack exhaustion parsing a JSON file #282</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4425">CVE-2016-4425</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#iniparser">iniparser</a>
    <ul>
      <li>ini file parser</li>
      <li><a href="#Empty string with quotes. #70">Empty string with quotes. #70</a></li>
    </ul>
  </li>
  <li><a href="#http-parser">http-parser</a>
    <ul>
      <li><a href="#Heap out-of-bounds read in strtoul (68345541)">Heap out-of-bounds read in strtoul (68345541)</a></li>
    </ul>
  </li>
  <li><a href="#myhtml">myhtml</a>
    <ul>
      <li>Fast C/C++ HTML 5 Parser. Using threads.</li>
      <li><a href="#fix charef parsing #152">fix charef parsing #152</a></li>
    </ul>
  </li>
  <li><a href="#mongoose">mongoose</a>
    <ul>
      <li>Mongoose Embedded Web Server Library - Mongoose is more than an embedded webserver. It is a multi-protocol embedded networking library with functions including TCP, HTTP client and server, WebSocket client and server, MQTT client and broker and much more.</li>
      <li><a href="#websocket client bug #631">websocket client bug #631</a></li>
    </ul>
  </li>
  <li><a href="#Firefox">Firefox</a>
    <ul>
      <li><a href="#CVE-2018-5176">Iframe injection &amp; content spoofing &amp; scripts execution via json viewer</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-5176">CVE-2018-5176</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#poco">poco</a>
    <ul>
      <li>The POCO C++ Libraries are powerful cross-platform C++ libraries for building network- and internet-based applications that run on desktop, server, mobile, IoT, and embedded systems.</li>
      <li><a href="#Zip Decompress Parent Path Injection #1968">Zip Decompress Parent Path Injection #1968</a></li>
    </ul>
  </li>
  <li><a href="#CImg">CImg</a>
    <ul>
      <li>The CImg Library is a small and open-source C++ toolkit for image processing.</li>
      <li><a href="#other testcases lead to heap overflow by loading crafted images #185">other testcases lead to heap overflow by loading crafted images #185</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7640">CVE-2018-7640</a></li>
        </ul>
      </li>
      <li><a href="#double free when load bmp image #184">double free when load bmp image #184</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7589">CVE-2018-7589</a></li>
        </ul>
      </li>
      <li><a href="#a heap overflow when load a bmp image #183">a heap overflow when load a bmp image #183</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7588">CVE-2018-7588</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#ImageMagick">ImageMagick</a>
    <ul>
      <li>ImageMagick is a free and open-source software suite for displaying, converting, and editing raster image and vector image files.</li>
      <li><a href="#heap-buffer-overflow in SVGStripString of svg.c #1336">heap-buffer-overflow in SVGStripString of svg.c #1336</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18023">CVE-2018-18023</a></li>
        </ul>
      </li>
      <li><a href="#heap-buffer-overflow in EncodeImage of pict.c #1335">heap-buffer-overflow in EncodeImage of pict.c #1335</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18025">CVE-2018-18025</a></li>
        </ul>
      </li>
      <li><a href="#heap-buffer-overflow in MagickCore #1156">heap-buffer-overflow in MagickCore #1156</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11625">CVE-2018-11625</a></li>
        </ul>
      </li>
      <li><a href="#heap-buffer-overflow #1009">heap-buffer-overflow #1009</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9135">CVE-2018-9135</a></li>
        </ul>
      </li>
      <li><a href="#Stack over-read in MagickCore/accelerate.c due to type mismatch #967">Stack over-read in MagickCore/accelerate.c due to type mismatch #967</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-6930">CVE-2018-6930</a></li>
        </ul>
      </li>
      <li><a href="#out-of-bounds read in coders/sun.c:582:57 #375">out-of-bounds read in coders/sun.c:582:57 #375</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-6500">CVE-2017-6500</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#FFmpeg">FFmpeg</a>
    <ul>
      <li>FFmpeg is a collection of libraries and tools to process multimedia content such as audio, video, subtitles and related metadata.</li>
      <li><a href="#integer overflow and out of array access">integer overflow and out of array access</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1999011">CVE-2018-1999011</a></li>
        </ul>
      </li>
      <li><a href="#Fix multiple runtime error: index 256 out of bounds">Fix multiple runtime error: index 256 out of bounds</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9995">CVE-2017-9995</a></li>
        </ul>
      </li>
      <li><a href="#http: make length/offset-related variables unsigned.">http: make length/offset-related variables unsigned.</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10190">CVE-2016-10190</a></li>
        </ul>
      </li>
      <li><a href="#FFmpeg before 2017-01-24 has an out-of-bounds write caused by a heap-based buffer overflow">FFmpeg before 2017-01-24 has an out-of-bounds write caused by a heap-based buffer overflow</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7865">CVE-2017-7865</a></li>
        </ul>
      </li>
      <li><a href="#FFmpeg before 2017-01-23 has an out-of-bounds write caused by a stack-based buffer overflow">FFmpeg before 2017-01-23 has an out-of-bounds write caused by a stack-based buffer overflow</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7866">CVE-2017-7866</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#OpenCV">OpenCV</a>
    <ul>
      <li><a href="#Out of bounds write causes Segmentation Fault #9723">Out of bounds write causes Segmentation Fault #9723</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-1000450">CVE-2017-1000450</a></li>
        </ul>
      </li>
      <li><a href="#A heap based buffer overflow happens in cv::Jpeg2KDecoder::readComponent8u #10541">A heap based buffer overflow happens in cv::Jpeg2KDecoder::readComponent8u #10541</a>
        <ul>
          <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-5268">CVE-2018-5268</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><a name="cJSON"></a></p>

<h3 id="project-name-cjson">Project Name: <a href="https://github.com/DaveGamble/cJSON">cJSON</a></h3>

<p><a name="Bug in cJSON.c cJSON_SetNumberHelper #138"></a></p>

<h3 id="1-bug-in-cjsonc-cjson_setnumberhelper-138">1. <a href="https://github.com/DaveGamble/cJSON/issues/138">Bug in cJSON.c cJSON_SetNumberHelper #138</a></h3>

<p><a href="https://github.com/DaveGamble/cJSON/issues/138"><strong>Description</strong></a></p>

<blockquote>
  <p>cJSON.c line 231 :
object-&gt;valueint = cJSON_Number;</p>

  <p>may be it is type?</p>

  <p>object-&gt;type = cJSON_Number;
object-&gt;valueint = number;</p>
</blockquote>

<p><a href="https://github.com/DaveGamble/cJSON/commit/ef34500693e8c4a2849d41a4bd66fd19c9ec46c2"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {
<span class="gd">-        object-&gt;valueint = cJSON_Number;
</span><span class="gi">+        object-&gt;valueint = (int)number;
</span>    }
</code></pre></div></div>

<p><a href="https://github.com/DaveGamble/cJSON/commit/ef34500693e8c4a2849d41a4bd66fd19c9ec46c2"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* don't ask me, but the original cJSON_SetNumberValue returns an integer or double */</span>
 <span class="n">CJSON_PUBLIC</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">cJSON_SetNumberHelper</span><span class="p">(</span><span class="n">cJSON</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="kt">double</span> <span class="n">number</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="n">INT_MAX</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="n">object</span><span class="o">-&gt;</span><span class="n">valueint</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="n">INT_MIN</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="n">object</span><span class="o">-&gt;</span><span class="n">valueint</span> <span class="o">=</span> <span class="n">INT_MIN</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">object</span><span class="o">-&gt;</span><span class="n">valueint</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">number</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="k">return</span> <span class="n">object</span><span class="o">-&gt;</span><span class="n">valuedouble</span> <span class="o">=</span> <span class="n">number</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<p>Should be able to discovered by comparing to the output of other JSON parser</p>

<hr />

<p><a name="Bug in cJSON_AddItemToObject #106"></a></p>

<h3 id="2-bug-in-cjson_additemtoobject-106">2. <a href="https://github.com/DaveGamble/cJSON/issues/106">Bug in cJSON_AddItemToObject #106</a></h3>

<p><a href="https://github.com/DaveGamble/cJSON/issues/106"><strong>Description</strong></a></p>

<blockquote>
  <p>In cJSON_AddItemToObject,</p>

  <p>/* free old key and set new one */
if (item-&gt;string)
{
	cJSON_free(item-&gt;string);
}</p>

  <p>Shouldn’t this be:</p>

  <p>if (!(item-&gt;type &amp; cJSON_StringIsConst) &amp;&amp; item-&gt;string)
{
    cJSON_free(item-&gt;string);
}</p>

  <p>Thanks!
Diego.</p>
</blockquote>

<p><a href="https://github.com/DaveGamble/cJSON/commit/702fd95af3408b157167bfd30728c66a212aeae7"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /* free old key and set new one */
<span class="gd">-    if (item-&gt;string)
</span><span class="gi">+    if (!(item-&gt;type &amp; cJSON_StringIsConst) &amp;&amp; item-&gt;string)
</span></code></pre></div></div>

<p><a href="https://github.com/DaveGamble/cJSON/commit/702fd95af3408b157167bfd30728c66a212aeae7"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">void</span>   <span class="nf">cJSON_AddItemToObject</span><span class="p">(</span><span class="n">cJSON</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">,</span> <span class="n">cJSON</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="cm">/* free old key and set new one */</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">&amp;</span> <span class="n">cJSON_StringIsConst</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cJSON_free</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">string</span><span class="p">);</span>
    <span class="p">}</span>
     <span class="n">item</span><span class="o">-&gt;</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">cJSON_strdup</span><span class="p">((</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">string</span><span class="p">);</span>
 
     <span class="n">cJSON_AddItemToArray</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="n">item</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<p>Should be able to discovered given certain input</p>

<hr />

<p><a name="Invalid pointer returned if reallocate fails in ensure function #189"></a></p>

<h3 id="3-invalid-pointer-returned-if-reallocate-fails-in-ensure-function-189">3. <a href="https://github.com/DaveGamble/cJSON/issues/189">Invalid pointer returned if reallocate fails in ensure function #189</a></h3>

<p><a href="https://github.com/DaveGamble/cJSON/issues/189"><strong>Description</strong></a></p>

<blockquote>
  <p>Q: The calls to reallocate is assumed to return a valid pointer. If it fails, NULL should be returned instead of newbuffer + p-&gt;offset.</p>
</blockquote>

<blockquote>
  <p>A: This is definitely a bug and most likely also a security issue, since an attacker could make realloc fail at exactly the right moment while also providing a big JSON (big offset), thereby potentially producing a pointer to an arbitrary memory address that will be written to by cJSON later on.</p>
</blockquote>

<p><a href="https://github.com/DaveGamble/cJSON/commit/954d61e5e7cb9dc6c480fc28ac1cdceca07dd5bd"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gi">+        if (newbuffer == NULL)
+        {
+            p-&gt;hooks.deallocate(p-&gt;buffer);
+            p-&gt;length = 0;
+            p-&gt;buffer = NULL;
+             return NULL;
+        }
</span></code></pre></div></div>

<p><a href="https://github.com/DaveGamble/cJSON/commit/954d61e5e7cb9dc6c480fc28ac1cdceca07dd5bd"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* realloc printbuffer if necessary to have at least "needed" bytes more */</span>
 <span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">ensure</span><span class="p">(</span><span class="n">printbuffer</span> <span class="o">*</span> <span class="k">const</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">needed</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">newbuffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="kt">size_t</span> <span class="n">newsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
     <span class="k">if</span> <span class="p">((</span><span class="n">p</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span>
     <span class="p">{</span>
         <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="k">if</span> <span class="p">((</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">))</span>
     <span class="p">{</span>
         <span class="cm">/* make sure that offset is valid */</span>
         <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="k">if</span> <span class="p">(</span><span class="n">needed</span> <span class="o">&gt;</span> <span class="n">INT_MAX</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="cm">/* sizes bigger than INT_MAX are currently not supported */</span>
         <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="n">needed</span> <span class="o">+=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">needed</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">return</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">noalloc</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="cm">/* calculate new buffer size */</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">needed</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">INT_MAX</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
     <span class="p">{</span>
         <span class="cm">/* overflow of int, use INT_MAX if possible */</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">needed</span> <span class="o">&lt;=</span> <span class="n">INT_MAX</span><span class="p">)</span>
         <span class="p">{</span>
             <span class="n">newsize</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">else</span>
         <span class="p">{</span>
             <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="k">else</span>
     <span class="p">{</span>
         <span class="n">newsize</span> <span class="o">=</span> <span class="n">needed</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">reallocate</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* reallocate with realloc if available */</span>
        <span class="n">newbuffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">reallocate</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="n">newsize</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">newbuffer</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">deallocate</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
            <span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
             <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
         <span class="cm">/* otherwise reallocate manually */</span>
         <span class="n">newbuffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">newsize</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">newbuffer</span><span class="p">)</span>
         <span class="p">{</span>
             <span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">deallocate</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
             <span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
             <span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
 
             <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">newbuffer</span><span class="p">)</span>
         <span class="p">{</span>
             <span class="n">memcpy</span><span class="p">(</span><span class="n">newbuffer</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="n">p</span><span class="o">-&gt;</span><span class="n">hooks</span><span class="p">.</span><span class="n">deallocate</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">newsize</span><span class="p">;</span>
     <span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">newbuffer</span><span class="p">;</span>
 
     <span class="k">return</span> <span class="n">newbuffer</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<p>This is a security issue.</p>

<hr />

<p><a name="String deallocated before use #248"></a></p>

<h3 id="4-string-deallocated-before-use-248">4. <a href="https://github.com/DaveGamble/cJSON/issues/248">String deallocated before use #248</a></h3>

<p><a href="https://github.com/DaveGamble/cJSON/issues/248"><strong>Description:</strong></a></p>

<blockquote>
  <p>add_item_to_object: Fix use-after-free when string is aliased</p>

  <p>If the <code class="highlighter-rouge">string</code> property of the item that is added is an alias to the
<code class="highlighter-rouge">string</code> parameter of <code class="highlighter-rouge">add_item_to_object</code>, and <code class="highlighter-rouge">constant</code> is false,
<code class="highlighter-rouge">cJSON_strdup</code> would access the string after it has been freed.</p>
</blockquote>

<p><a href="https://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>static cJSON_bool add_item_to_object(cJSON * const object, const char * const string, cJSON * const item, const internal_hooks * const hooks, const cJSON_bool constant_key)
{
<span class="gi">+    char *new_key = NULL;
+    int new_type = cJSON_Invalid;
</span>     if ((object == NULL) || (string == NULL) || (item == NULL))
    {
        return false;
    }
<span class="gd">-     if (!(item-&gt;type &amp; cJSON_StringIsConst) &amp;&amp; (item-&gt;string != NULL))
-    {
-        hooks-&gt;deallocate(item-&gt;string);
-    }
</span>     if (constant_key)
    {
<span class="gd">-        item-&gt;string = (char*)cast_away_const(string);
-        item-&gt;type |= cJSON_StringIsConst;
</span><span class="gi">+        new_key = (char*)cast_away_const(string);
+        new_type = item-&gt;type | cJSON_StringIsConst;
</span>    }
    else
    {
<span class="gd">-        char *key = (char*)cJSON_strdup((const unsigned char*)string, hooks);
-        if (key == NULL)
</span><span class="gi">+        new_key = (char*)cJSON_strdup((const unsigned char*)string, hooks);
+        if (new_key == NULL)
</span>        {
            return false;
        }
<span class="gd">-         item-&gt;string = key;
-        item-&gt;type &amp;= ~cJSON_StringIsConst;
</span><span class="gi">+        new_type = item-&gt;type &amp; ~cJSON_StringIsConst;
</span>    }
<span class="gi">+     if (!(item-&gt;type &amp; cJSON_StringIsConst) &amp;&amp; (item-&gt;string != NULL))
+    {
+        hooks-&gt;deallocate(item-&gt;string);
+    }
+     item-&gt;string = new_key;
+    item-&gt;type = new_type;
</span>     return add_item_to_array(object, item);
}
</code></pre></div></div>

<p><a href="https://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The same as above
</span></code></pre></div></div>

<p><strong>Comments</strong>:</p>

<p>This is a security issue</p>

<hr />

<p><a name="iniparser"></a></p>

<h3 id="project-name-iniparser">Project Name: <a href="https://github.com/ndevilla/iniparser/">iniparser</a></h3>

<p><a name="Empty string with quotes. #70"></a></p>

<h3 id="1-empty-string-with-quotes-70">1. <a href="https://github.com/ndevilla/iniparser/issues/70">Empty string with quotes. #70</a></h3>

<p><a href="https://github.com/ndevilla/iniparser/issues/70"><strong>Description:</strong></a></p>

<blockquote>
  <p>for example:
<code class="highlighter-rouge">filter = ""</code></p>
</blockquote>

<blockquote>
  <p>this code can’t handle it</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>} else if (sscanf (line, "%[^=] = \"%[^\"]\"", key, value) == 2
       ||  sscanf (line, "%[^=] = '%[^\']'",   key, value) == 2) {
</code></pre></div></div>

<blockquote>
  <p>this string will be processed in</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>} else if (sscanf (line, "%[^=] = %[^;#]", key, value) == 2) {
</code></pre></div></div>

<blockquote>
  <p>the condition</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (!strcmp(value, "\"\"") || (!strcmp(value, "''"))) {
        value[0]=0 ;
}
</code></pre></div></div>

<blockquote>
  <p>will not be processed.</p>
</blockquote>

<blockquote>
  <p>result:
load = “”
save = “”””
load = “”””
save = “”””””
etc.</p>
</blockquote>

<p><a href="https://github.com/ndevilla/iniparser/commit/54716a77d621373ad3428170af6dacf9f106c264"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gi">+         sta = LINE_VALUE ;
+     } else if (sscanf (line, "%[^=] = %[^;#]", key, value) == 2) {
+         /* Usual key=value without quotes, with or + without comments */
+         strstrip(key);
+         strlwc(key, key, len);
+         strstrip(value);
</span>        /*
         * sscanf cannot handle '' or "" as empty values
         * this is done here
         */
        if (!strcmp(value, "\"\"") || (!strcmp(value, "''"))) {
            value[0]=0 ;
        }
<span class="gd">-        sta = LINE_VALUE ;
-    } else if (sscanf (line, "%[^=] = %[^;#]", key, value) == 2) {
-        /* Usual key=value without quotes, with or without comments */
-        strstrip(key);
-        strlwc(key, key, len);
-        strstrip(value);
</span>
</code></pre></div></div>

<p><a href="https://github.com/ndevilla/iniparser/commit/54716a77d621373ad3428170af6dacf9f106c264"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/*-------------------------------------------------------------------------*/</span>
 <span class="cm">/**
   @brief    Load a single line from an INI file
   @param    input_line  Input line, may be concatenated multi-line input
   @param    section     Output space to store section
   @param    key         Output space to store key
   @param    value       Output space to store value
   @return   line_status value
  */</span>
 <span class="cm">/*--------------------------------------------------------------------------*/</span>
 <span class="k">static</span> <span class="n">line_status</span> <span class="nf">iniparser_line</span><span class="p">(</span>
     <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">input_line</span><span class="p">,</span>
     <span class="kt">char</span> <span class="o">*</span> <span class="n">section</span><span class="p">,</span>
     <span class="kt">char</span> <span class="o">*</span> <span class="n">key</span><span class="p">,</span>
     <span class="kt">char</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="n">line_status</span> <span class="n">sta</span> <span class="p">;</span>
     <span class="kt">char</span> <span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="kt">size_t</span>      <span class="n">len</span> <span class="p">;</span>
 
     <span class="n">line</span> <span class="o">=</span> <span class="n">xstrdup</span><span class="p">(</span><span class="n">input_line</span><span class="p">);</span>
     <span class="n">len</span> <span class="o">=</span> <span class="n">strstrip</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
 
     <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_UNPROCESSED</span> <span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">len</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* Empty line */</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_EMPTY</span> <span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">'#'</span> <span class="o">||</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">';'</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* Comment line */</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_COMMENT</span> <span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">'['</span> <span class="o">&amp;&amp;</span> <span class="n">line</span><span class="p">[</span><span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="sc">']'</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* Section name */</span>
         <span class="n">sscanf</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"[%[^]]"</span><span class="p">,</span> <span class="n">section</span><span class="p">);</span>
         <span class="n">strstrip</span><span class="p">(</span><span class="n">section</span><span class="p">);</span>
         <span class="n">strlwc</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_SECTION</span> <span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"%[^=] = </span><span class="se">\"</span><span class="s">%[^</span><span class="se">\"</span><span class="s">]</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="o">||</span>  <span class="n">sscanf</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"%[^=] = '%[^</span><span class="se">\'</span><span class="s">]'"</span><span class="p">,</span>   <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* Usual key=value with quotes, with or without comments */</span>
        <span class="n">strstrip</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
        <span class="n">strlwc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
        <span class="cm">/* Don't strip spaces from values surrounded with quotes */</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_VALUE</span> <span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"%[^=] = %[^;#]"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Usual key=value without quotes, with or without comments */</span>
        <span class="n">strstrip</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
        <span class="n">strlwc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
        <span class="n">strstrip</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
        <span class="cm">/*
         * sscanf cannot handle '' or "" as empty values
         * this is done here
         */</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">"</span><span class="se">\"\"</span><span class="s">"</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">"''"</span><span class="p">)))</span> <span class="p">{</span>
            <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span>
        <span class="p">}</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_VALUE</span> <span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"%[^=] = %[;#]"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
           <span class="o">||</span>  <span class="n">sscanf</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">"%[^=] %[=]"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/*
          * Special cases:
          * key=
          * key=;
          * key=#
          */</span>
         <span class="n">strstrip</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
         <span class="n">strlwc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
         <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_VALUE</span> <span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="cm">/* Generate syntax error */</span>
         <span class="n">sta</span> <span class="o">=</span> <span class="n">LINE_ERROR</span> <span class="p">;</span>
     <span class="p">}</span>
 
     <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
     <span class="k">return</span> <span class="n">sta</span> <span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="http-parser"></a></p>

<h2 id="project-name-http-parser">Project Name: <a href="https://github.com/nodejs/http-parser/">http-parser</a></h2>

<p><a name="Heap out-of-bounds read in strtoul (68345541)"></a></p>

<h3 id="1-heap-out-of-bounds-read-in-strtoul-68345541-408">1. <a href="https://github.com/nodejs/http-parser/issues/408">Heap out-of-bounds read in strtoul (68345541) #408</a></h3>

<p><a href="https://github.com/nodejs/http-parser/issues/408"><strong>Description:</strong></a></p>

<blockquote>
  <p>src: fix out-of-bounds read through <code class="highlighter-rouge">strtoul</code></p>
</blockquote>

<blockquote>
  <p><code class="highlighter-rouge">strtoul</code> will attempt to lookup the next digit up until it will stumble upon an invalid one. However, for an unterminated string as an input value, this results in out-of-bounds read.</p>
</blockquote>

<blockquote>
  <p>Remove <code class="highlighter-rouge">strtoul</code> call, and replace it with simple loop.</p>
</blockquote>

<p><a href="https://github.com/nodejs/http-parser/commit/9ce7316de31f90d8485706a1ab8ef623404c2d8c"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  if (u-&gt;field_set &amp; (1 &lt;&lt; UF_PORT)) {
<span class="gd">-     /* Don't bother with endp; we've already validated the string */
-     unsigned long v = strtoul(buf + u-&gt;field_data[UF_PORT] .off, NULL, 10);
-      /* Ports have a max value of 2^16 */
-     if (v &gt; 0xffff) {
-       return 1;
</span><span class="gi">+     uint16_t off;
+     uint16_t len;
+     const char* p;
+     const char* end;
+     unsigned long v;
+      off = u-&gt;field_data[UF_PORT].off;
+     len = u-&gt;field_data[UF_PORT].len;
+     end = buf + off + len;
+      /* NOTE: The characters are already validated and are in the [0-9] range */
+     assert(off + len &lt;= buflen &amp;&amp; "Port number overflow");
+     v = 0;
+     for (p = buf + off; p &lt; end; p++) {
+       v *= 10;
+       v += *p - '0';
+        /* Ports have a max value of 2^16 */
+       if (v &gt; 0xffff) {
+         return 1;
+       }
</span>    }
</code></pre></div></div>

<p><a href="https://github.com/nodejs/http-parser/commit/9ce7316de31f90d8485706a1ab8ef623404c2d8c"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">int</span>
 <span class="nf">http_parser_parse_url</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buflen</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_connect</span><span class="p">,</span>
                       <span class="k">struct</span> <span class="n">http_parser_url</span> <span class="o">*</span><span class="n">u</span><span class="p">)</span>
 <span class="p">{</span>
   <span class="k">enum</span> <span class="n">state</span> <span class="n">s</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
   <span class="k">enum</span> <span class="n">http_parser_url_fields</span> <span class="n">uf</span><span class="p">,</span> <span class="n">old_uf</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">found_at</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
   <span class="n">u</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">=</span> <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">s</span> <span class="o">=</span> <span class="n">is_connect</span> <span class="o">?</span> <span class="n">s_req_server_start</span> <span class="o">:</span> <span class="n">s_req_spaces_before_url</span><span class="p">;</span>
   <span class="n">old_uf</span> <span class="o">=</span> <span class="n">UF_MAX</span><span class="p">;</span>
 
   <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">buflen</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">s</span> <span class="o">=</span> <span class="n">parse_url_char</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
 
     <span class="cm">/* Figure out the next field that we're operating on */</span>
     <span class="k">switch</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">case</span> <span class="n">s_dead</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
 
       <span class="cm">/* Skip delimeters */</span>
       <span class="k">case</span> <span class="n">s_req_schema_slash</span><span class="p">:</span>
       <span class="k">case</span> <span class="n">s_req_schema_slash_slash</span><span class="p">:</span>
       <span class="k">case</span> <span class="n">s_req_server_start</span><span class="p">:</span>
       <span class="k">case</span> <span class="n">s_req_query_string_start</span><span class="p">:</span>
       <span class="k">case</span> <span class="n">s_req_fragment_start</span><span class="p">:</span>
         <span class="k">continue</span><span class="p">;</span>
 
       <span class="k">case</span> <span class="n">s_req_schema</span><span class="p">:</span>
         <span class="n">uf</span> <span class="o">=</span> <span class="n">UF_SCHEMA</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
 
       <span class="k">case</span> <span class="n">s_req_server_with_at</span><span class="p">:</span>
         <span class="n">found_at</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
 
       <span class="cm">/* FALLTHROUGH */</span>
       <span class="k">case</span> <span class="n">s_req_server</span><span class="p">:</span>
         <span class="n">uf</span> <span class="o">=</span> <span class="n">UF_HOST</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
 
       <span class="k">case</span> <span class="n">s_req_path</span><span class="p">:</span>
         <span class="n">uf</span> <span class="o">=</span> <span class="n">UF_PATH</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
 
       <span class="k">case</span> <span class="n">s_req_query_string</span><span class="p">:</span>
         <span class="n">uf</span> <span class="o">=</span> <span class="n">UF_QUERY</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
 
       <span class="k">case</span> <span class="n">s_req_fragment</span><span class="p">:</span>
         <span class="n">uf</span> <span class="o">=</span> <span class="n">UF_FRAGMENT</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
 
       <span class="nl">default:</span>
         <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="s">"Unexpected state"</span><span class="p">);</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="cm">/* Nothing's changed; soldier on */</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">uf</span> <span class="o">==</span> <span class="n">old_uf</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_data</span><span class="p">[</span><span class="n">uf</span><span class="p">].</span><span class="n">len</span><span class="o">++</span><span class="p">;</span>
       <span class="k">continue</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_data</span><span class="p">[</span><span class="n">uf</span><span class="p">].</span><span class="n">off</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">buf</span><span class="p">;</span>
     <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_data</span><span class="p">[</span><span class="n">uf</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
 
     <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">uf</span><span class="p">);</span>
     <span class="n">old_uf</span> <span class="o">=</span> <span class="n">uf</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="cm">/* host must be present if there is a schema */</span>
   <span class="cm">/* parsing http:///toto will fail */</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_SCHEMA</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
       <span class="p">(</span><span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_HOST</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_HOST</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">http_parse_host</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">found_at</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
   <span class="p">}</span>
 
   <span class="cm">/* CONNECT requests can only contain "hostname:port" */</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">is_connect</span> <span class="o">&amp;&amp;</span> <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">!=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_HOST</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_PORT</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="o">-&gt;</span><span class="n">field_set</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">UF_PORT</span><span class="p">))</span> <span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">off</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">len</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">end</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">v</span><span class="p">;</span>
     <span class="n">off</span> <span class="o">=</span> <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_data</span><span class="p">[</span><span class="n">UF_PORT</span><span class="p">].</span><span class="n">off</span><span class="p">;</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">u</span><span class="o">-&gt;</span><span class="n">field_data</span><span class="p">[</span><span class="n">UF_PORT</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">off</span> <span class="o">+</span> <span class="n">len</span><span class="p">;</span>
     <span class="cm">/* NOTE: The characters are already validated and are in the [0-9] range */</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">off</span> <span class="o">+</span> <span class="n">len</span> <span class="o">&lt;=</span> <span class="n">buflen</span> <span class="o">&amp;&amp;</span> <span class="s">"Port number overflow"</span><span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">off</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">v</span> <span class="o">*=</span> <span class="mi">10</span><span class="p">;</span>
      <span class="n">v</span> <span class="o">+=</span> <span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
       <span class="cm">/* Ports have a max value of 2^16 */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
     <span class="n">u</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span> <span class="n">v</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="myhtml"></a></p>

<h3 id="project-name-myhtml">Project Name: <a href="https://github.com/lexborisov/myhtml/">myhtml</a></h3>

<p><a name="fix charef parsing #152"></a></p>

<h3 id="1-fix-charef-parsing-152">1. <a href="https://github.com/lexborisov/myhtml/pull/152">fix charef parsing #152</a></h3>

<p><a href="https://github.com/lexborisov/myhtml/pull/152"><strong>Description</strong></a></p>

<blockquote>
  <p>fix bugs like this: <br />
&amp;redirect =&gt; ®direct</p>
</blockquote>

<p><a href="https://github.com/lexborisov/myhtml/pull/152"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-    if(named_character_references[pos].codepoints_len)
-        return &amp;named_character_references[pos];
-    else if(result-&gt;last_entry) {
</span><span class="gi">+    if(result-&gt;last_entry) {
</span>        *offset = result-&gt;last_offset;
        return result-&gt;last_entry;
    }
    
<span class="gd">-    return &amp;named_character_references[pos];
</span><span class="gi">+    return &amp;named_character_references[0];
</span>}
</code></pre></div></div>

<p><a href="https://github.com/lexborisov/myhtml/pull/152"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">const</span> <span class="n">charef_entry_t</span> <span class="o">*</span> <span class="nf">myhtml_charef_find_by_pos</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">pos</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">begin</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">charef_entry_result_t</span> <span class="o">*</span><span class="n">result</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="kt">unsigned</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">u_begin</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">begin</span><span class="p">;</span>
     
     <span class="k">if</span><span class="p">(</span><span class="n">u_begin</span><span class="p">[</span><span class="o">*</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&amp;'</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
         
         <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="o">-&gt;</span><span class="n">codepoints_len</span><span class="p">)</span>
             <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="p">;</span>
         <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">)</span> <span class="p">{</span>
             <span class="o">*</span><span class="n">offset</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_offset</span><span class="p">;</span>
             <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">;</span>
         <span class="p">}</span>
         
         <span class="k">return</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
     <span class="p">}</span>
     
     <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     
     <span class="k">while</span> <span class="p">(</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">ch</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">ch</span> <span class="o">==</span> <span class="n">u_begin</span><span class="p">[</span><span class="o">*</span><span class="n">offset</span><span class="p">])</span>
         <span class="p">{</span>
             <span class="k">if</span><span class="p">(</span><span class="n">u_begin</span><span class="p">[</span><span class="o">*</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="sc">';'</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                 
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
                 <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="p">;</span>
             <span class="p">}</span>
             
             <span class="p">(</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
             
             <span class="k">if</span><span class="p">(</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">next</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                 <span class="k">return</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
             <span class="p">}</span>
             
             <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
                 
                 <span class="k">if</span><span class="p">(</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">codepoints_len</span><span class="p">)</span> <span class="p">{</span>
                     <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_offset</span> <span class="o">=</span> <span class="o">*</span><span class="n">offset</span><span class="p">;</span>
                     <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
                 <span class="p">}</span>
                 
                 <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="p">;</span>
             <span class="p">}</span>
             
             <span class="k">if</span><span class="p">(</span><span class="n">u_begin</span><span class="p">[</span><span class="o">*</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&amp;'</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
                 
                 <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="o">-&gt;</span><span class="n">codepoints_len</span><span class="p">)</span>
                     <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">curr_entry</span><span class="p">;</span>
                 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">)</span> <span class="p">{</span>
                     <span class="o">*</span><span class="n">offset</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_offset</span><span class="p">;</span>
                     <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">;</span>
                 <span class="p">}</span>
                 
                 <span class="k">return</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
             <span class="p">}</span>
             
             <span class="k">if</span><span class="p">(</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">codepoints_len</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_offset</span> <span class="o">=</span> <span class="o">*</span><span class="n">offset</span><span class="p">;</span>
                 <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
             <span class="p">}</span>
             
             <span class="n">pos</span> <span class="o">=</span> <span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">next</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">u_begin</span><span class="p">[</span><span class="o">*</span><span class="n">offset</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">named_character_references</span><span class="p">[</span><span class="n">pos</span><span class="p">].</span><span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">pos</span><span class="o">++</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">else</span> <span class="p">{</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>
    
    <span class="n">result</span><span class="o">-&gt;</span><span class="n">is_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">offset</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_offset</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">last_entry</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">named_character_references</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="json-parser"></a></p>

<h3 id="project-name-json-parser">Project Name: <a href="https://github.com/udp/json-parser/">json-parser</a></h3>

<p><a name="heap buffer overflow on some inputs #68"></a></p>

<h3 id="1-heap-buffer-overflow-on-some-inputs-68">1. <a href="https://github.com/udp/json-parser/issues/68">heap buffer overflow on some inputs #68</a></h3>

<p><a href="https://github.com/udp/json-parser/issues/68"><strong>Description</strong></a></p>

<blockquote>
  <p>Explanation if you need it for your thesis: When json-parser reads a unicode character, it reads 4 or 6 characters immediately without going back around the main loop which usually processes one byte at a time.</p>
</blockquote>

<blockquote>
  <p>To prevent this from causing a buffer overrun, there was an error condition if end - state.ptr &lt; 4 to check that 4 bytes were actually available to read.</p>
</blockquote>

<blockquote>
  <p>However, this check was performed on the ‘u’ character of the \uXXXX, which would return &gt;= 4 even if the input truncated at \uXXX. To fix this, the error condition has been changed to end - state.ptr &lt;= 4.</p>
</blockquote>

<p><a href="https://github.com/udp/json-parser/commit/b42439a2927a879f40698e4861e727c4265c13e6"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-                    if (end - state.ptr &lt; 4 || 
</span><span class="gi">+                    if (end - state.ptr &lt;= 4 || 
</span>                        (uc_b1 = hex_value (*++ state.ptr)) == 0xFF ||
                        (uc_b2 = hex_value (*++ state.ptr)) == 0xFF ||
                        (uc_b3 = hex_value (*++ state.ptr)) == 0xFF ||
                         (uc_b4 = hex_value (*++ state.ptr)) == 0xFF)
                     {
                         sprintf (error, "Invalid character value `%c` (at %d:%d)", b, line_and_col);
                         goto e_failed;
                     }
 
                     uc_b1 = (uc_b1 &lt;&lt; 4) | uc_b2;
                     uc_b2 = (uc_b3 &lt;&lt; 4) | uc_b4;
                     uchar = (uc_b1 &lt;&lt; 8) | uc_b2;
 
                    if ((uchar &amp; 0xF800) == 0xD800) {
                        json_uchar uchar2;
                        
                        if (end - state.ptr &lt; 6 || (*++ state.ptr) != '\\' || (*++ state.ptr) != 'u' ||
<span class="gd">-                        if (end - state.ptr &lt;= 6 || (*++ state.ptr) != '\\' || (*++ state.ptr) != 'u' ||
</span><span class="gi">+                            (uc_b1 = hex_value (*++ state.ptr)) == 0xFF ||
</span>                            (uc_b2 = hex_value (*++ state.ptr)) == 0xFF ||
</code></pre></div></div>

<p><a href="https://github.com/udp/json-parser/blob/b42439a2927a879f40698e4861e727c4265c13e6/json.c#L221"><strong>Full function:</strong></a></p>

<p>Too long, omitted, see <a href="https://github.com/udp/json-parser/blob/b42439a2927a879f40698e4861e727c4265c13e6/json.c#L221">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="mongoose"></a></p>

<h3 id="project-name-mongoose">Project Name: <a href="https://github.com/cesanta/mongoose">mongoose</a></h3>

<p><a name="websocket client bug #631"></a></p>

<h3 id="1-websocket-client-bug-631">1. <a href="https://github.com/cesanta/mongoose/issues/631">websocket client bug #631</a></h3>

<p><a href="https://github.com/cesanta/mongoose/issues/631"><strong>Description</strong></a></p>

<blockquote>
  <p>the function mg_http_common_url_parse(…) has a bug，when parse url, such as:
ws://localhost:8080/ws =&gt; host=locahost:8080, path=/ws
now result is =&gt; host=localhost:8080, path=ws (that is error,not leading /)</p>
</blockquote>

<blockquote>
  <p>the error occur because on the functio,code is:</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (*url == '/') {
  url++;     ==&gt; that is error
  break;
}
</code></pre></div></div>

<blockquote>
  <p>Fix url path parsing</p>
</blockquote>

<blockquote>
  <p>The url parser had two bugs:</p>
</blockquote>

<ul>
  <li>
    <p><code class="highlighter-rouge">http://example.com</code> -&gt; <code class="highlighter-rouge">GET // HTTP/1.1</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">foo://bar/baz</code> -&gt; path is <code class="highlighter-rouge">"baz"</code> instead of <code class="highlighter-rouge">"/baz"</code></p>
  </li>
</ul>

<blockquote>
  <p>Now the path returned by  <code class="highlighter-rouge">mg_http_common_url_parse</code> always starts with <code class="highlighter-rouge">/</code>.</p>
</blockquote>

<p><a href="https://github.com/cesanta/mongoose/commit/29d6c4ac04d4eb5c7eca295a77c8df47fb04f12f"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -7540,7 +7540,6 @@ static int mg_http_common_url_parse(const char *url, const char *schema,
</span>      return -1;
    }
    if (*url == '/') {
<span class="gd">-      url++;
</span>      break;
    }
    if (*url == ':') *port_i = addr_len;
<span class="gu">@@ -7632,7 +7631,7 @@ struct mg_connection *mg_connect_http(struct mg_mgr *mgr,
</span>    /* If the port was addred by us, restore the original host. */
    if (port_i &gt;= 0) addr[port_i] = '\0';
<span class="gd">-    mg_printf(nc, "%s /%s HTTP/1.1\r\nHost: %s\r\nContent-Length: %" SIZE_T_FMT
</span><span class="gi">+    mg_printf(nc, "%s %s HTTP/1.1\r\nHost: %s\r\nContent-Length: %" SIZE_T_FMT
</span></code></pre></div></div>

<p><a href="https://github.com/cesanta/mongoose/commit/29d6c4ac04d4eb5c7eca295a77c8df47fb04f12f"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="kt">int</span> <span class="nf">mg_http_common_url_parse</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">url</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">schema</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">schema_tls</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">use_ssl</span><span class="p">,</span>
                                     <span class="kt">char</span> <span class="o">**</span><span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">port_i</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">addr_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
   <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">url</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">schema</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">schema_tls</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">schema_tls</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">url</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">schema_tls</span><span class="p">);</span>
     <span class="o">*</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
 <span class="cp">#ifndef MG_ENABLE_SSL
</span>     <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* SSL is not enabled, cannot do HTTPS URLs */</span>
 <span class="cp">#endif
</span>   <span class="p">}</span>
 
   <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">url</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
     <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">MG_REALLOC</span><span class="p">(</span><span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">addr_len</span> <span class="o">+</span> <span class="mi">5</span> <span class="cm">/* space for port too. */</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">addr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">DBG</span><span class="p">((</span><span class="s">"OOM"</span><span class="p">));</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">url</span> <span class="o">==</span> <span class="sc">'/'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">url</span> <span class="o">==</span> <span class="sc">':'</span><span class="p">)</span> <span class="o">*</span><span class="n">port_i</span> <span class="o">=</span> <span class="n">addr_len</span><span class="p">;</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">7632</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">7631</span><span class="p">,</span><span class="mi">7</span> <span class="err">@@</span> <span class="k">struct</span> <span class="n">mg_connection</span> <span class="o">*</span><span class="n">mg_connect_http</span><span class="p">(</span><span class="k">struct</span> <span class="n">mg_mgr</span> <span class="o">*</span><span class="n">mgr</span><span class="p">,</span>
    <span class="cm">/* If the port was addred by us, restore the original host. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">port_i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">addr</span><span class="p">[</span><span class="n">port_i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">mg_printf</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="s">"%s %s HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: %s</span><span class="se">\r\n</span><span class="s">Content-Length: %"</span> <span class="n">SIZE_T_FMT</span>
                  <span class="s">"</span><span class="se">\r\n</span><span class="s">%s</span><span class="se">\r\n</span><span class="s">%s"</span><span class="p">,</span>
              <span class="n">post_data</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="s">"GET"</span> <span class="o">:</span> <span class="s">"POST"</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span>
              <span class="n">post_data</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">strlen</span><span class="p">(</span><span class="n">post_data</span><span class="p">),</span>
               <span class="n">extra_headers</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="n">extra_headers</span><span class="p">,</span>
               <span class="n">post_data</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="n">post_data</span><span class="p">);</span>
   <span class="p">}</span>
 
   <span class="n">MG_FREE</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">nc</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="Firefox"></a></p>

<h3 id="project-name-firefox">Project Name: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-5176">Firefox</a></h3>

<p><a name="Iframe injection &amp; content spoofing &amp; scripts execution via json viewer"></a></p>

<h3 id="1-iframe-injection--content-spoofing--scripts-execution-via-json-viewer">1. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-5176">Iframe injection &amp; content spoofing &amp; scripts execution via json viewer</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-5176"><strong>Description</strong></a></p>

<blockquote>
  <p>The JSON Viewer displays clickable hyperlinks for strings that are parseable as URLs, including “javascript:” links. If a JSON file contains malicious JavaScript script embedded as “javascript:” links, users may be tricked into clicking and running this code in the context of the JSON Viewer. This can allow for the theft of cookies and authorization tokens which are accessible to that context. This vulnerability affects Firefox &lt; 60.</p>
</blockquote>

<p><a href="https://bugzilla.mozilla.org/attachment.cgi?id=8957304&amp;action=edit"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       // Render the value (summary) using Reps library.
       return Rep(Object.assign({}, props, {
         cropLimit: 50,
         noGrip: true,
<span class="gd">-        omitLinkHref: false,
</span><span class="gi">+        openLink(str) {
+          try {
+            let u = new URL(str);
+            if (u.protocol == "https:" || u.protocol == "http:") {
+              window.open(str, "_blank");
+            }
+          } catch (ex) { /* the link might be bust, then we do nothing */ }
+        },
</span>       }));
</code></pre></div></div>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1442840"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// omitted
</span></code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="poco"></a></p>

<h3 id="project-name-poco">Project Name: <a href="https://github.com/pocoproject/poco">poco</a></h3>

<p><a name="Zip Decompress Parent Path Injection #1968"></a></p>

<h3 id="1-zip-decompress-parent-path-injection-1968">1. <a href="https://github.com/pocoproject/poco/issues/1968">Zip Decompress Parent Path Injection #1968</a></h3>

<p><a href="https://github.com/pocoproject/poco/issues/1968"><strong>Description</strong></a></p>

<blockquote>
  <p>By manipulation of the Zip input file header, the contents of the zip archive can be written to an arbitrary parent path of the user.</p>
</blockquote>

<blockquote>
  <p>Expected behavior <br />
Throw an exception if filename contains a parent directory reference. isValidPath() (ZipCommon.cpp) should check if the filename contains a tilde character.</p>
</blockquote>

<blockquote>
  <p>Actual behavior <br />
By inserting a tilde-slash (~/) in the filename area of the zip header, files can be written to the user’s home directory.</p>
</blockquote>

<blockquote>
  <p>Steps to reproduce the problem <br />
Use the sample-unzip samle application as follows:</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./sample-unzip -f vuln.zip SOME_OUT_DIR
vuln.zip contains a file foo. foo includes the string bar
</code></pre></div></div>

<p><a href="https://github.com/pocoproject/poco/commit/f5b2cf3dd6976ae53b2f3c9618b0087a0646cc7d"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Zip/src/Decompress.cpp
<span class="gu">@@ -80,7 +80,7 @@ bool Decompress::handleZipEntry(std::istream&amp; zipStream, const ZipLocalFileHeade
</span>		{
			std::string dirName = hdr.getFileName();
			if (!ZipCommon::isValidPath(dirName))
<span class="gd">-				throw ZipException("Illegal entry name " + dirName + " containing parent directory reference");
</span><span class="gi">+				throw ZipException("Illegal entry name " + dirName);
</span>			Poco::Path dir(_outDir, dirName);
			dir.makeDirectory();
			Poco::File aFile(dir);
<span class="gu">@@ -100,7 +100,7 @@ bool Decompress::handleZipEntry(std::istream&amp; zipStream, const ZipLocalFileHeade
</span>		}
 		if (!ZipCommon::isValidPath(fileName))
<span class="gd">-			throw ZipException("Illegal entry name " + fileName + " containing parent directory reference");
</span><span class="gi">+			throw ZipException("Illegal entry name " + fileName);
</span> 		Poco::Path file(fileName);
		file.makeFile();

Zip/src/ZipCommon.cpp
<span class="gu">@@ -21,15 +22,26 @@ namespace Zip {
</span> bool ZipCommon::isValidPath(const std::string&amp; path)
{
<span class="gi">+ 	if (!Path(path).isRelative())
+		return false;
+	if (path == "..")
+		return false;
</span><span class="gd">-	if (path.compare(0, 3, "../") == 0)
</span><span class="gi">+	if ((path.size() &gt;= 3) &amp;&amp; path.compare(0, 3, "../") == 0)
+		return false;
+	if ((path.size() &gt;= 3) &amp;&amp; path.compare(0, 3, "..\\") == 0)
+		return false;
+	if (path.find("/../") != std::string::npos)
+		return false;
+	if (path.find("\\..\\") != std::string::npos)
+		return false;
+	if (path.find("/..\\") != std::string::npos)
</span>		return false;
<span class="gd">-	if (path.compare(0, 3, "..\\") == 0)
</span><span class="gi">+	if (path.find("\\../") != std::string::npos)
</span>		return false;
<span class="gd">-	if (path.find("/..") != std::string::npos)
</span><span class="gi">+	if ((path.size() &gt;= 2) &amp;&amp; path.compare(0, 2, "~/") == 0)
</span>		return false;
<span class="gd">-	if (path.find("\\..") != std::string::npos)
</span><span class="gi">+	if (path.size() &gt; 0 &amp;&amp; (path[0] == '/' || path[0] == '\\'))
</span>		return false;
	return true;
}
</code></pre></div></div>

<p><a href="https://github.com/pocoproject/poco/commit/f5b2cf3dd6976ae53b2f3c9618b0087a0646cc7d"><strong>Full function:</strong></a></p>

<p>see <a href="https://github.com/pocoproject/poco/commit/f5b2cf3dd6976ae53b2f3c9618b0087a0646cc7d">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="CImg"></a></p>

<h3 id="project-name-cimg">Project Name: <a href="https://github.com/dtschump/CImg">CImg</a></h3>

<p><a name="other testcases lead to heap overflow by loading crafted images #185"></a></p>

<h3 id="1-other-testcases-lead-to-heap-overflow-by-loading-crafted-images-185">1. <a href="https://github.com/dtschump/CImg/issues/185">other testcases lead to heap overflow by loading crafted images #185</a></h3>

<p><a href="https://github.com/dtschump/CImg/issues/185"><strong>Description</strong></a></p>

<blockquote>
  <p>An issue was discovered in CImg v.220. A heap-based buffer over-read in load_bmp in CImg.h occurs when loading a crafted bmp image, a different vulnerability than CVE-2018-7588. This is in a Monochrome case, aka case 1.</p>
</blockquote>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -48331,7 +48331,7 @@ namespace cimg_library_suffixed {
</span>      if (header_size&gt;40) cimg::fseek(nfile,header_size - 40,SEEK_CUR);
       const int
<span class="gd">-        dx_bytes = (bpp==1)?(dx/8 + (dx%8?1:0)):((bpp==4)?(dx/2 + (dx%2)):(dx*bpp/8)),
</span><span class="gi">+        dx_bytes = (bpp==1)?(dx/8 + (dx%8?1:0)):((bpp==4)?(dx/2 + (dx%2)):(int)((longT)dx*bpp/8)),
</span>        align_bytes = (4 - dx_bytes%4)%4;
      const ulongT
        cimg_iobuffer = (ulongT)24*1024*1024,
<span class="gu">@@ -48363,10 +48363,10 @@ namespace cimg_library_suffixed {
</span>      }
       // Read pixel data
<span class="gd">-      assign(dx,cimg::abs(dy),1,3);
</span><span class="gi">+      assign(dx,cimg::abs(dy),1,3,0);
</span>      switch (bpp) {
<span class="gd">-      case 1 : { // Monochrome
</span><span class="gi">+        for (int y = height() - 1; y&gt;=0; --y) {
</span>        if (colormap._width&gt;=2) for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
            cimg::fseek(nfile,align_bytes,SEEK_CUR);
<span class="gu">@@ -48384,7 +48384,7 @@ namespace cimg_library_suffixed {
</span>        }
      } break;
      case 4 : { // 16 colors
<span class="gd">-        for (int y = height() - 1; y&gt;=0; --y) {
</span><span class="gi">+        if (colormap._width&gt;=16) for (int y = height() - 1; y&gt;=0; --y) {
</span>          if (buf_size&gt;=cimg_iobuffer) {
            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
            cimg::fseek(nfile,align_bytes,SEEK_CUR);
<span class="gu">@@ -48402,8 +48402,8 @@ namespace cimg_library_suffixed {
</span>          ptrs+=align_bytes;
        }
      } break;
<span class="gd">-      case 8 : { //  256 colors
-        for (int y = height() - 1; y&gt;=0; --y) {
</span><span class="gi">+      case 8 : { // 256 colors
+        if (colormap._width&gt;=256) for (int y = height() - 1; y&gt;=0; --y) {
</span>          if (buf_size&gt;=cimg_iobuffer) {
            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
            cimg::fseek(nfile,align_bytes,SEEK_CUR);
</code></pre></div></div>

<p><a href="https://github.com/dtschump/CImg/commit/10af1e8c1ad2a58a0a3342a856bae63e8f257abb"><strong>Full function:</strong></a></p>

<p>The function is too long, see <a href="https://github.com/dtschump/CImg/commit/10af1e8c1ad2a58a0a3342a856bae63e8f257abb">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="double free when load bmp image #184"></a></p>

<h3 id="2-double-free-when-load-bmp-image-184">2. <a href="https://github.com/dtschump/CImg/issues/184">double free when load bmp image #184</a></h3>

<p><a href="https://github.com/dtschump/CImg/issues/184"><strong>Description</strong></a></p>

<p>An issue was discovered in CImg v.220. A double free in load_bmp in CImg.h occurs when loading a crafted bmp image.</p>

<p><a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -48333,9 +48333,9 @@ namespace cimg_library_suffixed {
</span>      const int
        dx_bytes = (bpp==1)?(dx/8 + (dx%8?1:0)):((bpp==4)?(dx/2 + (dx%2)):(dx*bpp/8)),
        align_bytes = (4 - dx_bytes%4)%4;
<span class="gd">-      const longT
-        cimg_iobuffer = (longT)24*1024*1024,
-        buf_size = std::min((longT)cimg::abs(dy)*(dx_bytes + align_bytes),(longT)file_size - offset);
</span><span class="gi">+      const ulongT
+        cimg_iobuffer = (ulongT)24*1024*1024,
+        buf_size = std::min((ulongT)cimg::abs(dy)*(dx_bytes + align_bytes),(ulongT)file_size - offset);
</span>       CImg&lt;intT&gt; colormap;
      if (bpp&lt;16) { if (!nb_colors) nb_colors = 1&lt;&lt;bpp; } else nb_colors = 0;
<span class="gu">@@ -48368,7 +48368,7 @@ namespace cimg_library_suffixed {
</span>      case 1 : { // Monochrome
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          unsigned char mask = 0x80, val = 0;
<span class="gu">@@ -48386,7 +48386,7 @@ namespace cimg_library_suffixed {
</span>      case 4 : { // 16 colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          unsigned char mask = 0xF0, val = 0;
<span class="gu">@@ -48405,7 +48405,7 @@ namespace cimg_library_suffixed {
</span>      case 8 : { //  256 colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48420,7 +48420,7 @@ namespace cimg_library_suffixed {
</span>      case 16 : { // 16 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48436,7 +48436,7 @@ namespace cimg_library_suffixed {
</span>      case 24 : { // 24 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48450,7 +48450,7 @@ namespace cimg_library_suffixed {
</span>      case 32 : { // 32 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
</code></pre></div></div>

<p><a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="a heap overflow when load a bmp image #183"></a></p>

<h3 id="3-a-heap-overflow-when-load-a-bmp-image-183">3. <a href="">a heap overflow when load a bmp image #183</a></h3>

<p><a href="https://github.com/dtschump/CImg/issues/183"><strong>Description</strong></a></p>

<p>An issue was discovered in CImg v.220. A heap-based buffer over-read in load_bmp in CImg.h occurs when loading a crafted bmp image.</p>

<p><a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -48333,9 +48333,9 @@ namespace cimg_library_suffixed {
</span>      const int
        dx_bytes = (bpp==1)?(dx/8 + (dx%8?1:0)):((bpp==4)?(dx/2 + (dx%2)):(dx*bpp/8)),
        align_bytes = (4 - dx_bytes%4)%4;
<span class="gd">-      const longT
-        cimg_iobuffer = (longT)24*1024*1024,
-        buf_size = std::min((longT)cimg::abs(dy)*(dx_bytes + align_bytes),(longT)file_size - offset);
</span><span class="gi">+      const ulongT
+        cimg_iobuffer = (ulongT)24*1024*1024,
+        buf_size = std::min((ulongT)cimg::abs(dy)*(dx_bytes + align_bytes),(ulongT)file_size - offset);
</span>       CImg&lt;intT&gt; colormap;
      if (bpp&lt;16) { if (!nb_colors) nb_colors = 1&lt;&lt;bpp; } else nb_colors = 0;
<span class="gu">@@ -48368,7 +48368,7 @@ namespace cimg_library_suffixed {
</span>      case 1 : { // Monochrome
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          unsigned char mask = 0x80, val = 0;
<span class="gu">@@ -48386,7 +48386,7 @@ namespace cimg_library_suffixed {
</span>      case 4 : { // 16 colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          unsigned char mask = 0xF0, val = 0;
<span class="gu">@@ -48405,7 +48405,7 @@ namespace cimg_library_suffixed {
</span>      case 8 : { //  256 colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48420,7 +48420,7 @@ namespace cimg_library_suffixed {
</span>      case 16 : { // 16 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48436,7 +48436,7 @@ namespace cimg_library_suffixed {
</span>      case 24 : { // 24 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
<span class="gu">@@ -48450,7 +48450,7 @@ namespace cimg_library_suffixed {
</span>      case 32 : { // 32 bits colors
        for (int y = height() - 1; y&gt;=0; --y) {
          if (buf_size&gt;=cimg_iobuffer) {
<span class="gd">-            cimg::fread(ptrs=buffer._data,dx_bytes,nfile);
</span><span class="gi">+            if (!cimg::fread(ptrs=buffer._data,dx_bytes,nfile)) break;
</span>            cimg::fseek(nfile,align_bytes,SEEK_CUR);
          }
          cimg_forX(*this,x) {
</code></pre></div></div>

<p><a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/dtschump/CImg/commit/8447076ef22322a14a0ce130837e44c5ba8095f4">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="ImageMagick"></a></p>

<h3 id="project-name-imagemagick">Project Name: <a href="https://github.com/ImageMagick/ImageMagick">ImageMagick</a></h3>

<p><a name="heap-buffer-overflow in SVGStripString of svg.c #1336"></a></p>

<h3 id="1-heap-buffer-overflow-in-svgstripstring-of-svgc-1336">1. <a href="https://github.com/ImageMagick/ImageMagick/issues/1336">heap-buffer-overflow in SVGStripString of svg.c #1336</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/1336"><strong>Description</strong></a></p>

<blockquote>
  <p>In ImageMagick 7.0.8-13 Q16, there is a heap-based buffer over-read in the SVGStripString function of coders/svg.c, which allows attackers to cause a denial of service via a crafted SVG image file.</p>
</blockquote>

<p><a href="https://github.com/ImageMagick/ImageMagick6/commit/a5db4873626f702d2ddd8bc293573493e0a412c0"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      {
        for ( ; *p != '\0'; p++)
          if ((*p == '*') &amp;&amp; (*(p+1) == '/'))
<span class="gd">-            break;
</span><span class="gi">+            {
+              p+=2;
+              break;
+            }
</span>        if (*p == '\0')
          break;
<span class="gd">-        p+=2;
</span>      }
    *q++=(*p);
  }
</code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick6/commit/a5db4873626f702d2ddd8bc293573493e0a412c0"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="kt">void</span> <span class="nf">SVGStripString</span><span class="p">(</span><span class="k">const</span> <span class="n">MagickBooleanType</span> <span class="n">trim</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span>
 <span class="p">{</span>
   <span class="k">register</span> <span class="kt">char</span>
     <span class="o">*</span><span class="n">p</span><span class="p">,</span>
     <span class="o">*</span><span class="n">q</span><span class="p">;</span>
 
   <span class="kt">size_t</span>
     <span class="n">length</span><span class="p">;</span>
 
   <span class="n">assert</span><span class="p">(</span><span class="n">message</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">message</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span>
     <span class="k">return</span><span class="p">;</span>
   <span class="cm">/*
     Remove comment.
   */</span>
   <span class="n">q</span><span class="o">=</span><span class="n">message</span><span class="p">;</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">message</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'/'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sc">'*'</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'*'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sc">'/'</span><span class="p">))</span>
            <span class="p">{</span>
              <span class="n">p</span><span class="o">+=</span><span class="mi">2</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="o">*</span><span class="n">q</span><span class="o">++=</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
  <span class="p">}</span>
   <span class="o">*</span><span class="n">q</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">trim</span> <span class="o">!=</span> <span class="n">MagickFalse</span><span class="p">)</span>
     <span class="p">{</span>
       <span class="cm">/*
         Remove whitespace.
       */</span>
       <span class="n">length</span><span class="o">=</span><span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
       <span class="n">p</span><span class="o">=</span><span class="n">message</span><span class="p">;</span>
       <span class="k">while</span> <span class="p">(</span><span class="n">isspace</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
         <span class="n">p</span><span class="o">++</span><span class="p">;</span>
       <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'\''</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">))</span>
         <span class="n">p</span><span class="o">++</span><span class="p">;</span>
       <span class="n">q</span><span class="o">=</span><span class="n">message</span><span class="o">+</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
       <span class="k">while</span> <span class="p">((</span><span class="n">isspace</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="o">*</span><span class="n">q</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">))</span>
         <span class="n">q</span><span class="o">--</span><span class="p">;</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">q</span> <span class="o">==</span> <span class="sc">'\''</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">*</span><span class="n">q</span> <span class="o">==</span> <span class="sc">'"'</span><span class="p">))</span>
           <span class="n">q</span><span class="o">--</span><span class="p">;</span>
       <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">memmove</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">p</span><span class="p">,(</span><span class="kt">size_t</span><span class="p">)</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
       <span class="n">message</span><span class="p">[</span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
     <span class="p">}</span>
   <span class="cm">/*
     Convert newlines to a space.
   */</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">message</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span>
       <span class="o">*</span><span class="n">p</span><span class="o">=</span><span class="sc">' '</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="heap-buffer-overflow in EncodeImage of pict.c #1335"></a></p>

<h3 id="2-heap-buffer-overflow-in-encodeimage-of-pictc-1335">2. <a href="https://github.com/ImageMagick/ImageMagick/issues/1335">heap-buffer-overflow in EncodeImage of pict.c #1335</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/1335"><strong>Description</strong></a></p>

<blockquote>
  <p>In ImageMagick 7.0.8-13 Q16, there is a heap-based buffer over-read in the EncodeImage function of coders/pict.c, which allows attackers to cause a denial of service via a crafted SVG image file.</p>
</blockquote>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -444,7 +444,7 @@ static unsigned char *DecodeImage(Image *blob,Image *image,
</span>    bytes_per_line=width;
  row_bytes=(size_t) (image-&gt;columns | 0x8000);
  if (image-&gt;storage_class == DirectClass)
<span class="gd">-    row_bytes=(size_t) (4*(image-&gt;columns | 0x8000));
</span><span class="gi">+    row_bytes=(size_t) ((4*image-&gt;columns) | 0x8000);
</span>  /*
    Allocate pixel and scanline buffer.
  */
<span class="gu">@@ -1778,7 +1778,7 @@ static MagickBooleanType WritePICTImage(const ImageInfo *image_info,
</span>  /*
    Allocate memory.
  */
<span class="gd">-  bytes_per_line=image-&gt;columns | 0x8000;
</span><span class="gi">+  bytes_per_line=image-&gt;columns;
</span>  if (storage_class == DirectClass)
    bytes_per_line*=image-&gt;alpha_trait != UndefinedPixelTrait ? 4 : 3;
  buffer=(unsigned char *) AcquireQuantumMemory(PictInfoSize,sizeof(*buffer));
<span class="gu">@@ -1799,7 +1799,8 @@ static MagickBooleanType WritePICTImage(const ImageInfo *image_info,
</span>      ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
    }
  (void) memset(scanline,0,row_bytes);
<span class="gd">-  (void) memset(packed_scanline,0,(size_t) (row_bytes+2*MaxCount));
</span><span class="gi">+  (void) memset(packed_scanline,0,(size_t) (row_bytes+2*MaxCount)*
+    sizeof(*packed_scanline));
</span>  /*
    Write header, header size, size bounding box, version, and reserved.
  */
</code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/1a22fc0c8837838e60daecc0bf01648f359dd6fd#diff-9f0be979d8a302c3f34029647fc77cbdR450"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/ImageMagick/ImageMagick/commit/1a22fc0c8837838e60daecc0bf01648f359dd6fd#diff-9f0be979d8a302c3f34029647fc77cbdR450">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="heap-buffer-overflow in MagickCore #1156"></a></p>

<h3 id="3-heap-buffer-overflow-in-magickcore-1156">3. <a href="https://github.com/ImageMagick/ImageMagick/issues/1156">heap-buffer-overflow in MagickCore #1156</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/1156"><strong>Description</strong></a></p>

<blockquote>
  <p>In ImageMagick 7.0.7-37 Q16, SetGrayscaleImage in the quantize.c file allows attackers to cause a heap-based buffer over-read via a crafted file.</p>
</blockquote>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  if (image-&gt;type != GrayscaleType)
    (void) TransformImageColorspace(image,GRAYColorspace,exception);
  if (image-&gt;storage_class == PseudoClass)
<span class="gd">-    colormap_index=(ssize_t *) AcquireQuantumMemory(image-&gt;colors,
</span><span class="gi">+    colormap_index=(ssize_t *) AcquireQuantumMemory(image-&gt;colors+1,
</span>      sizeof(*colormap_index));
  else
<span class="gd">-    colormap_index=(ssize_t *) AcquireQuantumMemory(MaxColormapSize,
</span><span class="gi">+    colormap_index=(ssize_t *) AcquireQuantumMemory(MaxColormapSize+1,
</span>      sizeof(*colormap_index));
  if (colormap_index == (ssize_t *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
</code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/5294966898532a6bd54699fbf04edf18902513ac#diff-b422c231973548d46a04db74c7cb8e58R3448"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/ImageMagick/ImageMagick/commit/5294966898532a6bd54699fbf04edf18902513ac#diff-b422c231973548d46a04db74c7cb8e58R3448">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="heap-buffer-overflow #1009"></a></p>

<h3 id="4-heap-buffer-overflow-1009">4. <a href="https://github.com/ImageMagick/ImageMagick/issues/1009">heap-buffer-overflow #1009</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/1009"><strong>Description</strong></a></p>

<p>In ImageMagick 7.0.7-24 Q16, there is a heap-based buffer over-read in IsWEBPImageLossless in coders/webp.c.</p>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/4f7196b0b7539b113f2580b6a77aa496813d8899"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -181,6 +181,8 @@ static MagickBooleanType IsWEBPImageLossless(const unsigned char *stream,
</span>  /*
    Read simple header.
  */
<span class="gi">+  if (length &lt;= VP8_CHUNK_INDEX)
+    return(MagickFalse);
</span></code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/4f7196b0b7539b113f2580b6a77aa496813d8899"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="n">MagickBooleanType</span> <span class="nf">IsWEBPImageLossless</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span>
   <span class="k">const</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span>
 <span class="p">{</span>
 <span class="cp">#define VP8_CHUNK_INDEX  15
</span> <span class="cp">#define LOSSLESS_FLAG  'L'
</span> <span class="cp">#define EXTENDED_HEADER  'X'
</span> <span class="cp">#define VP8_CHUNK_HEADER  "VP8"
</span> <span class="cp">#define VP8_CHUNK_HEADER_SIZE  3
</span> <span class="cp">#define RIFF_HEADER_SIZE  12
</span> <span class="cp">#define VP8X_CHUNK_SIZE  10
</span> <span class="cp">#define TAG_SIZE  4
</span> <span class="cp">#define CHUNK_SIZE_BYTES  4
</span> <span class="cp">#define CHUNK_HEADER_SIZE  8
</span> <span class="cp">#define MAX_CHUNK_PAYLOAD  (~0U-CHUNK_HEADER_SIZE-1)
</span> 
   <span class="kt">ssize_t</span>
     <span class="n">offset</span><span class="p">;</span>
 
  <span class="cm">/*
    Read simple header.
  */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">VP8_CHUNK_INDEX</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">MagickFalse</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="n">VP8_CHUNK_INDEX</span><span class="p">]</span> <span class="o">!=</span> <span class="n">EXTENDED_HEADER</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="n">VP8_CHUNK_INDEX</span><span class="p">]</span> <span class="o">==</span> <span class="n">LOSSLESS_FLAG</span> <span class="o">?</span> <span class="n">MagickTrue</span> <span class="o">:</span> <span class="n">MagickFalse</span><span class="p">);</span>
  <span class="cm">/*
     Read extended header.
   */</span>
   <span class="n">offset</span><span class="o">=</span><span class="n">RIFF_HEADER_SIZE</span><span class="o">+</span><span class="n">TAG_SIZE</span><span class="o">+</span><span class="n">CHUNK_SIZE_BYTES</span><span class="o">+</span><span class="n">VP8X_CHUNK_SIZE</span><span class="p">;</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">ssize_t</span><span class="p">)</span> <span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="n">TAG_SIZE</span><span class="p">))</span>
   <span class="p">{</span>
     <span class="kt">uint32_t</span>
       <span class="n">chunk_size</span><span class="p">,</span>
       <span class="n">chunk_size_pad</span><span class="p">;</span>
 
     <span class="n">chunk_size</span><span class="o">=</span><span class="n">ReadWebPLSBWord</span><span class="p">(</span><span class="n">stream</span><span class="o">+</span><span class="n">offset</span><span class="o">+</span><span class="n">TAG_SIZE</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">chunk_size</span> <span class="o">&gt;</span> <span class="n">MAX_CHUNK_PAYLOAD</span><span class="p">)</span>
       <span class="k">break</span><span class="p">;</span>
     <span class="n">chunk_size_pad</span><span class="o">=</span><span class="p">(</span><span class="n">CHUNK_HEADER_SIZE</span><span class="o">+</span><span class="n">chunk_size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">stream</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span><span class="n">VP8_CHUNK_HEADER</span><span class="p">,</span><span class="n">VP8_CHUNK_HEADER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
       <span class="k">return</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">stream</span><span class="o">+</span><span class="n">offset</span><span class="o">+</span><span class="n">VP8_CHUNK_HEADER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="n">LOSSLESS_FLAG</span> <span class="o">?</span>
         <span class="n">MagickTrue</span> <span class="o">:</span> <span class="n">MagickFalse</span><span class="p">);</span>
     <span class="n">offset</span><span class="o">+=</span><span class="n">chunk_size_pad</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span><span class="p">(</span><span class="n">MagickFalse</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="Stack over-read in MagickCore/accelerate.c due to type mismatch #967"></a></p>

<h3 id="5-stack-over-read-in-magickcoreacceleratec-due-to-type-mismatch-967">5. <a href="#Stack over-read in MagickCore/accelerate.c due to type mismatch #967">Stack over-read in MagickCore/accelerate.c due to type mismatch #967</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/967"><strong>Description</strong></a></p>

<p>A stack-based buffer over-read in the ComputeResizeImage function in the MagickCore/accelerate.c file of ImageMagick 7.0.7-22 allows a remote attacker to cause a denial of service (application crash) via a maliciously crafted pict file.</p>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/6aa7d5d9a39b6d42a4f6c7eacd6ad2169b68fc4f"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -4325,7 +4325,7 @@ static Image *ComputeResizeImage(const Image* image,MagickCLEnv clEnv,
</span>  for (i = 0; i &lt; 7; i++)
    coefficientBuffer[i]=(float) resizeFilterCoefficient[i];
  cubicCoefficientsBuffer=CreateOpenCLBuffer(device,CL_MEM_COPY_HOST_PTR |
<span class="gd">-    CL_MEM_READ_ONLY,7*sizeof(*cubicCoefficientsBuffer),&amp;coefficientBuffer);
</span><span class="gi">+    CL_MEM_READ_ONLY,sizeof(coefficientBuffer),&amp;coefficientBuffer);
</span></code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/6aa7d5d9a39b6d42a4f6c7eacd6ad2169b68fc4f"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/ImageMagick/ImageMagick/commit/6aa7d5d9a39b6d42a4f6c7eacd6ad2169b68fc4f#diff-8368336e30a67e0e3c22fec282b6baccR4263">here</a>, it has a lot of comparisons.</p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="ArduinoJson"></a></p>

<h3 id="project-name-arduinojson">Project Name: <a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a></h3>

<p><a name="Update QuotedString.cpp #81"></a></p>

<h3 id="1-update-quotedstringcpp-81">1. <a href="https://github.com/bblanchon/ArduinoJson/pull/81">Update QuotedString.cpp #81</a></h3>

<p><a href="https://github.com/bblanchon/ArduinoJson/pull/81"><strong>Description</strong></a></p>

<blockquote>
  <p>The extractFrom function in Internals/QuotedString.cpp in Arduino JSON before 4.5 allows remote attackers to cause a denial of service (crash) via a JSON string with a \ (backslash) followed by a terminator, as demonstrated by “\\0”, which triggers a buffer overflow and over-read.</p>
</blockquote>

<p><a href="https://github.com/bblanchon/ArduinoJson/commit/5e7b9ec688d79e7b16ec7064e1d37e8481a31e72"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -58,46 +58,44 @@ static char unescapeChar(char c) {
</span>static inline bool isQuote(char c) { return c == '\"' || c == '\''; }
<span class="gd">- char *QuotedString::extractFrom(char *input, char **endPtr) {
-  char firstChar = *input;
-   if (!isQuote(firstChar)) {
-    // must start with a quote
-    return NULL;
-  }
-   char stopChar = firstChar;  // closing quote is the same as opening quote
</span>   char *startPtr = input + 1;  // skip the quote
  char *readPtr = startPtr;
  char *writePtr = startPtr;
  char c;
<span class="gi">+   char firstChar = *input;
+  char stopChar = firstChar;  // closing quote is the same as opening quote
+   if (!isQuote(firstChar)) goto ERROR_OPENING_QUOTE_MISSING;
</span>   for (;;) {
    c = *readPtr++;
<span class="gd">-     if (c == '\0') {
-      // premature ending
-      return NULL;
-    }
</span><span class="gi">+    if (c == '\0') goto ERROR_CLOSING_QUOTE_MISSING;
</span><span class="gd">-     if (c == stopChar) {
-      // closing quote
-      break;
-    }
</span><span class="gi">+    if (c == stopChar) goto SUCCESS;
</span>     if (c == '\\') {
      // replace char
      c = unescapeChar(*readPtr++);
<span class="gi">+      if (c == '\0') goto ERROR_ESCAPE_SEQUENCE_INTERRUPTED;
</span>    }
     *writePtr++ = c;
  }
<span class="gi">+ SUCCESS:
</span>  // end the string here
  *writePtr = '\0';
   // update end ptr
  *endPtr = readPtr;
<span class="gi">+   // return pointer to unquoted string
</span>  return startPtr;
<span class="gi">+ ERROR_OPENING_QUOTE_MISSING:
+ ERROR_CLOSING_QUOTE_MISSING:
+ ERROR_ESCAPE_SEQUENCE_INTERRUPTED:
+   return NULL;
</span>}
</code></pre></div></div>

<p><a href="https://github.com/bblanchon/ArduinoJson/commit/5e7b9ec688d79e7b16ec7064e1d37e8481a31e72"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">QuotedString</span><span class="o">::</span><span class="n">extractFrom</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">endPtr</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">firstChar</span> <span class="o">=</span> <span class="o">*</span><span class="n">input</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isQuote</span><span class="p">(</span><span class="n">firstChar</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// must start with a quote
</span>    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="p">}</span>
   <span class="kt">char</span> <span class="n">stopChar</span> <span class="o">=</span> <span class="n">firstChar</span><span class="p">;</span>  <span class="c1">// closing quote is the same as opening quote
</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">startPtr</span> <span class="o">=</span> <span class="n">input</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// skip the quote
</span>  <span class="kt">char</span> <span class="o">*</span><span class="n">readPtr</span> <span class="o">=</span> <span class="n">startPtr</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">writePtr</span> <span class="o">=</span> <span class="n">startPtr</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
   <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">readPtr</span><span class="o">++</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// premature ending
</span>      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">stopChar</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// closing quote
</span>      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\\'</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// replace char
</span>      <span class="n">c</span> <span class="o">=</span> <span class="n">unescapeChar</span><span class="p">(</span><span class="o">*</span><span class="n">readPtr</span><span class="o">++</span><span class="p">);</span>
    <span class="p">}</span>
     <span class="o">*</span><span class="n">writePtr</span><span class="o">++</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// end the string here
</span>  <span class="o">*</span><span class="n">writePtr</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
   <span class="c1">// update end ptr
</span>  <span class="o">*</span><span class="n">endPtr</span> <span class="o">=</span> <span class="n">readPtr</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">startPtr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="get&lt;String&gt; returns -0 for 0 #808"></a></p>

<h3 id="2-get-returns--0-for-0-808httpsgithubcombblanchonarduinojsonissues808">2. [get<String> returns -0 for 0 #808](https://github.com/bblanchon/ArduinoJson/issues/808)</String></h3>

<p><a href="https://github.com/bblanchon/ArduinoJson/issues/808"><strong>Description</strong></a></p>

<blockquote>
  <p>get<String> returns different outputs of 0 for v6.3.0-beta and v6.2.3-beta. In case of v6.3.0-beta it returns "-0" (minus occurs before 0), but in case of v6.2.3-beta it returns "0".</String></p>
</blockquote>

<blockquote>
  <p>Example:</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>char json[] = "{\"x\":0}";
StaticJsonDocument&lt;256&gt; doc;
deserializeJson(doc, json);
JsonObject object = doc.as&lt;JsonObject&gt;();
obj["x_str"] = object.get&lt;String&gt;("x");
obj["x_uint"] = object.get&lt;unsigned int&gt;("x");
</code></pre></div></div>

<blockquote>
  <p>Output in case of v6.3.0-beta:</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_str = "-0"
x_uint = 0
</code></pre></div></div>

<blockquote>
  <p>Output in case of v6.2.3-beta:</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_str = "0"
x_uint = 0
</code></pre></div></div>

<p><a href="https://github.com/bblanchon/ArduinoJson/commit/98c8e8e35a19c7b41ca7b97008867f98415480bc"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -30,13 +30,6 @@ struct JsonVariantData {
</span>    content.asFloat = value;
  }
<span class="gd">-   void setInteger(JsonInteger value) {
-    if (value &gt; 0)
-      setPostiveInteger(static_cast&lt;JsonUInt&gt;(value));
-    else
-      setNegativeInteger(static_cast&lt;JsonUInt&gt;(-value));
-  }
</span>   void setNegativeInteger(JsonUInt value) {
    type = JSON_NEGATIVE_INTEGER;
    content.asInteger = value;
</code></pre></div></div>

<p><a href="https://github.com/bblanchon/ArduinoJson/commit/98c8e8e35a19c7b41ca7b97008867f98415480bc"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kt">void</span> <span class="nf">setInteger</span><span class="p">(</span><span class="n">JsonInteger</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">setPostiveInteger</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">JsonUInt</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="k">else</span>
      <span class="n">setNegativeInteger</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">JsonUInt</span><span class="o">&gt;</span><span class="p">(</span><span class="o">-</span><span class="n">value</span><span class="p">));</span>
  <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="out-of-bounds read in coders/sun.c:582:57 #375"></a></p>

<h3 id="1-out-of-bounds-read-in-coderssunc58257-375">1. <a href="https://github.com/ImageMagick/ImageMagick/issues/375">out-of-bounds read in coders/sun.c:582:57 #375</a></h3>

<p><a href="https://github.com/ImageMagick/ImageMagick/issues/375"><strong>Description</strong></a></p>

<p>An issue was discovered in ImageMagick 6.9.7. A specially crafted sun file triggers a heap-based buffer over-read.</p>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/3007531bfd326c5c1e29cd41d2cd80c166de8528"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -458,7 +458,7 @@ static Image *ReadSUNImage(const ImageInfo *image_info,ExceptionInfo *exception)
</span>        ThrowReaderException(ResourceLimitError,"ImproperImageHeader");
      }
    pixels_length=height*bytes_per_line;
    sun_pixels=(unsigned char *) AcquireQuantumMemory(pixels_length,
    sun_pixels=(unsigned char *) AcquireQuantumMemory(pixels_length+image-&gt;rows,
</code></pre></div></div>

<p><a href="https://github.com/ImageMagick/ImageMagick/commit/3007531bfd326c5c1e29cd41d2cd80c166de8528"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/ImageMagick/ImageMagick/commit/3007531bfd326c5c1e29cd41d2cd80c166de8528#diff-faffa511c4f3a41db200d63cb3cadd9bR303">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="FFmpeg"></a></p>

<h3 id="project-name-ffmpeg">Project Name: <a href="https://github.com/FFmpeg/FFmpeg">FFmpeg</a></h3>

<p><a name="integer overflow and out of array access"></a></p>

<h3 id="1-integer-overflow-and-out-of-array-access">1. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1999011">integer overflow and out of array access</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1999011"><strong>Description</strong></a></p>

<blockquote>
  <p>Buffer Overflow vulnerability in asf_o format demuxer that can result in heap-buffer-overflow that may result in remote code execution. This attack appears to be exploitable via specially crafted ASF file that has to be provided as input to FFmpeg.</p>
</blockquote>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2b46ebdbff1d8dec7a3d8ea280a612b91a582869"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -706,7 +706,8 @@ static int parse_video_info(AVIOContext *pb, AVStream *st)
</span>    st-&gt;codecpar-&gt;codec_id  = ff_codec_get_id(ff_codec_bmp_tags, tag);
    size_bmp = FFMAX(size_asf, size_bmp);
<span class="gd">-    if (size_bmp &gt; BMP_HEADER_SIZE) {
</span><span class="gi">+    if (size_bmp &gt; BMP_HEADER_SIZE &amp;&amp;
+        size_bmp &lt; INT_MAX - AV_INPUT_BUFFER_PADDING_SIZE) {
</span>        int ret;
        st-&gt;codecpar-&gt;extradata_size  = size_bmp - BMP_HEADER_SIZE;
        if (!(st-&gt;codecpar-&gt;extradata = av_malloc(st-&gt;codecpar-&gt;extradata_size +
</code></pre></div></div>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2b46ebdbff1d8dec7a3d8ea280a612b91a582869"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="kt">int</span> <span class="nf">parse_video_info</span><span class="p">(</span><span class="n">AVIOContext</span> <span class="o">*</span><span class="n">pb</span><span class="p">,</span> <span class="n">AVStream</span> <span class="o">*</span><span class="n">st</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="kt">uint16_t</span> <span class="n">size_asf</span><span class="p">;</span> <span class="c1">// ASF-specific Format Data size
</span>     <span class="kt">uint32_t</span> <span class="n">size_bmp</span><span class="p">;</span> <span class="c1">// BMP_HEADER-specific Format Data size
</span>     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tag</span><span class="p">;</span>
 
     <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">width</span>  <span class="o">=</span> <span class="n">avio_rl32</span><span class="p">(</span><span class="n">pb</span><span class="p">);</span>
     <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="n">avio_rl32</span><span class="p">(</span><span class="n">pb</span><span class="p">);</span>
     <span class="n">avio_skip</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// skip reserved flags
</span>     <span class="n">size_asf</span> <span class="o">=</span> <span class="n">avio_rl16</span><span class="p">(</span><span class="n">pb</span><span class="p">);</span>
     <span class="n">tag</span> <span class="o">=</span> <span class="n">ff_get_bmp_header</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size_bmp</span><span class="p">);</span>
     <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">codec_tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">;</span>
    <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">codec_id</span>  <span class="o">=</span> <span class="n">ff_codec_get_id</span><span class="p">(</span><span class="n">ff_codec_bmp_tags</span><span class="p">,</span> <span class="n">tag</span><span class="p">);</span>
    <span class="n">size_bmp</span> <span class="o">=</span> <span class="n">FFMAX</span><span class="p">(</span><span class="n">size_asf</span><span class="p">,</span> <span class="n">size_bmp</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size_bmp</span> <span class="o">&gt;</span> <span class="n">BMP_HEADER_SIZE</span> <span class="o">&amp;&amp;</span>
        <span class="n">size_bmp</span> <span class="o">&lt;</span> <span class="n">INT_MAX</span> <span class="o">-</span> <span class="n">AV_INPUT_BUFFER_PADDING_SIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
        <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata_size</span>  <span class="o">=</span> <span class="n">size_bmp</span> <span class="o">-</span> <span class="n">BMP_HEADER_SIZE</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata</span> <span class="o">=</span> <span class="n">av_malloc</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata_size</span> <span class="o">+</span>
                                                <span class="n">AV_INPUT_BUFFER_PADDING_SIZE</span><span class="p">)))</span> <span class="p">{</span>
             <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
             <span class="k">return</span> <span class="n">AVERROR</span><span class="p">(</span><span class="n">ENOMEM</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="n">memset</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata</span> <span class="o">+</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata_size</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">AV_INPUT_BUFFER_PADDING_SIZE</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">((</span><span class="n">ret</span> <span class="o">=</span> <span class="n">avio_read</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata</span><span class="p">,</span>
                              <span class="n">st</span><span class="o">-&gt;</span><span class="n">codecpar</span><span class="o">-&gt;</span><span class="n">extradata_size</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
             <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="Fix multiple runtime error: index 256 out of bounds"></a></p>

<h3 id="2-fix-multiple-runtime-error-index-256-out-of-bounds">2. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9995">Fix multiple runtime error: index 256 out of bounds</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9995"><strong>Description</strong></a></p>

<p>libavcodec/scpr.c in FFmpeg 3.3 before 3.3.1 does not properly validate height and width data, which allows remote attackers to cause a denial of service (heap-based buffer overflow and application crash) or possibly have unspecified other impact via a crafted file.</p>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2171dfae8c065878a2e130390eb78cf2947a5b69"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gi">+    if (x &gt;= 16 || c &gt;= 256) {
+        return AVERROR_INVALIDDATA;
+    }
</span></code></pre></div></div>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2171dfae8c065878a2e130390eb78cf2947a5b69"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_unit</span><span class="p">(</span><span class="n">SCPRContext</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">PixelModel</span> <span class="o">*</span><span class="n">pixel</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">step</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">*</span><span class="n">rval</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="n">GetByteContext</span> <span class="o">*</span><span class="n">gb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">gb</span><span class="p">;</span>
     <span class="n">RangeCoder</span> <span class="o">*</span><span class="n">rc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="n">totfr</span> <span class="o">=</span> <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">total_freq</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="n">value</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cumfr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">cnt_c</span><span class="p">;</span>
 
     <span class="k">if</span> <span class="p">((</span><span class="n">ret</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">get_freq</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">totfr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
 
     <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">cnt_x</span> <span class="o">=</span> <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">cumfr</span> <span class="o">+</span> <span class="n">cnt_x</span><span class="p">)</span>
             <span class="n">cumfr</span> <span class="o">+=</span> <span class="n">cnt_x</span><span class="p">;</span>
         <span class="k">else</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="n">x</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span>
 
     <span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">16</span><span class="p">;</span>
     <span class="n">cnt_c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">cnt_c</span> <span class="o">=</span> <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">cumfr</span> <span class="o">+</span> <span class="n">cnt_c</span><span class="p">)</span>
             <span class="n">cumfr</span> <span class="o">+=</span> <span class="n">cnt_c</span><span class="p">;</span>
         <span class="k">else</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="n">c</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">16</span> <span class="o">||</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">AVERROR_INVALIDDATA</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="k">if</span> <span class="p">((</span><span class="n">ret</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">decode</span><span class="p">(</span><span class="n">gb</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">cumfr</span><span class="p">,</span> <span class="n">cnt_c</span><span class="p">,</span> <span class="n">totfr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
 
     <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt_c</span> <span class="o">+</span> <span class="n">step</span><span class="p">;</span>
     <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt_x</span> <span class="o">+</span> <span class="n">step</span><span class="p">;</span>
     <span class="n">totfr</span> <span class="o">+=</span> <span class="n">step</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">totfr</span> <span class="o">&gt;</span> <span class="n">BOT</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">totfr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
             <span class="kt">unsigned</span> <span class="n">nc</span> <span class="o">=</span> <span class="p">(</span><span class="n">pixel</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
             <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">;</span>
             <span class="n">totfr</span> <span class="o">+=</span> <span class="n">nc</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
             <span class="kt">unsigned</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
             <span class="kt">unsigned</span> <span class="n">i16_17</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
             <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                 <span class="n">sum</span> <span class="o">+=</span> <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">[</span><span class="n">i16_17</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
             <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="n">pixel</span><span class="o">-&gt;</span><span class="n">total_freq</span> <span class="o">=</span> <span class="n">totfr</span><span class="p">;</span>
 
     <span class="o">*</span><span class="n">rval</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">cbits</span><span class="p">;</span>
 
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="http: make length/offset-related variables unsigned."></a></p>

<h3 id="3-http-make-lengthoffset-related-variables-unsigned">3. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10190">http: make length/offset-related variables unsigned.</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10190"><strong>Description</strong></a></p>

<p>Heap-based buffer overflow in libavformat/http.c in FFmpeg before 2.8.10, 3.0.x before 3.0.5, 3.1.x before 3.1.6, and 3.2.x before 3.2.2 allows remote web servers to execute arbitrary code via a negative chunk size in an HTTP response.</p>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2a05c8f813de6f2278827734bf8102291e7484aa"><strong>Patch code:</strong></a></p>

<p>Too many files edited, see <a href="https://github.com/FFmpeg/FFmpeg/commit/2a05c8f813de6f2278827734bf8102291e7484aa">here</a></p>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2a05c8f813de6f2278827734bf8102291e7484aa"><strong>Full function:</strong></a></p>

<p>Too many files edited, see <a href="https://github.com/FFmpeg/FFmpeg/commit/2a05c8f813de6f2278827734bf8102291e7484aa">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="FFmpeg before 2017-01-24 has an out-of-bounds write caused by a heap-based buffer overflow"></a></p>

<h3 id="4-ffmpeg-before-2017-01-24-has-an-out-of-bounds-write-caused-by-a-heap-based-buffer-overflow">4. <a href="">FFmpeg before 2017-01-24 has an out-of-bounds write caused by a heap-based buffer overflow</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7865"><strong>Description</strong></a></p>

<p>FFmpeg before 2017-01-24 has an out-of-bounds write caused by a heap-based buffer overflow related to the ipvideo_decode_block_opcode_0xA function in libavcodec/interplayvideo.c and the avcodec_align_dimensions2 function in libavcodec/utils.c.</p>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2080bc33717955a0e4268e738acf8c1eeddbf8cb"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -376,6 +376,10 @@ void avcodec_align_dimensions2(AVCodecContext *s, int *width, int *height,
</span>            w_align = 4;
            h_align = 4;
        }
<span class="gi">+        if (s-&gt;codec_id == AV_CODEC_ID_INTERPLAY_VIDEO) {
+            w_align = 8;
+            h_align = 8;
+        }
</span>        break;
    case AV_PIX_FMT_PAL8:
    case AV_PIX_FMT_BGR8:
<span class="gu">@@ -385,7 +389,8 @@ void avcodec_align_dimensions2(AVCodecContext *s, int *width, int *height,
</span>            w_align = 4;
            h_align = 4;
        }
<span class="gd">-        if (s-&gt;codec_id == AV_CODEC_ID_JV) {
</span><span class="gi">+        if (s-&gt;codec_id == AV_CODEC_ID_JV ||
+            s-&gt;codec_id == AV_CODEC_ID_INTERPLAY_VIDEO) {
</span>            w_align = 8;
            h_align = 8;
        }
</code></pre></div></div>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/2080bc33717955a0e4268e738acf8c1eeddbf8cb#diff-d7031e4f689033d5546668b25eb9dd30R260"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/FFmpeg/FFmpeg/commit/2080bc33717955a0e4268e738acf8c1eeddbf8cb#diff-d7031e4f689033d5546668b25eb9dd30R260">here</a>, it has a lot of comparisons.</p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="FFmpeg before 2017-01-23 has an out-of-bounds write caused by a stack-based buffer overflow"></a></p>

<h3 id="5-ffmpeg-before-2017-01-23-has-an-out-of-bounds-write-caused-by-a-stack-based-buffer-overflow">5. <a href="">FFmpeg before 2017-01-23 has an out-of-bounds write caused by a stack-based buffer overflow</a></h3>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7866"><strong>Description</strong></a></p>

<p>FFmpeg before 2017-01-23 has an out-of-bounds write caused by a stack-based buffer overflow related to the decode_zbuf function in libavcodec/pngdec.c.
References</p>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/e371f031b942d73e02c090170975561fabd5c264"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -437,13 +437,13 @@ static int decode_zbuf(AVBPrint *bp, const uint8_t *data,
</span>    av_bprint_init(bp, 0, -1);
     while (zstream.avail_in &gt; 0) {
<span class="gd">-        av_bprint_get_buffer(bp, 1, &amp;buf, &amp;buf_size);
-        if (!buf_size) {
</span><span class="gi">+        av_bprint_get_buffer(bp, 2, &amp;buf, &amp;buf_size);
+        if (buf_size &lt; 2) {
</span>            ret = AVERROR(ENOMEM);
            goto fail;
        }
        zstream.next_out  = buf;
<span class="gd">-        zstream.avail_out = buf_size;
</span><span class="gi">+        zstream.avail_out = buf_size - 1;
</span>        ret = inflate(&amp;zstream, Z_PARTIAL_FLUSH);
        if (ret != Z_OK &amp;&amp; ret != Z_STREAM_END) {
</code></pre></div></div>

<p><a href="https://github.com/FFmpeg/FFmpeg/commit/e371f031b942d73e02c090170975561fabd5c264#diff-1205c376797026cb2296bd451f341c5eR422"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_zbuf</span><span class="p">(</span><span class="n">AVBPrint</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
                        <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data_end</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="n">z_stream</span> <span class="n">zstream</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="n">buf_size</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
 
     <span class="n">zstream</span><span class="p">.</span><span class="n">zalloc</span> <span class="o">=</span> <span class="n">ff_png_zalloc</span><span class="p">;</span>
     <span class="n">zstream</span><span class="p">.</span><span class="n">zfree</span>  <span class="o">=</span> <span class="n">ff_png_zfree</span><span class="p">;</span>
     <span class="n">zstream</span><span class="p">.</span><span class="n">opaque</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">inflateInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstream</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Z_OK</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">AVERROR_EXTERNAL</span><span class="p">;</span>
     <span class="n">zstream</span><span class="p">.</span><span class="n">next_in</span>  <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
     <span class="n">zstream</span><span class="p">.</span><span class="n">avail_in</span> <span class="o">=</span> <span class="n">data_end</span> <span class="o">-</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">av_bprint_init</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">zstream</span><span class="p">.</span><span class="n">avail_in</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">av_bprint_get_buffer</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf_size</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf_size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">av_bprint_get_buffer</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf_size</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">buf_size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">AVERROR</span><span class="p">(</span><span class="n">ENOMEM</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">fail</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">zstream</span><span class="p">.</span><span class="n">next_out</span>  <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
        <span class="n">zstream</span><span class="p">.</span><span class="n">avail_out</span> <span class="o">=</span> <span class="n">buf_size</span><span class="p">;</span>
        <span class="n">zstream</span><span class="p">.</span><span class="n">avail_out</span> <span class="o">=</span> <span class="n">buf_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">inflate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstream</span><span class="p">,</span> <span class="n">Z_PARTIAL_FLUSH</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="n">Z_OK</span> <span class="o">&amp;&amp;</span> <span class="n">ret</span> <span class="o">!=</span> <span class="n">Z_STREAM_END</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">AVERROR_EXTERNAL</span><span class="p">;</span>
             <span class="k">goto</span> <span class="n">fail</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">bp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">+=</span> <span class="n">zstream</span><span class="p">.</span><span class="n">next_out</span> <span class="o">-</span> <span class="n">buf</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">Z_STREAM_END</span><span class="p">)</span>
             <span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">inflateEnd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstream</span><span class="p">);</span>
     <span class="n">bp</span><span class="o">-&gt;</span><span class="n">str</span><span class="p">[</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 
 <span class="nl">fail:</span>
     <span class="n">inflateEnd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstream</span><span class="p">);</span>
     <span class="n">av_bprint_finalize</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
     <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="OpenCV"></a></p>

<h3 id="project-name-opencv">Project Name: <a href="https://github.com/opencv/opencv">OpenCV</a></h3>

<p><a name="Out of bounds write causes Segmentation Fault #9723"></a></p>

<h3 id="1-out-of-bounds-write-causes-segmentation-fault-9723">1. <a href="https://github.com/opencv/opencv/issues/9309">Out of bounds write causes Segmentation Fault #9723</a></h3>

<p><a href="https://github.com/opencv/opencv/issues/9723"><strong>Description</strong></a></p>

<p>In opencv/modules/imgcodecs/src/utils.cpp, functions FillUniColor and FillUniGray do not check the input length, which can lead to integer overflow. If the image is from remote, may lead to remote code execution or denial of service. This affects Opencv 3.3 and earlier.</p>

<p><a href="https://github.com/opencv/opencv/pull/9726/files"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -375,6 +375,9 @@ decode_rle4_bad: ;
</span>                                                gray_palette[code] );
                         line_end_flag = y - prev_y;
<span class="gi">+                         if( y &gt;= m_height )
+                            break;
</span>                    }
                    else if( code &gt; 2 ) // absolute mode
                    {
</code></pre></div></div>

<p><a href="https://github.com/opencv/opencv/pull/9726/files#diff-236c3294512b9353649b64ad8385e984R194"><strong>Full function:</strong></a></p>

<p>too long, see <a href="https://github.com/opencv/opencv/pull/9726/files#diff-236c3294512b9353649b64ad8385e984R194">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="A heap based buffer overflow happens in cv::Jpeg2KDecoder::readComponent8u #10541"></a></p>

<h3 id="1-a-heap-based-buffer-overflow-happens-in-cvjpeg2kdecoderreadcomponent8u-10541">1. <a href="https://github.com/opencv/opencv/issues/10541">A heap based buffer overflow happens in cv::Jpeg2KDecoder::readComponent8u #10541</a></h3>

<p><a href="https://github.com/opencv/opencv/issues/10541"><strong>Description</strong></a></p>

<p>In OpenCV 3.3.1, a heap-based buffer overflow happens in cv::Jpeg2KDecoder::readComponent8u in modules/imgcodecs/src/grfmt_jpeg2000.cpp when parsing a crafted image file.</p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -77,7 +77,8 @@ static JasperInitializer initialize_jasper;
</span> Jpeg2KDecoder::Jpeg2KDecoder()
{
<span class="gd">-    m_signature = '\0' + String() + '\0' + String() + '\0' + String("\x0cjP  \r\n\x87\n");
</span><span class="gi">+    static const unsigned char signature_[12] = { 0, 0, 0, 0x0c, 'j', 'P', ' ', ' ', 13, 10, 0x87, 10};
+    m_signature = String((const char*)signature_, (const char*)signature_ + sizeof(signature_));
</span>    m_stream = 0;
    m_image = 0;
}
<span class="gu">@@ -121,6 +122,8 @@ bool  Jpeg2KDecoder::readHeader()
</span>        jas_image_t* image = jas_image_decode( stream, -1, 0 );
        m_image = image;
        if( image ) {
<span class="gi">+            CV_Assert(0 == (jas_image_tlx(image)) &amp;&amp; "not supported");
+            CV_Assert(0 == (jas_image_tly(image)) &amp;&amp; "not supported");
</span>            m_width = jas_image_width( image );
            m_height = jas_image_height( image );
 @@ -130,14 +133,31 @@ bool  Jpeg2KDecoder::readHeader()
            for( int i = 0; i &lt; numcmpts; i++ )
            {
                int depth_i = jas_image_cmptprec( image, i );
<span class="gi">+                CV_Assert(depth == 0 || depth == depth_i); // component data type mismatch
</span>                depth = MAX(depth, depth_i);
                if( jas_image_cmpttype( image, i ) &gt; 2 )
                    continue;
<span class="gi">+                int sgnd = jas_image_cmptsgnd(image, i);
+                int xstart = jas_image_cmpttlx(image, i);
+                int xend = jas_image_cmptbrx(image, i);
+                int xstep = jas_image_cmpthstep(image, i);
+                int ystart = jas_image_cmpttly(image, i);
+                int yend = jas_image_cmptbry(image, i);
+                int ystep = jas_image_cmptvstep(image, i);
+                CV_Assert(sgnd == 0 &amp;&amp; "not supported");
+                CV_Assert(xstart == 0 &amp;&amp; "not supported");
+                CV_Assert(ystart == 0 &amp;&amp; "not supported");
+                CV_Assert(xstep == 1 &amp;&amp; "not supported");
+                CV_Assert(ystep == 1 &amp;&amp; "not supported");
+                CV_Assert(xend == m_width);
+                CV_Assert(yend == m_height);
</span>                cntcmpts++;
            }
             if( cntcmpts )
            {
<span class="gi">+                CV_Assert(depth == 8 || depth == 16);
+                CV_Assert(cntcmpts == 1 || cntcmpts == 3);
</span>                m_type = CV_MAKETYPE(depth &lt;= 8 ? CV_8U : CV_16U, cntcmpts &gt; 1 ? 3 : 1);
                result = true;
            }
<span class="gu">@@ -150,9 +170,14 @@ bool  Jpeg2KDecoder::readHeader()
</span>    return result;
}
<span class="gi">+ static void Jpeg2KDecoder_close(Jpeg2KDecoder* ptr)
+ {
+    ptr-&gt;close();
+ }
</span> bool  Jpeg2KDecoder::readData( Mat&amp; img )
{
<span class="gi">+    Ptr&lt;Jpeg2KDecoder&gt; close_this(this, Jpeg2KDecoder_close);
</span>    bool result = false;
    int color = img.channels() &gt; 1;
    uchar* data = img.ptr();
<span class="gu">@@ -204,11 +229,16 @@ bool  Jpeg2KDecoder::readData( Mat&amp; img )
</span>                    result = true;
                }
                else
<span class="gd">-                    fprintf(stderr, "JPEG 2000 LOADER ERROR: cannot convert colorspace\n");
</span><span class="gi">+                {
+                     jas_cmprof_destroy(clrprof);
+                     CV_Error(Error::StsError, "JPEG 2000 LOADER ERROR: cannot convert colorspace");
+                }
</span>                jas_cmprof_destroy( clrprof );
            }
            else
<span class="gd">-                fprintf(stderr, "JPEG 2000 LOADER ERROR: unable to create colorspace\n");
</span><span class="gi">+            {
+                CV_Error(Error::StsError, "JPEG 2000 LOADER ERROR: unable to create colorspace");
+            }
</span>        }
        else
            result = true;
<span class="gu">@@ -257,8 +287,8 @@ bool  Jpeg2KDecoder::readData( Mat&amp; img )
</span>                                result = readComponent16u( ((unsigned short *)data) + i, buffer, validateToInt(step / 2), cmptlut[i], maxval, offset, ncmpts );
                            if( !result )
                            {
<span class="gd">-                                i = ncmpts;
-                                result = false;
</span><span class="gi">+                                jas_matrix_destroy( buffer );
+                                CV_Error(Error::StsError, "JPEG2000 LOADER ERROR: failed to read component");
</span>                            }
                        }
                        jas_matrix_destroy( buffer );
<span class="gu">@@ -267,10 +297,12 @@ bool  Jpeg2KDecoder::readData( Mat&amp; img )
</span>            }
        }
        else
<span class="gd">-            fprintf(stderr, "JPEG2000 LOADER ERROR: colorspace conversion failed\n" );
</span><span class="gi">+        {
+            CV_Error(Error::StsError, "JPEG2000 LOADER ERROR: colorspace conversion failed");
+        }
</span>    }
<span class="gd">-     close();
</span><span class="gi">+    CV_Assert(result == true);
</span> #ifndef _WIN32
    if (!clr.empty())
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="json-c"></a></p>

<h3 id="project-name-json-c">Project Name: <a href="https://github.com/json-c/json-c">json-c</a></h3>

<p><a name="Empty strings and unicode zero values break json parsing. #53"></a></p>

<h3 id="1-empty-strings-and-unicode-zero-values-break-json-parsing-53">1. <a href="https://github.com/json-c/json-c/issues/53">Empty strings and unicode zero values break json parsing. #53</a></h3>

<p><a href="https://github.com/json-c/json-c/issues/53"><strong>Description</strong></a></p>

<p>Package: libjson0
Version: 0.10-1.1
Severity: important</p>

<p>If the input JSON contains empty value (i.e. “”) The internal string
buffer is unterminated and unexpected behaviour occours.</p>

<p>If the unicode value <code class="highlighter-rouge">\u0000</code> appears in the input the string is
terminated early and the string is truncated.</p>

<p><a href="https://github.com/json-c/json-c/commit/4e4af93d667ae0d3cb9779f5a3c3f964cc9d7d81"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>json_object.c
<span class="gu">@@ -620,8 +620,9 @@ struct json_object* json_object_new_string_len(const char *s, int len)
</span>  if(!jso) return NULL;
  jso-&gt;_delete = &amp;json_object_string_delete;
  jso-&gt;_to_json_string = &amp;json_object_string_to_json_string;
<span class="gd">-  jso-&gt;o.c_string.str = (char*)malloc(len);
</span><span class="gi">+  jso-&gt;o.c_string.str = (char*)malloc(len + 1);
</span>  memcpy(jso-&gt;o.c_string.str, (void *)s, len);
<span class="gi">+  jso-&gt;o.c_string.str[len] = '\0';
</span>  jso-&gt;o.c_string.len = len;
  return jso;
}
json_tokener.c
<span class="gu">@@ -393,7 +393,7 @@ struct json_object* json_tokener_parse_ex(struct json_tokener *tok,
</span>	while(1) {
	  if(c == tok-&gt;quote_char) {
	    printbuf_memappend_fast(tok-&gt;pb, case_start, str-case_start);
<span class="gd">-	    current = json_object_new_string(tok-&gt;pb-&gt;buf);
</span><span class="gi">+	    current = json_object_new_string_len(tok-&gt;pb-&gt;buf, tok-&gt;pb-&gt;bpos);
</span>	    saved_state = json_tokener_state_finish;
	    state = json_tokener_state_eatws;
	    break;
</code></pre></div></div>

<p><a href="https://github.com/json-c/json-c/commit/4e4af93d667ae0d3cb9779f5a3c3f964cc9d7d81"><strong>Full function:</strong></a></p>

<p>multiple functions edited, see <a href="https://github.com/json-c/json-c/commit/4e4af93d667ae0d3cb9779f5a3c3f964cc9d7d81">here</a></p>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name="jansson"></a></p>

<h3 id="project-name-jansson">Project Name: <a href="https://github.com/akheron/jansson">jansson</a></h3>

<p><a name="Stack exhaustion parsing a JSON file #282"></a></p>

<h3 id="1-stack-exhaustion-parsing-a-json-file-282">1. <a href="https://github.com/akheron/jansson/issues/282">Stack exhaustion parsing a JSON file #282</a></h3>

<p><a href="https://github.com/akheron/jansson/issues/282"><strong>Description</strong></a></p>

<p>Jansson 2.7 and earlier allows context-dependent attackers to cause a denial of service (deep recursion, stack consumption, and crash) via crafted JSON data.</p>

<p><a href="https://github.com/akheron/jansson/pull/284/files"><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>android/jansson_config.h
<span class="gu">@@ -36,4 +36,8 @@
</span>   otherwise to 0. */
#define JSON_HAVE_LOCALECONV 0
<span class="gi">+ /* Maximum recursion depth for parsing JSON input.
+   This limits the depth of e.g. array-within-array constructions. */
+ #define JSON_PARSER_MAX_DEPTH 2048
</span>src/load.c
<span class="gu">@@ -62,6 +62,7 @@ typedef struct {
</span>    stream_t stream;
    strbuffer_t saved_text;
    size_t flags;
<span class="gi">+    size_t depth;
</span>    int token;
    union {
        struct {
<span class="gu">@@ -803,6 +804,12 @@ static json_t *parse_value(lex_t *lex, size_t flags, json_error_t *error)
</span>{
    json_t *json;
<span class="gi">+   lex-&gt;depth++;
+   if(lex-&gt;depth &gt; JSON_PARSER_MAX_DEPTH) {
+       error_set(error, lex, "maximum parsing depth reached");
+       return NULL;
+   }
</span>     switch(lex-&gt;token) {
        case TOKEN_STRING: {
            const char *value = lex-&gt;value.string.val;
<span class="gu">@@ -865,13 +872,16 @@ static json_t *parse_value(lex_t *lex, size_t flags, json_error_t *error)
</span>    if(!json)
        return NULL;
<span class="gi">+   lex-&gt;depth--;
</span>    return json;
}
 static json_t *parse_json(lex_t *lex, size_t flags, json_error_t *error)
{
    json_t *result;
<span class="gi">+    lex-&gt;depth = 0;
</span>    lex_scan(lex, error);
    if(!(flags &amp; JSON_DECODE_ANY)) {
        if(lex-&gt;token != '[' &amp;&amp; lex-&gt;token != '{') {
</code></pre></div></div>

<p><a href="https://github.com/akheron/jansson/pull/284/commits/64ce0ad3731ebd77e02897b07920eadd0e2cc318#diff-04323737e1efd784854c30ab83651c9cR803"><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">static</span> <span class="n">json_t</span> <span class="o">*</span><span class="nf">parse_value</span><span class="p">(</span><span class="n">lex_t</span> <span class="o">*</span><span class="n">lex</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">flags</span><span class="p">,</span> <span class="n">json_error_t</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">json_t</span> <span class="o">*</span><span class="n">json</span><span class="p">;</span>
     <span class="n">lex</span><span class="o">-&gt;</span><span class="n">depth</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lex</span><span class="o">-&gt;</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="n">JSON_PARSER_MAX_DEPTH</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">error_set</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">lex</span><span class="p">,</span> <span class="s">"maximum parsing depth reached"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
     <span class="k">switch</span><span class="p">(</span><span class="n">lex</span><span class="o">-&gt;</span><span class="n">token</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">TOKEN_STRING</span><span class="p">:</span> <span class="p">{</span>
            <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
             <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
 
             <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">JSON_ALLOW_NUL</span><span class="p">))</span> <span class="p">{</span>
                 <span class="k">if</span><span class="p">(</span><span class="n">memchr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span> <span class="p">{</span>
                     <span class="n">error_set</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">lex</span><span class="p">,</span> <span class="s">"</span><span class="se">\\</span><span class="s">u0000 is not allowed without JSON_ALLOW_NUL"</span><span class="p">);</span>
                     <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
                 <span class="p">}</span>
             <span class="p">}</span>
 
             <span class="n">json</span> <span class="o">=</span> <span class="n">jsonp_stringn_nocheck_own</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
             <span class="k">if</span><span class="p">(</span><span class="n">json</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
                 <span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
             <span class="p">}</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
 
         <span class="k">case</span> <span class="n">TOKEN_INTEGER</span><span class="p">:</span> <span class="p">{</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">json_integer</span><span class="p">(</span><span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">);</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
 
         <span class="k">case</span> <span class="n">TOKEN_REAL</span><span class="p">:</span> <span class="p">{</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">json_real</span><span class="p">(</span><span class="n">lex</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">real</span><span class="p">);</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
 
         <span class="k">case</span> <span class="n">TOKEN_TRUE</span><span class="p">:</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">json_true</span><span class="p">();</span>
             <span class="k">break</span><span class="p">;</span>
 
         <span class="k">case</span> <span class="n">TOKEN_FALSE</span><span class="p">:</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">json_false</span><span class="p">();</span>
             <span class="k">break</span><span class="p">;</span>
 
         <span class="k">case</span> <span class="n">TOKEN_NULL</span><span class="p">:</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">json_null</span><span class="p">();</span>
             <span class="k">break</span><span class="p">;</span>
 
         <span class="k">case</span> <span class="sc">'{'</span><span class="p">:</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">parse_object</span><span class="p">(</span><span class="n">lex</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
             <span class="k">break</span><span class="p">;</span>
 
         <span class="k">case</span> <span class="sc">'['</span><span class="p">:</span>
             <span class="n">json</span> <span class="o">=</span> <span class="n">parse_array</span><span class="p">(</span><span class="n">lex</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
             <span class="k">break</span><span class="p">;</span>
 
         <span class="k">case</span> <span class="n">TOKEN_INVALID</span><span class="p">:</span>
             <span class="n">error_set</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">lex</span><span class="p">,</span> <span class="s">"invalid token"</span><span class="p">);</span>
             <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
 
         <span class="nl">default:</span>
             <span class="n">error_set</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">lex</span><span class="p">,</span> <span class="s">"unexpected token"</span><span class="p">);</span>
             <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
     <span class="n">lex</span><span class="o">-&gt;</span><span class="n">depth</span><span class="o">--</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">json</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name-">Project Name: <a href=""></a></h3>

<h3 id="1-">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name--1">Project Name: <a href=""></a></h3>

<h3 id="1--1">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name--2">Project Name: <a href=""></a></h3>

<h3 id="1--2">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name--3">Project Name: <a href=""></a></h3>

<h3 id="1--3">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name--4">Project Name: <a href=""></a></h3>

<h3 id="1--4">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

<p><a name=""></a></p>

<h3 id="project-name--5">Project Name: <a href=""></a></h3>

<h3 id="1--5">1. <a href=""></a></h3>

<p><a href=""><strong>Description</strong></a></p>

<p><a href=""><strong>Patch code:</strong></a></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><a href=""><strong>Full function:</strong></a></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p><strong>Comments</strong>:</p>

<hr />

  <!-- end content -->
  </main>
</div>
      <!-- end subtemplate -->
      </main>
      </div>
      </div>

    </div>
  </body>
</html>
