<!DOCTYPE html>
<!--
  The template is from Eliza Weisman,
  see http://elizas.website
-->
<html>
  <head>
    <meta name="viewport" content="width=720, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta charset="utf-8">
    <title>Current bug templates (Week 2)</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116308654-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-116308654-1');
  </script>
  </head>
  <body>
    <div class="site">

      <div class = "content">
        <main>
      <!-- begin subtemplate -->
            
        <div class="textheader">
          <h1 class="title">
      
      
        Current bug templates (Week 2)
      
          </h1>
      
        </div>
        <div class="content">
<main>
  <!-- begin content -->
  <h2 id="overview">Overview</h2>

<p>Overall, I extract a prototype from this <a href="https://github.com/php/php-src/commit/523f230c831d7b33353203fa34aee4e92ac12bba">bug</a>, the prototype get 2 matches in PHP source code, and the 2 matches are in the same file.</p>

<h2 id="progress">Progress</h2>

<p>So I tried to extract a prototype from this <a href="https://github.com/php/php-src/commit/523f230c831d7b33353203fa34aee4e92ac12bba">bug</a>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>								<span class="n">tmp_line</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
<span class="o">-</span> 		<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
<span class="o">+</span> 		<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
				<span class="o">--</span><span class="n">tmp_line_len</span><span class="p">;</span>
<span class="o">-</span> 			<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\r'</span><span class="p">)</span> <span class="p">{</span>
<span class="o">+</span> 			<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span><span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\r'</span><span class="p">)</span> <span class="p">{</span>
					<span class="o">--</span><span class="n">tmp_line_len</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
</code></pre></div></div>

<p>The function where bug occurs is too long, so I tried to extract one function from the context. Basically the job of this snippet is to send a request, and then check the response code of the request.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// propotype: php-src/ext/standard/http_fopen_wrapper.c
</span><span class="k">static</span> <span class="n">php_stream</span> <span class="o">*</span><span class="nf">php_stream_url_wrap_http_ex</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="p">...</span>
	<span class="n">php_stream_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">ZSTR_VAL</span><span class="p">(</span><span class="n">req_buf</span><span class="p">.</span><span class="n">s</span><span class="p">),</span> <span class="n">ZSTR_LEN</span><span class="p">(</span><span class="n">req_buf</span><span class="p">.</span><span class="n">s</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">php_stream_get_line</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">tmp_line</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp_line_len</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response_code</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">response_code</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
			<span class="k">switch</span><span class="p">(</span><span class="n">response_code</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mi">403</span><span class="p">:</span>
					<span class="n">php_stream_notify_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">PHP_STREAM_NOTIFY_AUTH_RESULT</span><span class="p">,</span>
							<span class="n">tmp_line</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="nl">default:</span>
					<span class="n">php_stream_notify_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">PHP_STREAM_NOTIFY_FAILURE</span><span class="p">,</span>
							<span class="n">tmp_line</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
				<span class="o">--</span><span class="n">tmp_line_len</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span><span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\r'</span><span class="p">)</span> <span class="p">{</span>
					<span class="o">--</span><span class="n">tmp_line_len</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>First I use the regex to search the source code of php:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FOCUS_STMTS</span> <span class="o">=</span> <span class="s">r""".{0,80}write.{0,3200}response.{0,3200}403.{0,3200}==\s*\'\\n\'"""</span>
</code></pre></div></div>

<p>It can only find one snippet of code, thatâ€™s where the bug occurs orginally, see the log:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">:</span><span class="mi">655</span><span class="o">:</span>	<span class="cm">/* send it */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">656</span><span class="o">:</span>	<span class="n">php_stream_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">ZSTR_VAL</span><span class="p">(</span><span class="n">req_buf</span><span class="p">.</span><span class="n">s</span><span class="p">),</span> <span class="n">ZSTR_LEN</span><span class="p">(</span><span class="n">req_buf</span><span class="p">.</span><span class="n">s</span><span class="p">));</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">658</span><span class="o">:</span>	<span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">660</span><span class="o">:</span>	<span class="k">if</span> <span class="p">(</span><span class="n">Z_ISUNDEF_P</span><span class="p">(</span><span class="n">response_header</span><span class="p">))</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">661</span><span class="o">:</span>		<span class="n">array_init</span><span class="p">(</span><span class="n">response_header</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">662</span><span class="o">:</span>	<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">664</span><span class="o">:</span>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">php_stream_eof</span><span class="p">(</span><span class="n">stream</span><span class="p">))</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">665</span><span class="o">:</span>		<span class="kt">size_t</span> <span class="n">tmp_line_len</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">666</span><span class="o">:</span>		<span class="cm">/* get response header */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">668</span><span class="o">:</span>		<span class="k">if</span> <span class="p">(</span><span class="n">php_stream_get_line</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">tmp_line</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp_line_len</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">669</span><span class="o">:</span>			<span class="n">zval</span> <span class="n">http_response</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">671</span><span class="o">:</span>			<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">672</span><span class="o">:</span>				<span class="n">response_code</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">tmp_line</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">673</span><span class="o">:</span>			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">674</span><span class="o">:</span>				<span class="n">response_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">675</span><span class="o">:</span>			<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">676</span><span class="o">:</span>			<span class="k">if</span> <span class="p">(</span><span class="n">context</span> <span class="o">&amp;&amp;</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="p">(</span><span class="n">tmpzval</span> <span class="o">=</span> <span class="n">php_stream_context_get_option</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">"http"</span><span class="p">,</span> <span class="s">"ignore_errors"</span><span class="p">)))</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">677</span><span class="o">:</span>				<span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">zend_is_true</span><span class="p">(</span><span class="n">tmpzval</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">678</span><span class="o">:</span>			<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">679</span><span class="o">:</span>			<span class="cm">/* when we request only the header, don't fail even on error codes */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">680</span><span class="o">:</span>			<span class="k">if</span> <span class="p">((</span><span class="n">options</span> <span class="o">&amp;</span> <span class="n">STREAM_ONLY_GET_HEADERS</span><span class="p">)</span> <span class="o">||</span> <span class="n">ignore_errors</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">681</span><span class="o">:</span>				<span class="n">reqok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">682</span><span class="o">:</span>			<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">684</span><span class="o">:</span>			<span class="cm">/* status codes of 1xx are "informational", and will be followed by a real response
./php-src/ext/standard/http_fopen_wrapper.c:685:			 * e.g "100 Continue". RFC 7231 states that unexpected 1xx status MUST be parsed,
./php-src/ext/standard/http_fopen_wrapper.c:686:			 * and MAY be ignored. As such, we need to skip ahead to the "real" status*/</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">687</span><span class="o">:</span>			<span class="k">if</span> <span class="p">(</span><span class="n">response_code</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="o">&amp;&amp;</span> <span class="n">response_code</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">688</span><span class="o">:</span>				<span class="cm">/* consume lines until we find a line starting 'HTTP/1' */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">689</span><span class="o">:</span>				<span class="k">while</span> <span class="p">(</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">690</span><span class="o">:</span>					<span class="o">!</span><span class="n">php_stream_eof</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">691</span><span class="o">:</span>					<span class="o">&amp;&amp;</span> <span class="n">php_stream_get_line</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">tmp_line</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp_line_len</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">692</span><span class="o">:</span>					<span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="n">tmp_line_len</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">"HTTP/1"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">strncasecmp</span><span class="p">(</span><span class="n">tmp_line</span><span class="p">,</span> <span class="s">"HTTP/1"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">"HTTP/1"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">693</span><span class="o">:</span>				<span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">695</span><span class="o">:</span>				<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">696</span><span class="o">:</span>					<span class="n">response_code</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">tmp_line</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">697</span><span class="o">:</span>				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">698</span><span class="o">:</span>					<span class="n">response_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">699</span><span class="o">:</span>				<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">700</span><span class="o">:</span>			<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">701</span><span class="o">:</span>			<span class="cm">/* all status codes in the 2xx range are defined by the specification as successful;
./php-src/ext/standard/http_fopen_wrapper.c:702:			 * all status codes in the 3xx range are for redirection, and so also should never
./php-src/ext/standard/http_fopen_wrapper.c:703:			 * fail */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">704</span><span class="o">:</span>			<span class="k">if</span> <span class="p">(</span><span class="n">response_code</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">response_code</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">705</span><span class="o">:</span>				<span class="n">reqok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">706</span><span class="o">:</span>			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">707</span><span class="o">:</span>				<span class="k">switch</span><span class="p">(</span><span class="n">response_code</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">708</span><span class="o">:</span>					<span class="k">case</span> <span class="mi">403</span><span class="p">:</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">709</span><span class="o">:</span>						<span class="n">php_stream_notify_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">PHP_STREAM_NOTIFY_AUTH_RESULT</span><span class="p">,</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">710</span><span class="o">:</span>								<span class="n">tmp_line</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">711</span><span class="o">:</span>						<span class="k">break</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">712</span><span class="o">:</span>					<span class="k">default</span><span class="o">:</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">713</span><span class="o">:</span>						<span class="cm">/* safety net in the event tmp_line == NULL */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">714</span><span class="o">:</span>						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tmp_line_len</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">715</span><span class="o">:</span>							<span class="n">tmp_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">716</span><span class="o">:</span>						<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">717</span><span class="o">:</span>						<span class="n">php_stream_notify_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">PHP_STREAM_NOTIFY_FAILURE</span><span class="p">,</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">718</span><span class="o">:</span>								<span class="n">tmp_line</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">719</span><span class="o">:</span>				<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">720</span><span class="o">:</span>			<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">721</span><span class="o">:</span>			<span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span>
<span class="o">-----------------------------------------------------------------------------</span>
</code></pre></div></div>

<p>Then I thought the response code 403 may be too specific, so I removed the response code part and ran the script again, then I got something new (from the same file as the log above):</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">of</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">307</span><span class="o">:</span>		<span class="k">if</span> <span class="p">(</span><span class="n">php_stream_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">ZSTR_VAL</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">s</span><span class="p">),</span> <span class="n">ZSTR_LEN</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">s</span><span class="p">))</span> <span class="o">!=</span> <span class="n">ZSTR_LEN</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">s</span><span class="p">))</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">308</span><span class="o">:</span>			<span class="n">php_stream_wrapper_log_error</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="s">"Cannot connect to HTTPS server through proxy"</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">309</span><span class="o">:</span>			<span class="n">php_stream_close</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">310</span><span class="o">:</span>			<span class="n">stream</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">311</span><span class="o">:</span>		<span class="p">}</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">312</span><span class="o">:</span> 	 	<span class="n">smart_str_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">header</span><span class="p">);</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">314</span><span class="o">:</span> 	 	<span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">315</span><span class="o">:</span> 	 		<span class="kt">char</span> <span class="n">header_line</span><span class="p">[</span><span class="n">HTTP_HEADER_BLOCK_SIZE</span><span class="p">];</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">317</span><span class="o">:</span>			<span class="cm">/* get response header */</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">318</span><span class="o">:</span>			<span class="k">while</span> <span class="p">(</span><span class="n">php_stream_gets</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">header_line</span><span class="p">,</span> <span class="n">HTTP_HEADER_BLOCK_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span><span class="o">/</span><span class="n">php</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="n">http_fopen_wrapper</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">319</span><span class="o">:</span>				<span class="k">if</span> <span class="p">(</span><span class="n">header_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span>
<span class="o">-----------------------------------------------------------------------------</span>
</code></pre></div></div>

<h2 id="problem">Problem</h2>

<p>I think the current the problem is: we want to make the regex more general, but considering the regex we are using now:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">}</span><span class="n">write</span><span class="o">.</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">3200</span><span class="p">}</span><span class="n">response</span><span class="o">.</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">3200</span><span class="p">}</span><span class="o">==</span>\<span class="n">s</span><span class="o">*</span>\<span class="s">'</span><span class="se">\\</span><span class="s">n</span><span class="se">\'</span><span class="err">
</span></code></pre></div></div>

<p>It only has 4 keywords, there are not much things to remove, so I am not sure whatâ€™s the next step, should we just create some new templates, or keep working on this? We can do:</p>

<ul>
  <li>increase or decrease the gap of keywords</li>
  <li>increase or decrease the number of keywords</li>
  <li>(something I donâ€™t know yet)</li>
</ul>

<h2 id="outcome">Outcome</h2>

<p>I have written this <a href="./search.py">Python script</a> to help me with it.</p>

<p>I use this script to scan <a href="https://github.com/php/php-src">the source code of php</a> and an <a href="https://github.com/libming/libming">SWF library</a>, and here is the <a href="./bug_template.log">Log file</a>.</p>

  <!-- end content -->
  </main>
</div>
      <!-- end subtemplate -->
      </main>
      </div>
      </div>

    </div>
  </body>
</html>
