<!DOCTYPE html>
<!--
  The template is from Eliza Weisman,
  see http://elizas.website
-->
<html>
  <head>
    <meta name="viewport" content="width=720, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta charset="utf-8">
    <title>Current bug templates</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116308654-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-116308654-1');
  </script>
  </head>
  <body>
    <div class="site">

      <div class = "content">
        <main>
      <!-- begin subtemplate -->
            
        <div class="textheader">
          <h1 class="title">
      
      
        Current bug templates
      
          </h1>
      
        </div>
        <div class="content">
<main>
  <!-- begin content -->
  <p>I have found three bug templates so far. For each template, we have a <code class="highlighter-rouge">focus statement</code> and several <code class="highlighter-rouge">sensitive statement</code>s, each time the program find a <code class="highlighter-rouge">focus statement</code>, it will try to find <code class="highlighter-rouge">sensitive statement</code>s in the following <code class="highlighter-rouge">n</code> lines of code.</p>

<ul>
  <li>For example, in the following template, the <code class="highlighter-rouge">focus statement</code> is <code class="highlighter-rouge">malloc</code> with a constant, and the program will check if there are <code class="highlighter-rouge">sensitive statement</code>s in the next <code class="highlighter-rouge">n</code> lines of code, which means to check if there are memory manipulation statements, such as <code class="highlighter-rouge">sprintf|memcpy|memmove|strcpy</code>.
    <ul>
      <li><code class="highlighter-rouge">focus statement</code> is <code class="highlighter-rouge">malloc</code> with constant</li>
      <li><code class="highlighter-rouge">sensitive statement</code>s are memory manipulation statements, such as <code class="highlighter-rouge">sprintf|memcpy|memmove|strcpy</code>.</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//malloc a constant with surrounding memory manipulation//
</span>  <span class="o">-</span> <span class="n">t</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
	<span class="o">+</span> <span class="n">t</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="cm">/* Rddd */</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"R%d"</span><span class="p">,</span> <span class="n">act</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">RegisterNumber</span> <span class="p">);</span>
  <span class="c1">// https://github.com/libming/libming/commit/eea2a55a0aa339d47e65c1c8e60068cf3cc20393
</span></code></pre></div></div>

<ul>
  <li>This template is trying to find dynamic array index generated during runtime, because it has the possibility to be out of boundary.
    <ul>
      <li><code class="highlighter-rouge">focus statement</code> is dynamic array index generated during runtime, e.g. the statement inside <code class="highlighter-rouge">[]</code> has operator.</li>
      <li><code class="highlighter-rouge">sensitive statement</code>s are the surrounding <code class="highlighter-rouge">if</code> statements.</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//dynamic calculation of array index with surrounding if branch//
</span>	<span class="o">-</span> <span class="k">if</span> <span class="p">(</span><span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
	<span class="o">+</span> <span class="k">if</span> <span class="p">(</span><span class="n">tmp_line_len</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tmp_line</span><span class="p">[</span><span class="n">tmp_line_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">--</span><span class="n">tmp_line_len</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// https://github.com/php/php-src/commit/523f230c831d7b33353203fa34aee4e92ac12bba
</span></code></pre></div></div>

<ul>
  <li>This template is trying to find potential arithmetic overflow, typically is in the comparsion with calculation of two or more identifier and another identifier/number, because people focus on the comparsion and overlook there is a potential arithmetic overflow.
    <ul>
      <li><code class="highlighter-rouge">focus statement</code> is in the form of <code class="highlighter-rouge">id (op id)+ [&gt;, &lt;] [id, num]</code></li>
      <li><code class="highlighter-rouge">sensitive statement</code>: None</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//possible arithmetic overflow//
</span>  <span class="o">-</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">len</span> <span class="o">&gt;</span> <span class="n">end</span> <span class="p">)</span>
  <span class="o">+</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">end</span> <span class="o">-</span> <span class="n">len</span> <span class="p">)</span>
  <span class="c1">// https://github.com/ARMmbed/mbedtls/commit/5224a7544c95552553e2e6be0b4a789956a6464e
</span></code></pre></div></div>

<h2 id="outcome">Outcome</h2>

<p>I have written this <a href="./search.py">Python script</a> to help me with it.</p>

<p>I use this script to scan <a href="https://github.com/php/php-src">the source code of php</a> and an <a href="https://github.com/libming/libming">SWF library</a>, and here is the <a href="./bug_template.log">Log file</a>.</p>

  <!-- end content -->
  </main>
</div>
      <!-- end subtemplate -->
      </main>
      </div>
      </div>

    </div>
  </body>
</html>
