
    <!DOCTYPE html>
    <html>
    <head>
    <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    table td, table td * {
      vertical-align: top;
    }
    th, td {
      padding: 5px;
      text-align: left;
    }
    </style>
    </head>
    <body>
    
    <center><h2>Testcases</h2></center>
    <table style="width:100%">
    <tr><th>Testcases</th>
    <th>Testcase 0</th><th>Testcase 1</th><th>Testcase 2</th><th>Testcase 3</th><th>Testcase 4</th><th>Testcase 5</th><th>Testcase 6</th><th>Testcase 7</th><th>Testcase 8</th><th>Testcase 9</th></tr><tr><td>Input</td><td>https://github.com/jiahao42</td><td>http://github.com/jiahao42</td><td>http://github.com/jiahao42?tab=repositories</td><td>http://github.com/jiahao42/PASS/issues/6</td><td>http://github.com/jiahao42/PASS/blob/master/build_hook.sh#L6</td><td>http://github.com/jiahao42/?param1=true&param2=false</td><td>http://twitter.com/hashtag/Traffic?src=hashtag_click</td><td>http://twitter.com/wmazurczyk/status/1088728252435349504</td><td>http://ftp.acc.umu.se/mirror/CTAN/macros/latex/contrib/fancyhdr/fancyhdr.pdf</td><td>http://127.0.0.1:4000/</td></tr><tr><td>Output</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></table>
    <center><h2>Signature analysis</h2></center>
    <table style="width:100%">
      <tr>
        <th>Source code</th>
    <th>Signature 0</th><th>Signature 1</th><th>Signature 2</th><th>Signature 3</th><th>Signature 4</th><th>Signature 5</th><th>Signature 6</th><th>Signature 7</th><th>Signature 8</th><th>Signature 9</th></tr><tr><td>#include&nbsp;&lt;stdio.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;stdlib.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;string.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;unistd.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;errno.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;idn2.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;iconv.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;ctype.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;strings.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;stdint.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&lt;limits.h&gt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&quot;wget.h&quot;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#include&nbsp;&quot;../../debugmsg_export.h&quot;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>struct&nbsp;options&nbsp;opt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>enum&nbsp;url_scheme</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_scheme&nbsp;(const&nbsp;char&nbsp;*url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;i;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;supported_schemes[i].leading_string;&nbsp;i++)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(0&nbsp;==&nbsp;strncasecmp&nbsp;(url,&nbsp;supported_schemes[i].leading_string,</td><td>(0,57)<br>(0,2)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strlen&nbsp;(supported_schemes[i].leading_string)))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(supported_schemes[i].flags&nbsp;&amp;&nbsp;scm_disabled))</td><td></td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(enum&nbsp;url_scheme)&nbsp;i;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SCHEME_INVALID;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;SCHEME_INVALID;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>struct&nbsp;iri&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>iri_new&nbsp;(void)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;struct&nbsp;iri&nbsp;*i&nbsp;=&nbsp;xmalloc&nbsp;(sizeof&nbsp;*i);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;i-&gt;uri_encoding&nbsp;=&nbsp;&quot;UTF-8&quot;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;i-&gt;content_encoding&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;i-&gt;orig_url&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;i-&gt;utf8_encode&nbsp;=&nbsp;opt.enable_iri;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;i;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_has_scheme&nbsp;(const&nbsp;char&nbsp;*url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*p&nbsp;=&nbsp;url;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;The&nbsp;first&nbsp;char&nbsp;must&nbsp;be&nbsp;a&nbsp;scheme&nbsp;char.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!*p&nbsp;||&nbsp;!SCHEME_CHAR&nbsp;(*p))</td><td>(104,0)<br>(8,0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;++p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Followed&nbsp;by&nbsp;0&nbsp;or&nbsp;more&nbsp;scheme&nbsp;chars.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;while&nbsp;(*p&nbsp;&amp;&amp;&nbsp;SCHEME_CHAR&nbsp;(*p))</td><td>(116,0)<br>(8,0)<br>(116,0)<br>(8,0)<br>(112,0)<br>(8,0)<br>(115,0)<br>(8,0)<br>(58,0)<br>(0,0)<br>(58,45)<br>(58,43)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;++p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Terminated&nbsp;by&nbsp;&#x27;:&#x27;.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;*p&nbsp;==&nbsp;&#x27;:&#x27;;</td><td>(58,58)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_escape_1&nbsp;(const&nbsp;char&nbsp;*s,&nbsp;unsigned&nbsp;char&nbsp;mask,&nbsp;bool&nbsp;allow_passthrough)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*p1;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*p2,&nbsp;*newstr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;newlen;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;addition&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(p1&nbsp;=&nbsp;s;&nbsp;*p1;&nbsp;p1++)</td><td></td><td></td><td></td><td></td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td></td><td></td><td></td><td></td><td>(49,0)<br>(50,0)<br>(55,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(49,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(urlchr_test&nbsp;(*p1,&nbsp;mask))</td><td></td><td></td><td></td><td></td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td></td><td></td><td></td><td></td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addition&nbsp;+=&nbsp;2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Two&nbsp;more&nbsp;characters&nbsp;(hex&nbsp;digits)&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!addition)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;allow_passthrough&nbsp;?&nbsp;(char&nbsp;*)s&nbsp;:&nbsp;xstrdup&nbsp;(s);</td><td></td><td></td><td></td><td></td><td>(1,0)</td><td></td><td></td><td></td><td></td><td>(1,0)</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;newlen&nbsp;=&nbsp;(p1&nbsp;-&nbsp;s)&nbsp;+&nbsp;addition;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;newstr&nbsp;=&nbsp;xmalloc&nbsp;(newlen&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p1&nbsp;=&nbsp;s;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p2&nbsp;=&nbsp;newstr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;while&nbsp;(*p1)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Quote&nbsp;the&nbsp;characters&nbsp;that&nbsp;match&nbsp;the&nbsp;test&nbsp;mask.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(urlchr_test&nbsp;(*p1,&nbsp;mask))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;c&nbsp;=&nbsp;*p1++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;&#x27;%&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(c&nbsp;&gt;&gt;&nbsp;4);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(c&nbsp;&amp;&nbsp;0xf);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;*p1++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*p2&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;newstr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_unescape_1&nbsp;(char&nbsp;*s,&nbsp;unsigned&nbsp;char&nbsp;mask)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*t&nbsp;=&nbsp;s;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;t&nbsp;-&nbsp;tortoise&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*h&nbsp;=&nbsp;s;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;h&nbsp;-&nbsp;hare&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(;&nbsp;*h;&nbsp;h++,&nbsp;t++)</td><td></td><td>(0,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(0,0)</td><td>(0,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(0,0)</td><td>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(47,0)<br>(80,0)<br>(65,0)<br>(83,0)<br>(83,0)<br>(47,0)<br>(105,0)<br>(115,0)<br>(115,0)<br>(117,0)<br>(101,0)<br>(115,0)<br>(0,0)<br>(54,0)<br>(0,0)</td><td>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(47,0)<br>(80,0)<br>(65,0)<br>(83,0)<br>(83,0)<br>(47,0)<br>(98,0)<br>(108,0)<br>(111,0)<br>(98,0)<br>(47,0)<br>(109,0)<br>(97,0)<br>(115,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(0,0)<br>(98,0)<br>(117,0)<br>(105,0)<br>(108,0)<br>(100,0)<br>(95,0)<br>(104,0)<br>(111,0)<br>(111,0)<br>(107,0)<br>(46,0)<br>(115,0)<br>(104,0)<br>(0,0)</td><td>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(0,0)<br>(0,0)</td><td>(104,0)<br>(97,0)<br>(115,0)<br>(104,0)<br>(116,0)<br>(97,0)<br>(103,0)<br>(0,0)<br>(84,0)<br>(114,0)<br>(97,0)<br>(102,0)<br>(102,0)<br>(105,0)<br>(99,0)<br>(0,0)</td><td>(119,0)<br>(109,0)<br>(97,0)<br>(122,0)<br>(117,0)<br>(114,0)<br>(99,0)<br>(122,0)<br>(121,0)<br>(107,0)<br>(47,0)<br>(115,0)<br>(116,0)<br>(97,0)<br>(116,0)<br>(117,0)<br>(115,0)<br>(0,0)<br>(49,0)<br>(48,0)<br>(56,0)<br>(56,0)<br>(55,0)<br>(50,0)<br>(56,0)<br>(50,0)<br>(53,0)<br>(50,0)<br>(52,0)<br>(51,0)<br>(53,0)<br>(51,0)<br>(52,0)<br>(57,0)<br>(53,0)<br>(48,0)<br>(52,0)<br>(0,0)</td><td>(109,0)<br>(105,0)<br>(114,0)<br>(114,0)<br>(111,0)<br>(114,0)<br>(47,0)<br>(67,0)<br>(84,0)<br>(65,0)<br>(78,0)<br>(47,0)<br>(109,0)<br>(97,0)<br>(99,0)<br>(114,0)<br>(111,0)<br>(115,0)<br>(47,0)<br>(108,0)<br>(97,0)<br>(116,0)<br>(101,0)<br>(120,0)<br>(47,0)<br>(99,0)<br>(111,0)<br>(110,0)<br>(116,0)<br>(114,0)<br>(105,0)<br>(98,0)<br>(47,0)<br>(102,0)<br>(97,0)<br>(110,0)<br>(99,0)<br>(121,0)<br>(104,0)<br>(100,0)<br>(114,0)<br>(0,0)<br>(102,0)<br>(97,0)<br>(110,0)<br>(99,0)<br>(121,0)<br>(104,0)<br>(100,0)<br>(114,0)<br>(46,0)<br>(112,0)<br>(100,0)<br>(102,0)<br>(0,0)</td><td>(0,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(*h&nbsp;!=&nbsp;&#x27;%&#x27;)</td><td></td><td>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)</td><td>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)</td><td>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(47,37)<br>(80,37)<br>(65,37)<br>(83,37)<br>(83,37)<br>(47,37)<br>(105,37)<br>(115,37)<br>(115,37)<br>(117,37)<br>(101,37)<br>(115,37)<br>(54,37)</td><td>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(47,37)<br>(80,37)<br>(65,37)<br>(83,37)<br>(83,37)<br>(47,37)<br>(98,37)<br>(108,37)<br>(111,37)<br>(98,37)<br>(47,37)<br>(109,37)<br>(97,37)<br>(115,37)<br>(116,37)<br>(101,37)<br>(114,37)<br>(98,37)<br>(117,37)<br>(105,37)<br>(108,37)<br>(100,37)<br>(95,37)<br>(104,37)<br>(111,37)<br>(111,37)<br>(107,37)<br>(46,37)<br>(115,37)<br>(104,37)</td><td>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)</td><td>(104,37)<br>(97,37)<br>(115,37)<br>(104,37)<br>(116,37)<br>(97,37)<br>(103,37)<br>(84,37)<br>(114,37)<br>(97,37)<br>(102,37)<br>(102,37)<br>(105,37)<br>(99,37)</td><td>(119,37)<br>(109,37)<br>(97,37)<br>(122,37)<br>(117,37)<br>(114,37)<br>(99,37)<br>(122,37)<br>(121,37)<br>(107,37)<br>(47,37)<br>(115,37)<br>(116,37)<br>(97,37)<br>(116,37)<br>(117,37)<br>(115,37)<br>(49,37)<br>(48,37)<br>(56,37)<br>(56,37)<br>(55,37)<br>(50,37)<br>(56,37)<br>(50,37)<br>(53,37)<br>(50,37)<br>(52,37)<br>(51,37)<br>(53,37)<br>(51,37)<br>(52,37)<br>(57,37)<br>(53,37)<br>(48,37)<br>(52,37)</td><td>(109,37)<br>(105,37)<br>(114,37)<br>(114,37)<br>(111,37)<br>(114,37)<br>(47,37)<br>(67,37)<br>(84,37)<br>(65,37)<br>(78,37)<br>(47,37)<br>(109,37)<br>(97,37)<br>(99,37)<br>(114,37)<br>(111,37)<br>(115,37)<br>(47,37)<br>(108,37)<br>(97,37)<br>(116,37)<br>(101,37)<br>(120,37)<br>(47,37)<br>(99,37)<br>(111,37)<br>(110,37)<br>(116,37)<br>(114,37)<br>(105,37)<br>(98,37)<br>(47,37)<br>(102,37)<br>(97,37)<br>(110,37)<br>(99,37)<br>(121,37)<br>(104,37)<br>(100,37)<br>(114,37)<br>(102,37)<br>(97,37)<br>(110,37)<br>(99,37)<br>(121,37)<br>(104,37)<br>(100,37)<br>(114,37)<br>(46,37)<br>(112,37)<br>(100,37)<br>(102,37)</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copychar:</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t&nbsp;=&nbsp;*h;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;c;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Do&nbsp;nothing&nbsp;if&nbsp;&#x27;%&#x27;&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hex&nbsp;digits.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!h[1]&nbsp;||&nbsp;!h[2]&nbsp;||&nbsp;!(c_isxdigit&nbsp;(h[1])&nbsp;&amp;&amp;&nbsp;c_isxdigit&nbsp;(h[2])))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;copychar;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;X2DIGITS_TO_NUM&nbsp;(h[1],&nbsp;h[2]);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(urlchr_test(c,&nbsp;mask))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;copychar;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Don&#x27;t&nbsp;unescape&nbsp;%00&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;to&nbsp;insert&nbsp;it</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;into&nbsp;a&nbsp;C&nbsp;string&nbsp;without&nbsp;effectively&nbsp;truncating&nbsp;it.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c&nbsp;==&nbsp;&#x27;\0&#x27;)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;copychar;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t&nbsp;=&nbsp;c;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;+=&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*t&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_unescape_except_reserved&nbsp;(char&nbsp;*s)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape_1&nbsp;(s,&nbsp;urlchr_reserved);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_unescape&nbsp;(char&nbsp;*s)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape_1&nbsp;(s,&nbsp;0);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>strdupdelim&nbsp;(const&nbsp;char&nbsp;*beg,&nbsp;const&nbsp;char&nbsp;*end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(beg&nbsp;&amp;&amp;&nbsp;beg&nbsp;&lt;=&nbsp;end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*res&nbsp;=&nbsp;xmalloc&nbsp;(end&nbsp;-&nbsp;beg&nbsp;+&nbsp;1);</td><td></td><td>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();<br>malloc();</td><td>malloc();<br>malloc();</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy&nbsp;(res,&nbsp;beg,&nbsp;end&nbsp;-&nbsp;beg);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res[end&nbsp;-&nbsp;beg]&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;res;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;xstrdup(&quot;&quot;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>do_conversion&nbsp;(const&nbsp;char&nbsp;*tocode,&nbsp;const&nbsp;char&nbsp;*fromcode,&nbsp;char&nbsp;const&nbsp;*in_org,&nbsp;size_t&nbsp;inlen,&nbsp;char&nbsp;**out)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;iconv_t&nbsp;cd;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;sXXXav&nbsp;:&nbsp;hummm&nbsp;hard&nbsp;to&nbsp;guess...&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;size_t&nbsp;len,&nbsp;done,&nbsp;outlen;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;invalid&nbsp;=&nbsp;0,&nbsp;tooshort&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*s,&nbsp;*in,&nbsp;*in_save;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;cd&nbsp;=&nbsp;iconv_open&nbsp;(tocode,&nbsp;fromcode);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(cd&nbsp;==&nbsp;(iconv_t)(-1))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logprintf&nbsp;(LOG_VERBOSE,&nbsp;_(&quot;Conversion&nbsp;from&nbsp;%s&nbsp;to&nbsp;%s&nbsp;isn&#x27;t&nbsp;supported\n&quot;),</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote&nbsp;(fromcode),&nbsp;quote&nbsp;(tocode));</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*out&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;iconv()&nbsp;has&nbsp;to&nbsp;work&nbsp;on&nbsp;an&nbsp;unescaped&nbsp;string&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;in_save&nbsp;=&nbsp;in&nbsp;=&nbsp;xstrndup&nbsp;(in_org,&nbsp;inlen);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape_except_reserved&nbsp;(in);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;inlen&nbsp;=&nbsp;strlen(in);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;len&nbsp;=&nbsp;outlen&nbsp;=&nbsp;inlen&nbsp;*&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*out&nbsp;=&nbsp;s&nbsp;=&nbsp;xmalloc&nbsp;(outlen&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;done&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(;;)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iconv&nbsp;(cd,&nbsp;(ICONV_CONST&nbsp;char&nbsp;**)&nbsp;&amp;in,&nbsp;&amp;inlen,&nbsp;out,&nbsp;&amp;outlen)&nbsp;!=&nbsp;(size_t)(-1)&nbsp;&amp;&amp;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iconv&nbsp;(cd,&nbsp;NULL,&nbsp;NULL,&nbsp;out,&nbsp;&amp;outlen)&nbsp;!=&nbsp;(size_t)(-1))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*out&nbsp;=&nbsp;s;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(s&nbsp;+&nbsp;len&nbsp;-&nbsp;outlen&nbsp;-&nbsp;done)&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree(in_save);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iconv_close(cd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Incomplete&nbsp;or&nbsp;invalid&nbsp;multibyte&nbsp;sequence&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(errno&nbsp;==&nbsp;EINVAL&nbsp;||&nbsp;errno&nbsp;==&nbsp;EILSEQ)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if&nbsp;(!invalid)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logprintf&nbsp;(LOG_VERBOSE,&nbsp;(&quot;Incomplete&nbsp;or&nbsp;invalid&nbsp;multibyte&nbsp;sequence&nbsp;encountered\n&quot;));</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**out&nbsp;=&nbsp;*in;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inlen--;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*out)++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outlen--;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(errno&nbsp;==&nbsp;E2BIG)&nbsp;/*&nbsp;Output&nbsp;buffer&nbsp;full&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tooshort++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done&nbsp;=&nbsp;len;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;=&nbsp;outlen&nbsp;=&nbsp;done&nbsp;+&nbsp;inlen&nbsp;*&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;xrealloc&nbsp;(s,&nbsp;outlen&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*out&nbsp;=&nbsp;s&nbsp;+&nbsp;done;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;/*&nbsp;Weird,&nbsp;we&nbsp;got&nbsp;an&nbsp;unspecified&nbsp;error&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logprintf&nbsp;(LOG_VERBOSE,&nbsp;_(&quot;Unhandled&nbsp;errno&nbsp;%d\n&quot;),&nbsp;errno);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;xfree(in_save);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;iconv_close(cd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>full_path_write&nbsp;(const&nbsp;struct&nbsp;url&nbsp;*url,&nbsp;char&nbsp;*where)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#define&nbsp;FROB(el,&nbsp;chr)&nbsp;do&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*f_el&nbsp;=&nbsp;url-&gt;el;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(f_el)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;l&nbsp;=&nbsp;strlen&nbsp;(f_el);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*where++&nbsp;=&nbsp;chr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;memcpy&nbsp;(where,&nbsp;f_el,&nbsp;l);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;+=&nbsp;l;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}&nbsp;while&nbsp;(0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(path,&nbsp;&#x27;/&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(params,&nbsp;&#x27;;&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(query,&nbsp;&#x27;?&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#undef&nbsp;FROB</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>path_simplify&nbsp;(enum&nbsp;url_scheme&nbsp;scheme,&nbsp;char&nbsp;*path)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*h&nbsp;=&nbsp;path;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;hare&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*t&nbsp;=&nbsp;path;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;tortoise&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*beg&nbsp;=&nbsp;path;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*end&nbsp;=&nbsp;strchr&nbsp;(path,&nbsp;&#x27;\0&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;while&nbsp;(h&nbsp;&lt;&nbsp;end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Hare&nbsp;should&nbsp;be&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path&nbsp;element.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(h[0]&nbsp;==&nbsp;&#x27;.&#x27;&nbsp;&amp;&amp;&nbsp;(h[1]&nbsp;==&nbsp;&#x27;/&#x27;&nbsp;||&nbsp;h[1]&nbsp;==&nbsp;&#x27;\0&#x27;))</td><td></td><td>(106,46)</td><td>(106,46)</td><td>(106,46)<br>(80,46)<br>(105,46)<br>(54,46)</td><td>(106,46)<br>(80,46)<br>(98,46)<br>(109,46)<br>(98,46)</td><td>(106,46)</td><td>(104,46)<br>(84,46)</td><td>(119,46)<br>(115,46)<br>(49,46)</td><td>(109,46)<br>(67,46)<br>(109,46)<br>(108,46)<br>(99,46)<br>(102,46)<br>(102,46)</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Ignore&nbsp;&quot;./&quot;.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;+=&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(h[0]&nbsp;==&nbsp;&#x27;.&#x27;&nbsp;&amp;&amp;&nbsp;h[1]&nbsp;==&nbsp;&#x27;.&#x27;&nbsp;&amp;&amp;&nbsp;(h[2]&nbsp;==&nbsp;&#x27;/&#x27;&nbsp;||&nbsp;h[2]&nbsp;==&nbsp;&#x27;\0&#x27;))</td><td></td><td>(106,46)</td><td>(106,46)</td><td>(106,46)<br>(80,46)<br>(105,46)<br>(54,46)</td><td>(106,46)<br>(80,46)<br>(98,46)<br>(109,46)<br>(98,46)</td><td>(106,46)</td><td>(104,46)<br>(84,46)</td><td>(119,46)<br>(115,46)<br>(49,46)</td><td>(109,46)<br>(67,46)<br>(109,46)<br>(108,46)<br>(99,46)<br>(102,46)<br>(102,46)</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Handle&nbsp;&quot;../&quot;&nbsp;by&nbsp;retreating&nbsp;the&nbsp;tortoise&nbsp;by&nbsp;one&nbsp;path</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element&nbsp;--&nbsp;but&nbsp;not&nbsp;past&nbsp;beginning.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(t&nbsp;&gt;&nbsp;beg)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Move&nbsp;backwards&nbsp;until&nbsp;T&nbsp;hits&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;path&nbsp;element&nbsp;or&nbsp;the&nbsp;beginning&nbsp;of&nbsp;path.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(--t;&nbsp;t&nbsp;&gt;&nbsp;beg&nbsp;&amp;&amp;&nbsp;t[-1]&nbsp;!=&nbsp;&#x27;/&#x27;;&nbsp;t--)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(scheme&nbsp;==&nbsp;SCHEME_FTP</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#ifdef&nbsp;HAVE_SSL</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;scheme&nbsp;==&nbsp;SCHEME_FTPS</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#endif</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;If&nbsp;we&#x27;re&nbsp;at&nbsp;the&nbsp;beginning,&nbsp;copy&nbsp;the&nbsp;&quot;../&quot;&nbsp;literally</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;move&nbsp;the&nbsp;beginning&nbsp;so&nbsp;a&nbsp;later&nbsp;&quot;..&quot;&nbsp;doesn&#x27;t&nbsp;remove</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it.&nbsp;&nbsp;This&nbsp;violates&nbsp;RFC&nbsp;3986;&nbsp;but&nbsp;we&nbsp;do&nbsp;it&nbsp;for&nbsp;FTP</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anyway&nbsp;because&nbsp;there&nbsp;is&nbsp;otherwise&nbsp;no&nbsp;way&nbsp;to&nbsp;get&nbsp;at&nbsp;a</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent&nbsp;directory,&nbsp;when&nbsp;the&nbsp;FTP&nbsp;server&nbsp;drops&nbsp;us&nbsp;in&nbsp;a</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non-root&nbsp;directory&nbsp;(which&nbsp;is&nbsp;not&nbsp;uncommon).&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beg&nbsp;=&nbsp;t&nbsp;+&nbsp;3;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;regular;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;+=&nbsp;3;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regular:</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;A&nbsp;regular&nbsp;path&nbsp;element.&nbsp;&nbsp;If&nbsp;H&nbsp;hasn&#x27;t&nbsp;advanced&nbsp;past&nbsp;T,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simply&nbsp;skip&nbsp;to&nbsp;the&nbsp;next&nbsp;path&nbsp;element.&nbsp;&nbsp;Otherwise,&nbsp;copy</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;path&nbsp;element&nbsp;until&nbsp;the&nbsp;next&nbsp;slash.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(t&nbsp;==&nbsp;h)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Skip&nbsp;the&nbsp;path&nbsp;element,&nbsp;including&nbsp;the&nbsp;slash.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(h&nbsp;&lt;&nbsp;end&nbsp;&amp;&amp;&nbsp;*h&nbsp;!=&nbsp;&#x27;/&#x27;)</td><td></td><td>(106,47)<br>(105,47)<br>(97,47)<br>(104,47)<br>(97,47)<br>(111,47)<br>(52,47)<br>(50,47)</td><td>(106,47)<br>(105,47)<br>(97,47)<br>(104,47)<br>(97,47)<br>(111,47)<br>(52,47)<br>(50,47)</td><td>(106,47)<br>(105,47)<br>(97,47)<br>(104,47)<br>(97,47)<br>(111,47)<br>(52,47)<br>(50,47)<br>(47,47)<br>(80,47)<br>(65,47)<br>(83,47)<br>(83,47)<br>(47,47)<br>(105,47)<br>(115,47)<br>(115,47)<br>(117,47)<br>(101,47)<br>(115,47)<br>(47,47)<br>(54,47)</td><td>(106,47)<br>(105,47)<br>(97,47)<br>(104,47)<br>(97,47)<br>(111,47)<br>(52,47)<br>(50,47)<br>(47,47)<br>(80,47)<br>(65,47)<br>(83,47)<br>(83,47)<br>(47,47)<br>(98,47)<br>(108,47)<br>(111,47)<br>(98,47)<br>(47,47)<br>(109,47)<br>(97,47)<br>(115,47)<br>(116,47)<br>(101,47)<br>(114,47)<br>(47,47)<br>(98,47)<br>(117,47)<br>(105,47)<br>(108,47)<br>(100,47)<br>(95,47)<br>(104,47)<br>(111,47)<br>(111,47)<br>(107,47)<br>(46,47)<br>(115,47)<br>(104,47)</td><td>(106,47)<br>(105,47)<br>(97,47)<br>(104,47)<br>(97,47)<br>(111,47)<br>(52,47)<br>(50,47)<br>(47,47)</td><td>(104,47)<br>(97,47)<br>(115,47)<br>(104,47)<br>(116,47)<br>(97,47)<br>(103,47)<br>(47,47)<br>(84,47)<br>(114,47)<br>(97,47)<br>(102,47)<br>(102,47)<br>(105,47)<br>(99,47)</td><td>(119,47)<br>(109,47)<br>(97,47)<br>(122,47)<br>(117,47)<br>(114,47)<br>(99,47)<br>(122,47)<br>(121,47)<br>(107,47)<br>(47,47)<br>(115,47)<br>(116,47)<br>(97,47)<br>(116,47)<br>(117,47)<br>(115,47)<br>(47,47)<br>(49,47)<br>(48,47)<br>(56,47)<br>(56,47)<br>(55,47)<br>(50,47)<br>(56,47)<br>(50,47)<br>(53,47)<br>(50,47)<br>(52,47)<br>(51,47)<br>(53,47)<br>(51,47)<br>(52,47)<br>(57,47)<br>(53,47)<br>(48,47)<br>(52,47)</td><td>(109,47)<br>(105,47)<br>(114,47)<br>(114,47)<br>(111,47)<br>(114,47)<br>(47,47)<br>(67,47)<br>(84,47)<br>(65,47)<br>(78,47)<br>(47,47)<br>(109,47)<br>(97,47)<br>(99,47)<br>(114,47)<br>(111,47)<br>(115,47)<br>(47,47)<br>(108,47)<br>(97,47)<br>(116,47)<br>(101,47)<br>(120,47)<br>(47,47)<br>(99,47)<br>(111,47)<br>(110,47)<br>(116,47)<br>(114,47)<br>(105,47)<br>(98,47)<br>(47,47)<br>(102,47)<br>(97,47)<br>(110,47)<br>(99,47)<br>(121,47)<br>(104,47)<br>(100,47)<br>(114,47)<br>(47,47)<br>(102,47)<br>(97,47)<br>(110,47)<br>(99,47)<br>(121,47)<br>(104,47)<br>(100,47)<br>(114,47)<br>(46,47)<br>(112,47)<br>(100,47)<br>(102,47)</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t++,&nbsp;h++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(h&nbsp;&lt;&nbsp;end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t++,&nbsp;h++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Copy&nbsp;the&nbsp;path&nbsp;element,&nbsp;including&nbsp;the&nbsp;final&nbsp;slash.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(h&nbsp;&lt;&nbsp;end&nbsp;&amp;&amp;&nbsp;*h&nbsp;!=&nbsp;&#x27;/&#x27;)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t++&nbsp;=&nbsp;*h++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(h&nbsp;&lt;&nbsp;end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t++&nbsp;=&nbsp;*h++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(t&nbsp;!=&nbsp;h)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*t&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;t&nbsp;!=&nbsp;h;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;int</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>full_path_length&nbsp;(const&nbsp;struct&nbsp;url&nbsp;*url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;len&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#define&nbsp;FROB(el)&nbsp;if&nbsp;(url-&gt;el)&nbsp;len&nbsp;+=&nbsp;1&nbsp;+&nbsp;strlen&nbsp;(url-&gt;el)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(path);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(params);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;FROB&nbsp;(query);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#undef&nbsp;FROB</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;len;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_escape_allow_passthrough&nbsp;(const&nbsp;char&nbsp;*s)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;url_escape_1&nbsp;(s,&nbsp;urlchr_unsafe,&nbsp;true);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>unescape_single_char&nbsp;(char&nbsp;*str,&nbsp;char&nbsp;chr)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;c1&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(chr&nbsp;&gt;&gt;&nbsp;4);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;c2&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(chr&nbsp;&amp;&nbsp;0xf);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*h&nbsp;=&nbsp;str;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;hare&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*t&nbsp;=&nbsp;str;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;tortoise&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(;&nbsp;*h;&nbsp;h++,&nbsp;t++)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(h[0]&nbsp;==&nbsp;&#x27;%&#x27;&nbsp;&amp;&amp;&nbsp;h[1]&nbsp;==&nbsp;c1&nbsp;&amp;&amp;&nbsp;h[2]&nbsp;==&nbsp;c2)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t&nbsp;=&nbsp;chr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;+=&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*t&nbsp;=&nbsp;*h;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*t&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>int</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>numdigit&nbsp;(wgint&nbsp;number)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;cnt&nbsp;=&nbsp;1;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(number&nbsp;&lt;&nbsp;0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;++cnt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;accomodate&nbsp;&#x27;-&#x27;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;while&nbsp;((number&nbsp;/=&nbsp;10)&nbsp;!=&nbsp;0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(400,0)<br>(40,0)<br>(4,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;++cnt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;cnt;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>number_to_string&nbsp;(char&nbsp;*buffer,&nbsp;wgint&nbsp;number)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*p&nbsp;=&nbsp;buffer;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;wgint&nbsp;n&nbsp;=&nbsp;number;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;last_digit_char&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;-WGINT_MAX)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;n&nbsp;=&nbsp;-n&nbsp;would&nbsp;overflow&nbsp;because&nbsp;-n&nbsp;would&nbsp;evaluate&nbsp;to&nbsp;a</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wgint&nbsp;value&nbsp;larger&nbsp;than&nbsp;WGINT_MAX.&nbsp;&nbsp;Need&nbsp;to&nbsp;make&nbsp;n</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;smaller&nbsp;and&nbsp;handle&nbsp;the&nbsp;last&nbsp;digit&nbsp;separately.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;last_digit&nbsp;=&nbsp;n&nbsp;%&nbsp;10;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;The&nbsp;sign&nbsp;of&nbsp;n%10&nbsp;is&nbsp;implementation-defined.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(last_digit&nbsp;&lt;&nbsp;0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_digit_char&nbsp;=&nbsp;&#x27;0&#x27;&nbsp;-&nbsp;last_digit;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_digit_char&nbsp;=&nbsp;&#x27;0&#x27;&nbsp;+&nbsp;last_digit;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;After&nbsp;n&nbsp;is&nbsp;made&nbsp;smaller,&nbsp;-n&nbsp;will&nbsp;not&nbsp;overflow.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;/=&nbsp;10;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;-&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;-n;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Use&nbsp;the&nbsp;DIGITS_&nbsp;macro&nbsp;appropriate&nbsp;for&nbsp;N&#x27;s&nbsp;number&nbsp;of&nbsp;digits.&nbsp;&nbsp;That</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;way&nbsp;printing&nbsp;any&nbsp;N&nbsp;is&nbsp;fully&nbsp;open-coded&nbsp;without&nbsp;a&nbsp;loop&nbsp;or&nbsp;jump.</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Also&nbsp;see&nbsp;description&nbsp;of&nbsp;DIGITS_*.)&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(n&nbsp;&lt;&nbsp;10)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_1&nbsp;(1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,10)</td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;100)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_2&nbsp;(10);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,100)</td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;1000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_3&nbsp;(100);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,1000)</td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;10000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_4&nbsp;(1000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(4000,10000)</td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;100000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_5&nbsp;(10000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;1000000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_6&nbsp;(100000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;10000000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_7&nbsp;(1000000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;100000000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_8&nbsp;(10000000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;1000000000)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_9&nbsp;(100000000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGITS_10&nbsp;(1000000000);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(last_digit_char)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;last_digit_char;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*p&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_string&nbsp;(const&nbsp;struct&nbsp;url&nbsp;*url,&nbsp;enum&nbsp;url_auth_mode&nbsp;auth_mode)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;size;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*result,&nbsp;*p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*quoted_host,&nbsp;*quoted_user&nbsp;=&nbsp;NULL,&nbsp;*quoted_passwd&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;scheme_port&nbsp;=&nbsp;supported_schemes[url-&gt;scheme].default_port;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*scheme_str&nbsp;=&nbsp;supported_schemes[url-&gt;scheme].leading_string;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;fplen&nbsp;=&nbsp;full_path_length&nbsp;(url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;bool&nbsp;brackets_around_host;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Make&nbsp;sure&nbsp;the&nbsp;user&nbsp;name&nbsp;and&nbsp;password&nbsp;are&nbsp;quoted.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(url-&gt;user)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(auth_mode&nbsp;!=&nbsp;URL_AUTH_HIDE)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quoted_user&nbsp;=&nbsp;url_escape_allow_passthrough&nbsp;(url-&gt;user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url-&gt;passwd)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(auth_mode&nbsp;==&nbsp;URL_AUTH_HIDE_PASSWD)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quoted_passwd&nbsp;=&nbsp;(char&nbsp;*)&nbsp;HIDDEN_PASSWORD;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quoted_passwd&nbsp;=&nbsp;url_escape_allow_passthrough&nbsp;(url-&gt;passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;In&nbsp;the&nbsp;unlikely&nbsp;event&nbsp;that&nbsp;the&nbsp;host&nbsp;name&nbsp;contains&nbsp;non-printable</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;characters,&nbsp;quote&nbsp;it&nbsp;for&nbsp;displaying&nbsp;to&nbsp;the&nbsp;user.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;quoted_host&nbsp;=&nbsp;url_escape_allow_passthrough&nbsp;(url-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Undo&nbsp;the&nbsp;quoting&nbsp;of&nbsp;colons&nbsp;that&nbsp;URL&nbsp;escaping&nbsp;performs.&nbsp;&nbsp;IPv6</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addresses&nbsp;may&nbsp;legally&nbsp;contain&nbsp;colons,&nbsp;and&nbsp;in&nbsp;that&nbsp;case&nbsp;must&nbsp;be</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placed&nbsp;in&nbsp;square&nbsp;brackets.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_host&nbsp;!=&nbsp;url-&gt;host)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;unescape_single_char&nbsp;(quoted_host,&nbsp;&#x27;:&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;brackets_around_host&nbsp;=&nbsp;strchr&nbsp;(quoted_host,&nbsp;&#x27;:&#x27;)&nbsp;!=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;size&nbsp;=&nbsp;(strlen&nbsp;(scheme_str)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;strlen&nbsp;(quoted_host)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;(brackets_around_host&nbsp;?&nbsp;2&nbsp;:&nbsp;0)</td><td></td><td></td><td></td><td></td><td>(0,0)</td><td></td><td></td><td></td><td></td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;fplen</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(url-&gt;port&nbsp;!=&nbsp;scheme_port)</td><td></td><td></td><td></td><td></td><td>(80,80)</td><td></td><td></td><td></td><td></td><td>(4000,80)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;+=&nbsp;1&nbsp;+&nbsp;numdigit&nbsp;(url-&gt;port);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_user)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;+=&nbsp;1&nbsp;+&nbsp;strlen&nbsp;(quoted_user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(quoted_passwd)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;+=&nbsp;1&nbsp;+&nbsp;strlen&nbsp;(quoted_passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p&nbsp;=&nbsp;result&nbsp;=&nbsp;xmalloc&nbsp;(size);</td><td></td><td></td><td></td><td></td><td>malloc();</td><td></td><td></td><td></td><td></td><td>malloc();</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;APPEND&nbsp;(p,&nbsp;scheme_str);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_user)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;(p,&nbsp;quoted_user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(quoted_passwd)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;:&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;(p,&nbsp;quoted_passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;@&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(brackets_around_host)</td><td></td><td></td><td></td><td></td><td>(0,0)</td><td></td><td></td><td></td><td></td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;[&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;APPEND&nbsp;(p,&nbsp;quoted_host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(brackets_around_host)</td><td></td><td></td><td></td><td></td><td>(0,0)</td><td></td><td></td><td></td><td></td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;]&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(url-&gt;port&nbsp;!=&nbsp;scheme_port)</td><td></td><td></td><td></td><td></td><td>(80,80)</td><td></td><td></td><td></td><td></td><td>(4000,80)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;:&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;number_to_string&nbsp;(p,&nbsp;url-&gt;port);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;full_path_write&nbsp;(url,&nbsp;p);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p&nbsp;+=&nbsp;fplen;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_user&nbsp;&amp;&amp;&nbsp;quoted_user&nbsp;!=&nbsp;url-&gt;user)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(quoted_user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_passwd&nbsp;&amp;&amp;&nbsp;auth_mode&nbsp;==&nbsp;URL_AUTH_SHOW</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;quoted_passwd&nbsp;!=&nbsp;url-&gt;passwd)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(quoted_passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(quoted_host&nbsp;!=&nbsp;url-&gt;host)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(quoted_host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;result;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>/*&nbsp;Try&nbsp;to&nbsp;transcode&nbsp;string&nbsp;str&nbsp;from&nbsp;remote&nbsp;encoding&nbsp;to&nbsp;UTF-8.&nbsp;On&nbsp;success,&nbsp;*new</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;contains&nbsp;the&nbsp;transcoded&nbsp;string.&nbsp;*new&nbsp;content&nbsp;is&nbsp;unspecified&nbsp;otherwise.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>remote_to_utf8&nbsp;(const&nbsp;struct&nbsp;iri&nbsp;*iri,&nbsp;const&nbsp;char&nbsp;*str,&nbsp;char&nbsp;**new)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;bool&nbsp;ret&nbsp;=&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!iri-&gt;uri_encoding)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;When&nbsp;`i-&gt;uri_encoding&#x27;&nbsp;==&nbsp;&quot;UTF-8&quot;&nbsp;there&nbsp;is&nbsp;nothing&nbsp;to&nbsp;convert.&nbsp;&nbsp;But&nbsp;we&nbsp;must</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test&nbsp;for&nbsp;non-ASCII&nbsp;symbols&nbsp;for&nbsp;correct&nbsp;hostname&nbsp;processing&nbsp;in&nbsp;`idn_encode&#x27;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!c_strcasecmp&nbsp;(iri-&gt;uri_encoding,&nbsp;&quot;UTF-8&quot;))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;unsigned&nbsp;char&nbsp;*p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(p&nbsp;=&nbsp;(unsigned&nbsp;char&nbsp;*)&nbsp;str;&nbsp;*p;&nbsp;p++)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(*p&nbsp;&gt;&nbsp;127)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*new&nbsp;=&nbsp;strdup&nbsp;(str);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(do_conversion&nbsp;(&quot;UTF-8&quot;,&nbsp;iri-&gt;uri_encoding,&nbsp;str,&nbsp;strlen&nbsp;(str),&nbsp;new))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Test&nbsp;if&nbsp;something&nbsp;was&nbsp;converted&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(*new&nbsp;&amp;&amp;&nbsp;!strcmp&nbsp;(str,&nbsp;*new))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(*new);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;ret;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;inline&nbsp;bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>char_needs_escaping&nbsp;(const&nbsp;char&nbsp;*p)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(*p&nbsp;==&nbsp;&#x27;%&#x27;)</td><td></td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(103,37)<br>(105,37)<br>(116,37)<br>(104,37)<br>(117,37)<br>(98,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(103,37)<br>(105,37)<br>(116,37)<br>(104,37)<br>(117,37)<br>(98,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(63,37)<br>(116,37)<br>(97,37)<br>(98,37)<br>(61,37)<br>(114,37)<br>(101,37)<br>(112,37)<br>(111,37)<br>(115,37)<br>(105,37)<br>(116,37)<br>(111,37)<br>(114,37)<br>(105,37)<br>(101,37)<br>(115,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(103,37)<br>(105,37)<br>(116,37)<br>(104,37)<br>(117,37)<br>(98,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(47,37)<br>(80,37)<br>(65,37)<br>(83,37)<br>(83,37)<br>(47,37)<br>(105,37)<br>(115,37)<br>(115,37)<br>(117,37)<br>(101,37)<br>(115,37)<br>(47,37)<br>(54,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(103,37)<br>(105,37)<br>(116,37)<br>(104,37)<br>(117,37)<br>(98,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(47,37)<br>(80,37)<br>(65,37)<br>(83,37)<br>(83,37)<br>(47,37)<br>(98,37)<br>(108,37)<br>(111,37)<br>(98,37)<br>(47,37)<br>(109,37)<br>(97,37)<br>(115,37)<br>(116,37)<br>(101,37)<br>(114,37)<br>(47,37)<br>(98,37)<br>(117,37)<br>(105,37)<br>(108,37)<br>(100,37)<br>(95,37)<br>(104,37)<br>(111,37)<br>(111,37)<br>(107,37)<br>(46,37)<br>(115,37)<br>(104,37)<br>(35,37)<br>(76,37)<br>(54,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(103,37)<br>(105,37)<br>(116,37)<br>(104,37)<br>(117,37)<br>(98,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(106,37)<br>(105,37)<br>(97,37)<br>(104,37)<br>(97,37)<br>(111,37)<br>(52,37)<br>(50,37)<br>(47,37)<br>(63,37)<br>(112,37)<br>(97,37)<br>(114,37)<br>(97,37)<br>(109,37)<br>(49,37)<br>(61,37)<br>(116,37)<br>(114,37)<br>(117,37)<br>(101,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(116,37)<br>(119,37)<br>(105,37)<br>(116,37)<br>(116,37)<br>(101,37)<br>(114,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(104,37)<br>(97,37)<br>(115,37)<br>(104,37)<br>(116,37)<br>(97,37)<br>(103,37)<br>(47,37)<br>(84,37)<br>(114,37)<br>(97,37)<br>(102,37)<br>(102,37)<br>(105,37)<br>(99,37)<br>(63,37)<br>(115,37)<br>(114,37)<br>(99,37)<br>(61,37)<br>(104,37)<br>(97,37)<br>(115,37)<br>(104,37)<br>(116,37)<br>(97,37)<br>(103,37)<br>(95,37)<br>(99,37)<br>(108,37)<br>(105,37)<br>(99,37)<br>(107,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(116,37)<br>(119,37)<br>(105,37)<br>(116,37)<br>(116,37)<br>(101,37)<br>(114,37)<br>(46,37)<br>(99,37)<br>(111,37)<br>(109,37)<br>(47,37)<br>(119,37)<br>(109,37)<br>(97,37)<br>(122,37)<br>(117,37)<br>(114,37)<br>(99,37)<br>(122,37)<br>(121,37)<br>(107,37)<br>(47,37)<br>(115,37)<br>(116,37)<br>(97,37)<br>(116,37)<br>(117,37)<br>(115,37)<br>(47,37)<br>(49,37)<br>(48,37)<br>(56,37)<br>(56,37)<br>(55,37)<br>(50,37)<br>(56,37)<br>(50,37)<br>(53,37)<br>(50,37)<br>(52,37)<br>(51,37)<br>(53,37)<br>(51,37)<br>(52,37)<br>(57,37)<br>(53,37)<br>(48,37)<br>(52,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(102,37)<br>(116,37)<br>(112,37)<br>(46,37)<br>(97,37)<br>(99,37)<br>(99,37)<br>(46,37)<br>(117,37)<br>(109,37)<br>(117,37)<br>(46,37)<br>(115,37)<br>(101,37)<br>(47,37)<br>(109,37)<br>(105,37)<br>(114,37)<br>(114,37)<br>(111,37)<br>(114,37)<br>(47,37)<br>(67,37)<br>(84,37)<br>(65,37)<br>(78,37)<br>(47,37)<br>(109,37)<br>(97,37)<br>(99,37)<br>(114,37)<br>(111,37)<br>(115,37)<br>(47,37)<br>(108,37)<br>(97,37)<br>(116,37)<br>(101,37)<br>(120,37)<br>(47,37)<br>(99,37)<br>(111,37)<br>(110,37)<br>(116,37)<br>(114,37)<br>(105,37)<br>(98,37)<br>(47,37)<br>(102,37)<br>(97,37)<br>(110,37)<br>(99,37)<br>(121,37)<br>(104,37)<br>(100,37)<br>(114,37)<br>(47,37)<br>(102,37)<br>(97,37)<br>(110,37)<br>(99,37)<br>(121,37)<br>(104,37)<br>(100,37)<br>(114,37)<br>(46,37)<br>(112,37)<br>(100,37)<br>(102,37)</td><td>(104,37)<br>(116,37)<br>(116,37)<br>(112,37)<br>(58,37)<br>(47,37)<br>(47,37)<br>(49,37)<br>(50,37)<br>(55,37)<br>(46,37)<br>(48,37)<br>(46,37)<br>(48,37)<br>(46,37)<br>(49,37)<br>(58,37)<br>(52,37)<br>(48,37)<br>(48,37)<br>(48,37)<br>(47,37)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_isxdigit&nbsp;(*(p&nbsp;+&nbsp;1))&nbsp;&amp;&amp;&nbsp;c_isxdigit&nbsp;(*(p&nbsp;+&nbsp;2)))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Garbled&nbsp;%..&nbsp;sequence:&nbsp;encode&nbsp;`%&#x27;.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else&nbsp;if&nbsp;(URL_UNSAFE_CHAR&nbsp;(*p)&nbsp;&amp;&amp;&nbsp;!URL_RESERVED_CHAR&nbsp;(*p))</td><td></td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(2,0)<br>(1,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>reencode_escapes&nbsp;(const&nbsp;char&nbsp;*s)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*p1;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*newstr,&nbsp;*p2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;oldlen,&nbsp;newlen;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;encode_count&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;First&nbsp;pass:&nbsp;inspect&nbsp;the&nbsp;string&nbsp;to&nbsp;see&nbsp;if&nbsp;there&#x27;s&nbsp;anything&nbsp;to&nbsp;do,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;to&nbsp;calculate&nbsp;the&nbsp;new&nbsp;length.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(p1&nbsp;=&nbsp;s;&nbsp;*p1;&nbsp;p1++)</td><td></td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(63,0)<br>(116,0)<br>(97,0)<br>(98,0)<br>(61,0)<br>(114,0)<br>(101,0)<br>(112,0)<br>(111,0)<br>(115,0)<br>(105,0)<br>(116,0)<br>(111,0)<br>(114,0)<br>(105,0)<br>(101,0)<br>(115,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(47,0)<br>(80,0)<br>(65,0)<br>(83,0)<br>(83,0)<br>(47,0)<br>(105,0)<br>(115,0)<br>(115,0)<br>(117,0)<br>(101,0)<br>(115,0)<br>(47,0)<br>(54,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(47,0)<br>(80,0)<br>(65,0)<br>(83,0)<br>(83,0)<br>(47,0)<br>(98,0)<br>(108,0)<br>(111,0)<br>(98,0)<br>(47,0)<br>(109,0)<br>(97,0)<br>(115,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(47,0)<br>(98,0)<br>(117,0)<br>(105,0)<br>(108,0)<br>(100,0)<br>(95,0)<br>(104,0)<br>(111,0)<br>(111,0)<br>(107,0)<br>(46,0)<br>(115,0)<br>(104,0)<br>(35,0)<br>(76,0)<br>(54,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(106,0)<br>(105,0)<br>(97,0)<br>(104,0)<br>(97,0)<br>(111,0)<br>(52,0)<br>(50,0)<br>(47,0)<br>(63,0)<br>(112,0)<br>(97,0)<br>(114,0)<br>(97,0)<br>(109,0)<br>(49,0)<br>(61,0)<br>(116,0)<br>(114,0)<br>(117,0)<br>(101,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(116,0)<br>(119,0)<br>(105,0)<br>(116,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(104,0)<br>(97,0)<br>(115,0)<br>(104,0)<br>(116,0)<br>(97,0)<br>(103,0)<br>(47,0)<br>(84,0)<br>(114,0)<br>(97,0)<br>(102,0)<br>(102,0)<br>(105,0)<br>(99,0)<br>(63,0)<br>(115,0)<br>(114,0)<br>(99,0)<br>(61,0)<br>(104,0)<br>(97,0)<br>(115,0)<br>(104,0)<br>(116,0)<br>(97,0)<br>(103,0)<br>(95,0)<br>(99,0)<br>(108,0)<br>(105,0)<br>(99,0)<br>(107,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(116,0)<br>(119,0)<br>(105,0)<br>(116,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(47,0)<br>(119,0)<br>(109,0)<br>(97,0)<br>(122,0)<br>(117,0)<br>(114,0)<br>(99,0)<br>(122,0)<br>(121,0)<br>(107,0)<br>(47,0)<br>(115,0)<br>(116,0)<br>(97,0)<br>(116,0)<br>(117,0)<br>(115,0)<br>(47,0)<br>(49,0)<br>(48,0)<br>(56,0)<br>(56,0)<br>(55,0)<br>(50,0)<br>(56,0)<br>(50,0)<br>(53,0)<br>(50,0)<br>(52,0)<br>(51,0)<br>(53,0)<br>(51,0)<br>(52,0)<br>(57,0)<br>(53,0)<br>(48,0)<br>(52,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(102,0)<br>(116,0)<br>(112,0)<br>(46,0)<br>(97,0)<br>(99,0)<br>(99,0)<br>(46,0)<br>(117,0)<br>(109,0)<br>(117,0)<br>(46,0)<br>(115,0)<br>(101,0)<br>(47,0)<br>(109,0)<br>(105,0)<br>(114,0)<br>(114,0)<br>(111,0)<br>(114,0)<br>(47,0)<br>(67,0)<br>(84,0)<br>(65,0)<br>(78,0)<br>(47,0)<br>(109,0)<br>(97,0)<br>(99,0)<br>(114,0)<br>(111,0)<br>(115,0)<br>(47,0)<br>(108,0)<br>(97,0)<br>(116,0)<br>(101,0)<br>(120,0)<br>(47,0)<br>(99,0)<br>(111,0)<br>(110,0)<br>(116,0)<br>(114,0)<br>(105,0)<br>(98,0)<br>(47,0)<br>(102,0)<br>(97,0)<br>(110,0)<br>(99,0)<br>(121,0)<br>(104,0)<br>(100,0)<br>(114,0)<br>(47,0)<br>(102,0)<br>(97,0)<br>(110,0)<br>(99,0)<br>(121,0)<br>(104,0)<br>(100,0)<br>(114,0)<br>(46,0)<br>(112,0)<br>(100,0)<br>(102,0)<br>(0,0)</td><td>(104,0)<br>(116,0)<br>(116,0)<br>(112,0)<br>(58,0)<br>(47,0)<br>(47,0)<br>(49,0)<br>(50,0)<br>(55,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(49,0)<br>(58,0)<br>(52,0)<br>(48,0)<br>(48,0)<br>(48,0)<br>(47,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(char_needs_escaping&nbsp;(p1))</td><td></td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++encode_count;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!encode_count)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;The&nbsp;string&nbsp;is&nbsp;good&nbsp;as&nbsp;it&nbsp;is.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(char&nbsp;*)&nbsp;s;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;C&nbsp;const&nbsp;model&nbsp;sucks.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;oldlen&nbsp;=&nbsp;p1&nbsp;-&nbsp;s;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Each&nbsp;encoding&nbsp;adds&nbsp;two&nbsp;characters&nbsp;(hex&nbsp;digits).&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;newlen&nbsp;=&nbsp;oldlen&nbsp;+&nbsp;2&nbsp;*&nbsp;encode_count;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;newstr&nbsp;=&nbsp;xmalloc&nbsp;(newlen&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Second&nbsp;pass:&nbsp;copy&nbsp;the&nbsp;string&nbsp;to&nbsp;the&nbsp;destination&nbsp;address,&nbsp;encoding</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chars&nbsp;when&nbsp;needed.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p1&nbsp;=&nbsp;s;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p2&nbsp;=&nbsp;newstr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;while&nbsp;(*p1)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(char_needs_escaping&nbsp;(p1))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;c&nbsp;=&nbsp;*p1++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;&#x27;%&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(c&nbsp;&gt;&gt;&nbsp;4);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;XNUM_TO_DIGIT&nbsp;(c&nbsp;&amp;&nbsp;0xf);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p2++&nbsp;=&nbsp;*p1++;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*p2&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;newstr;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>/*&nbsp;Try&nbsp;to&nbsp;&quot;ASCII&nbsp;encode&quot;&nbsp;UTF-8&nbsp;host.&nbsp;Return&nbsp;the&nbsp;new&nbsp;domain&nbsp;on&nbsp;success&nbsp;or&nbsp;NULL</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;on&nbsp;error.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>idn_encode&nbsp;(const&nbsp;struct&nbsp;iri&nbsp;*i,&nbsp;const&nbsp;char&nbsp;*host)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;ret;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*ascii_encoded;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*utf8_encoded&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*src;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Encode&nbsp;to&nbsp;UTF-8&nbsp;if&nbsp;not&nbsp;done&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!i-&gt;utf8_encode)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!remote_to_utf8&nbsp;(i,&nbsp;host,&nbsp;&amp;utf8_encoded))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;&nbsp;&nbsp;/*&nbsp;Nothing&nbsp;to&nbsp;encode&nbsp;or&nbsp;an&nbsp;error&nbsp;occured&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src&nbsp;=&nbsp;utf8_encoded;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;src&nbsp;=&nbsp;host;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;IDN2_TRANSITIONAL&nbsp;implies&nbsp;input&nbsp;NFC&nbsp;encoding&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;if&nbsp;((ret&nbsp;=&nbsp;idn2_lookup_u8&nbsp;(</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;(uint8_t&nbsp;*)&nbsp;src,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;(uint8_t&nbsp;**)&nbsp;&amp;ascii_encoded,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;IDN2_NONTRANSITIONAL))&nbsp;!=&nbsp;IDN2_OK)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logprintf&nbsp;(</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG_VERBOSE,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_(&quot;idn_encode&nbsp;failed&nbsp;(%d):&nbsp;%s\n&quot;),</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote&nbsp;(idn2_strerror&nbsp;(ret)));</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;xfree&nbsp;(utf8_encoded);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;ret&nbsp;==&nbsp;IDN2_OK&nbsp;?&nbsp;ascii_encoded&nbsp;:&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;const&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_skip_credentials&nbsp;(const&nbsp;char&nbsp;*url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Look&nbsp;for&nbsp;&#x27;@&#x27;&nbsp;that&nbsp;comes&nbsp;before&nbsp;terminators,&nbsp;such&nbsp;as&nbsp;&#x27;/&#x27;,&nbsp;&#x27;?&#x27;,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x27;#&#x27;,&nbsp;or&nbsp;&#x27;;&#x27;.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*p&nbsp;=&nbsp;(const&nbsp;char&nbsp;*)strpbrk&nbsp;(url,&nbsp;&quot;@/?#;&quot;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!p&nbsp;||&nbsp;*p&nbsp;!=&nbsp;&#x27;@&#x27;)</td><td></td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td><td>(47,64)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;url;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;p&nbsp;+&nbsp;1;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>split_path&nbsp;(const&nbsp;char&nbsp;*path,&nbsp;char&nbsp;**dir,&nbsp;char&nbsp;**file)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*last_slash&nbsp;=&nbsp;strrchr&nbsp;(path,&nbsp;&#x27;/&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!last_slash)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*dir&nbsp;=&nbsp;xstrdup&nbsp;(&quot;&quot;);</td><td></td><td>malloc();</td><td>malloc();</td><td></td><td></td><td></td><td></td><td></td><td></td><td>malloc();</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*file&nbsp;=&nbsp;xstrdup&nbsp;(path);</td><td></td><td>malloc();</td><td>malloc();</td><td></td><td></td><td></td><td></td><td></td><td></td><td>malloc();</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*dir&nbsp;=&nbsp;strdupdelim&nbsp;(path,&nbsp;last_slash);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*file&nbsp;=&nbsp;xstrdup&nbsp;(last_slash&nbsp;+&nbsp;1);</td><td></td><td></td><td></td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape&nbsp;(*dir);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape&nbsp;(*file);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>int</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>scheme_default_port&nbsp;(enum&nbsp;url_scheme&nbsp;scheme)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;supported_schemes[scheme].default_port;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;const&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>init_seps&nbsp;(enum&nbsp;url_scheme&nbsp;scheme)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;static&nbsp;char&nbsp;seps[8]&nbsp;=&nbsp;&quot;:/&quot;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*p&nbsp;=&nbsp;seps&nbsp;+&nbsp;2;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;flags&nbsp;=&nbsp;supported_schemes[scheme].flags;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(flags&nbsp;&amp;&nbsp;scm_has_params)</td><td></td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;;&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(flags&nbsp;&amp;&nbsp;scm_has_query)</td><td></td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;?&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(flags&nbsp;&amp;&nbsp;scm_has_fragment)</td><td></td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;&#x27;#&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*p&nbsp;=&nbsp;&#x27;\0&#x27;;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;seps;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;inline&nbsp;char&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>strpbrk_or_eos&nbsp;(const&nbsp;char&nbsp;*s,&nbsp;const&nbsp;char&nbsp;*accept)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*p&nbsp;=&nbsp;strpbrk&nbsp;(s,&nbsp;accept);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(!p)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;strchr&nbsp;(s,&nbsp;&#x27;\0&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>parse_credentials&nbsp;(const&nbsp;char&nbsp;*beg,&nbsp;const&nbsp;char&nbsp;*end,&nbsp;char&nbsp;**user,&nbsp;char&nbsp;**passwd)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*colon;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*userend;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(beg&nbsp;==&nbsp;end)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;empty&nbsp;user&nbsp;name&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;colon&nbsp;=&nbsp;memchr&nbsp;(beg,&nbsp;&#x27;:&#x27;,&nbsp;end&nbsp;-&nbsp;beg);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(colon&nbsp;==&nbsp;beg)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;again&nbsp;empty&nbsp;user&nbsp;name&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(colon)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*passwd&nbsp;=&nbsp;strdupdelim&nbsp;(colon&nbsp;+&nbsp;1,&nbsp;end);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userend&nbsp;=&nbsp;colon;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_unescape&nbsp;(*passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*passwd&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userend&nbsp;=&nbsp;end;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;*user&nbsp;=&nbsp;strdupdelim&nbsp;(beg,&nbsp;userend);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_unescape&nbsp;(*user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>static&nbsp;bool</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>lowercase_str&nbsp;(char&nbsp;*str)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;bool&nbsp;changed&nbsp;=&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;for&nbsp;(;&nbsp;*str;&nbsp;str++)</td><td></td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(103,0)<br>(105,0)<br>(116,0)<br>(104,0)<br>(117,0)<br>(98,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(116,0)<br>(119,0)<br>(105,0)<br>(116,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(116,0)<br>(119,0)<br>(105,0)<br>(116,0)<br>(116,0)<br>(101,0)<br>(114,0)<br>(46,0)<br>(99,0)<br>(111,0)<br>(109,0)<br>(0,0)</td><td>(102,0)<br>(116,0)<br>(112,0)<br>(46,0)<br>(97,0)<br>(99,0)<br>(99,0)<br>(46,0)<br>(117,0)<br>(109,0)<br>(117,0)<br>(46,0)<br>(115,0)<br>(101,0)<br>(0,0)</td><td>(49,0)<br>(50,0)<br>(55,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(48,0)<br>(46,0)<br>(49,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_isupper&nbsp;(*str))</td><td></td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td><td>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)<br>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;changed&nbsp;=&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*str&nbsp;=&nbsp;c_tolower&nbsp;(*str);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;changed;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>void</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_free&nbsp;(struct&nbsp;url&nbsp;*url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url-&gt;idn_allocated)&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idn2_free&nbsp;(url-&gt;host);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;A&nbsp;dummy&nbsp;if&nbsp;!defined(ENABLE_IRI)&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url-&gt;host&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;path);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;params);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;query);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;fragment);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;user);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;passwd);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;dir);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url-&gt;file);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>/*&nbsp;Parse&nbsp;a&nbsp;URL.</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;Return&nbsp;a&nbsp;new&nbsp;struct&nbsp;url&nbsp;if&nbsp;successful,&nbsp;NULL&nbsp;on&nbsp;error.&nbsp;&nbsp;In&nbsp;case&nbsp;of</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;error,&nbsp;and&nbsp;if&nbsp;ERROR&nbsp;is&nbsp;not&nbsp;NULL,&nbsp;also&nbsp;set&nbsp;*ERROR&nbsp;to&nbsp;the&nbsp;appropriate</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;error&nbsp;code.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>struct&nbsp;url&nbsp;*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>url_parse&nbsp;(const&nbsp;char&nbsp;*url,&nbsp;int&nbsp;*error,&nbsp;struct&nbsp;iri&nbsp;*iri,&nbsp;bool&nbsp;percent_encode)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;struct&nbsp;url&nbsp;*u;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;bool&nbsp;path_modified,&nbsp;host_modified;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;enum&nbsp;url_scheme&nbsp;scheme;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*seps;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*uname_b,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*uname_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*host_b,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*host_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*path_b,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*path_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*params_b,&nbsp;&nbsp;&nbsp;&nbsp;*params_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*query_b,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*query_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*fragment_b,&nbsp;&nbsp;*fragment_e;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;port;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;char&nbsp;*user&nbsp;=&nbsp;NULL,&nbsp;*passwd&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;const&nbsp;char&nbsp;*url_encoded&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;error_code;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;scheme&nbsp;=&nbsp;url_scheme&nbsp;(url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(scheme&nbsp;==&nbsp;SCHEME_INVALID)</td><td>(2,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td><td>(0,2)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url_has_scheme&nbsp;(url))</td><td>(1,0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_UNSUPPORTED_SCHEME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_MISSING_SCHEME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_encoded&nbsp;=&nbsp;url;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(iri&nbsp;&amp;&amp;&nbsp;iri-&gt;utf8_encode)</td><td></td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*new_url&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iri-&gt;utf8_encode&nbsp;=&nbsp;remote_to_utf8&nbsp;(iri,&nbsp;iri-&gt;orig_url&nbsp;?&nbsp;iri-&gt;orig_url&nbsp;:&nbsp;url,&nbsp;&amp;new_url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!iri-&gt;utf8_encode)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_url&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(iri-&gt;orig_url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iri-&gt;orig_url&nbsp;=&nbsp;xstrdup&nbsp;(url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_encoded&nbsp;=&nbsp;reencode_escapes&nbsp;(new_url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url_encoded&nbsp;!=&nbsp;new_url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(new_url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;percent_encode&nbsp;=&nbsp;false;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(percent_encode)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;url_encoded&nbsp;=&nbsp;reencode_escapes&nbsp;(url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p&nbsp;=&nbsp;url_encoded;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p&nbsp;+=&nbsp;strlen&nbsp;(supported_schemes[scheme].leading_string);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;uname_b&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;p&nbsp;=&nbsp;url_skip_credentials&nbsp;(p);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;uname_e&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;scheme://user:pass@host[:port]...&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;We&nbsp;attempt&nbsp;to&nbsp;break&nbsp;down&nbsp;the&nbsp;URL&nbsp;into&nbsp;the&nbsp;components&nbsp;path,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params,&nbsp;query,&nbsp;and&nbsp;fragment.&nbsp;&nbsp;They&nbsp;are&nbsp;ordered&nbsp;like&nbsp;this:</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheme://host[:port][/path][;params][?query][#fragment]&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;path_b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;path_e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;params_b&nbsp;&nbsp;&nbsp;=&nbsp;params_e&nbsp;&nbsp;&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;query_b&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;query_e&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;fragment_b&nbsp;=&nbsp;fragment_e&nbsp;=&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Initialize&nbsp;separators&nbsp;for&nbsp;optional&nbsp;parts&nbsp;of&nbsp;URL,&nbsp;depending&nbsp;on&nbsp;the</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheme.&nbsp;&nbsp;For&nbsp;example,&nbsp;FTP&nbsp;has&nbsp;params,&nbsp;and&nbsp;HTTP&nbsp;and&nbsp;HTTPS&nbsp;have</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;string&nbsp;and&nbsp;fragment.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;seps&nbsp;=&nbsp;init_seps&nbsp;(scheme);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;host_b&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(*p&nbsp;==&nbsp;&#x27;[&#x27;)</td><td></td><td>(103,91)</td><td>(103,91)</td><td>(103,91)</td><td>(103,91)</td><td>(103,91)</td><td>(116,91)</td><td>(116,91)</td><td>(102,91)</td><td>(49,91)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Handle&nbsp;IPv6&nbsp;address&nbsp;inside&nbsp;square&nbsp;brackets.&nbsp;&nbsp;Ideally&nbsp;we&#x27;d</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;just&nbsp;look&nbsp;for&nbsp;the&nbsp;terminating&nbsp;&#x27;]&#x27;,&nbsp;but&nbsp;rfc2732&nbsp;mandates</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rejecting&nbsp;invalid&nbsp;IPv6&nbsp;addresses.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;The&nbsp;address&nbsp;begins&nbsp;after&nbsp;&#x27;[&#x27;.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host_b&nbsp;=&nbsp;p&nbsp;+&nbsp;1;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host_e&nbsp;=&nbsp;strchr&nbsp;(host_b,&nbsp;&#x27;]&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!host_e)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_UNTERMINATED_IPV6_ADDRESS;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_IPV6_NOT_SUPPORTED;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;The&nbsp;closing&nbsp;bracket&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;separator&nbsp;or&nbsp;by&nbsp;the</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null&nbsp;char.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;http://[::1]...&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!strchr&nbsp;(seps,&nbsp;*p))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Trailing&nbsp;garbage&nbsp;after&nbsp;[]-delimited&nbsp;IPv6&nbsp;address.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_INVALID_HOST_NAME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;strpbrk_or_eos&nbsp;(p,&nbsp;seps);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host_e&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;++seps;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;advance&nbsp;to&nbsp;&#x27;/&#x27;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(host_b&nbsp;==&nbsp;host_e)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_INVALID_HOST_NAME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;port&nbsp;=&nbsp;scheme_default_port&nbsp;(scheme);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(*p&nbsp;==&nbsp;&#x27;:&#x27;)</td><td></td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(47,58)</td><td>(58,58)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*port_b,&nbsp;*port_e,&nbsp;*pp;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;scheme://host:port/tralala&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port_b&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;strpbrk_or_eos&nbsp;(p,&nbsp;seps);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port_e&nbsp;=&nbsp;p;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Allow&nbsp;empty&nbsp;port,&nbsp;as&nbsp;per&nbsp;rfc2396.&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(port_b&nbsp;!=&nbsp;port_e)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(port&nbsp;=&nbsp;0,&nbsp;pp&nbsp;=&nbsp;port_b;&nbsp;pp&nbsp;&lt;&nbsp;port_e;&nbsp;pp++)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!c_isdigit&nbsp;(*pp))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>(2048,0)<br>(2048,0)<br>(2048,0)<br>(2048,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;http://host:12randomgarbage/blah&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_BAD_PORT_NUMBER;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port&nbsp;=&nbsp;10&nbsp;*&nbsp;port&nbsp;+&nbsp;(*pp&nbsp;-&nbsp;&#x27;0&#x27;);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Check&nbsp;for&nbsp;too&nbsp;large&nbsp;port&nbsp;numbers&nbsp;here,&nbsp;before&nbsp;we&nbsp;have</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;chance&nbsp;to&nbsp;overflow&nbsp;on&nbsp;bogus&nbsp;port&nbsp;values.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(port&nbsp;&gt;&nbsp;0xffff)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_BAD_PORT_NUMBER;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Advance&nbsp;to&nbsp;the&nbsp;first&nbsp;separator&nbsp;*after*&nbsp;&#x27;/&#x27;&nbsp;(either&nbsp;&#x27;;&#x27;&nbsp;or&nbsp;&#x27;?&#x27;,</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depending&nbsp;on&nbsp;the&nbsp;scheme).&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;++seps;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Get&nbsp;the&nbsp;optional&nbsp;parts&nbsp;of&nbsp;URL,&nbsp;each&nbsp;part&nbsp;being&nbsp;delimited&nbsp;by</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;location&nbsp;and&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;separator.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#define&nbsp;GET_URL_PART(sepchar,&nbsp;var)&nbsp;do&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(*p&nbsp;==&nbsp;sepchar)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;var##_b&nbsp;=&nbsp;++p,&nbsp;var##_e&nbsp;=&nbsp;p&nbsp;=&nbsp;strpbrk_or_eos&nbsp;(p,&nbsp;seps);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;++seps;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}&nbsp;while&nbsp;(0)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;GET_URL_PART&nbsp;(&#x27;/&#x27;,&nbsp;path);</td><td></td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td><td>(47,47)</td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(supported_schemes[scheme].flags&nbsp;&amp;&nbsp;scm_has_params)</td><td></td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;GET_URL_PART&nbsp;(&#x27;;&#x27;,&nbsp;params);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(supported_schemes[scheme].flags&nbsp;&amp;&nbsp;scm_has_query)</td><td></td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td><td>(4,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;GET_URL_PART&nbsp;(&#x27;?&#x27;,&nbsp;query);</td><td></td><td>(0,63)</td><td>(63,63)</td><td>(0,63)</td><td>(35,63)</td><td>(63,63)</td><td>(63,63)</td><td>(0,63)</td><td>(0,63)</td><td>(0,63)</td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(supported_schemes[scheme].flags&nbsp;&amp;&nbsp;scm_has_fragment)</td><td></td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td><td>(8,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;GET_URL_PART&nbsp;(&#x27;#&#x27;,&nbsp;fragment);</td><td></td><td>(0,35)</td><td>(0,35)</td><td>(0,35)</td><td>(35,35)</td><td>(0,35)</td><td>(0,35)</td><td>(0,35)</td><td>(0,35)</td><td>(0,35)</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#undef&nbsp;GET_URL_PART</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(uname_b&nbsp;!=&nbsp;uname_e)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;http://user:pass@host&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uname_b&nbsp;&nbsp;&nbsp;uname_e&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!parse_credentials&nbsp;(uname_b,&nbsp;uname_e&nbsp;-&nbsp;1,&nbsp;&amp;user,&nbsp;&amp;passwd))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_INVALID_USER_NAME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u&nbsp;=&nbsp;xnew0&nbsp;(struct&nbsp;url);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;scheme&nbsp;=&nbsp;scheme;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;host&nbsp;&nbsp;&nbsp;=&nbsp;strdupdelim&nbsp;(host_b,&nbsp;host_e);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;port&nbsp;&nbsp;&nbsp;=&nbsp;port;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;user&nbsp;&nbsp;&nbsp;=&nbsp;user;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;passwd&nbsp;=&nbsp;passwd;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;u-&gt;path&nbsp;=&nbsp;strdupdelim&nbsp;(path_b,&nbsp;path_e);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;path_modified&nbsp;=&nbsp;path_simplify&nbsp;(scheme,&nbsp;u-&gt;path);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;split_path&nbsp;(u-&gt;path,&nbsp;&amp;u-&gt;dir,&nbsp;&amp;u-&gt;file);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;host_modified&nbsp;=&nbsp;lowercase_str&nbsp;(u-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Decode&nbsp;%HH&nbsp;sequences&nbsp;in&nbsp;host&nbsp;name.&nbsp;&nbsp;This&nbsp;is&nbsp;important&nbsp;not&nbsp;so&nbsp;much</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;support&nbsp;%HH&nbsp;sequences&nbsp;in&nbsp;host&nbsp;names&nbsp;(which&nbsp;other&nbsp;browser</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;don&#x27;t),&nbsp;but&nbsp;to&nbsp;support&nbsp;binary&nbsp;characters&nbsp;(which&nbsp;will&nbsp;have&nbsp;been</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;converted&nbsp;to&nbsp;%HH&nbsp;by&nbsp;reencode_escapes).&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(strchr&nbsp;(u-&gt;host,&nbsp;&#x27;%&#x27;))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_unescape&nbsp;(u-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host_modified&nbsp;=&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;check&nbsp;for&nbsp;invalid&nbsp;control&nbsp;characters&nbsp;in&nbsp;host&nbsp;name&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(p&nbsp;=&nbsp;u-&gt;host;&nbsp;*p;&nbsp;p++)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_iscntrl(*p))</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_free(u);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_code&nbsp;=&nbsp;PE_INVALID_HOST_NAME;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;error;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Apply&nbsp;IDNA&nbsp;regardless&nbsp;of&nbsp;iri-&gt;utf8_encode&nbsp;status&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(opt.enable_iri&nbsp;&amp;&amp;&nbsp;iri)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*new&nbsp;=&nbsp;idn_encode&nbsp;(iri,&nbsp;u-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(new)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(u-&gt;host);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;host&nbsp;=&nbsp;new;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;idn_allocated&nbsp;=&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host_modified&nbsp;=&nbsp;true;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(params_b)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;params&nbsp;=&nbsp;strdupdelim&nbsp;(params_b,&nbsp;params_e);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(query_b)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;query&nbsp;=&nbsp;strdupdelim&nbsp;(query_b,&nbsp;query_e);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(fragment_b)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;fragment&nbsp;=&nbsp;strdupdelim&nbsp;(fragment_b,&nbsp;fragment_e);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(opt.enable_iri&nbsp;||&nbsp;path_modified&nbsp;||&nbsp;u-&gt;fragment&nbsp;||&nbsp;host_modified&nbsp;||&nbsp;path_b&nbsp;==&nbsp;path_e)</td><td></td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td><td>(0,0)</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;If&nbsp;we&nbsp;suspect&nbsp;that&nbsp;a&nbsp;transformation&nbsp;has&nbsp;rendered&nbsp;what</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_string&nbsp;might&nbsp;return&nbsp;different&nbsp;from&nbsp;URL_ENCODED,&nbsp;rebuild</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;url&nbsp;using&nbsp;url_string.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;url&nbsp;=&nbsp;url_string&nbsp;(u,&nbsp;URL_AUTH_SHOW);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url_encoded&nbsp;!=&nbsp;url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url_encoded);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(url_encoded&nbsp;==&nbsp;url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;url&nbsp;=&nbsp;xstrdup&nbsp;(url);</td><td></td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td></td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td>malloc();</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u-&gt;url&nbsp;=&nbsp;(char&nbsp;*)&nbsp;url_encoded;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;u;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;error:</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Cleanup&nbsp;in&nbsp;case&nbsp;of&nbsp;error:&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(url_encoded&nbsp;&amp;&amp;&nbsp;url_encoded&nbsp;!=&nbsp;url)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;xfree&nbsp;(url_encoded);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;/*&nbsp;Transmit&nbsp;the&nbsp;error&nbsp;code&nbsp;to&nbsp;the&nbsp;caller,&nbsp;if&nbsp;the&nbsp;caller&nbsp;wants&nbsp;to</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;know.&nbsp;&nbsp;*/</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;if&nbsp;(error)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;*error&nbsp;=&nbsp;error_code;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;return&nbsp;NULL;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>int&nbsp;main(int&nbsp;argc,&nbsp;char**&nbsp;argv)&nbsp;{</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;struct&nbsp;iri*&nbsp;iri&nbsp;=&nbsp;iri_new();</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;int&nbsp;error&nbsp;=&nbsp;0;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>&nbsp;&nbsp;url_parse&nbsp;(argv[1],&nbsp;&amp;error,&nbsp;iri,&nbsp;true);</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    </table>
    </body>
    </html>
    